<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Josh Magee" />
  <meta name="date" content="2021-09-10" />
  <title>Baysian Calculations â€” The Table Method as adapted from Think Bayes by Allen B. Downey</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print" href="data:text/css,%0Abody%0A%7B%0Abackground%2Dcolor%3A%20white%3B%0Acolor%3A%20black%3B%0Afont%2Dfamily%3A%20%22Xfinity%20Brown%22%2C%20%22Arial%22%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014pt%3B%0Aheight%3A%20100%25%3B%0Amargin%3A%200%200%200%200%3B%0Apadding%3A%200%200%200%200%3B%0Awidth%3A%20100%25%3B%0A%7D%0Adiv%2Etoolbar%20%7B%0Abackground%2Dcolor%3A%20rgb%28240%2C240%2C240%29%3B%0Aborder%2Dtop%3A%20solid%201px%20rgb%28180%2C180%2C180%29%3B%0Abottom%3A%200%3B%0Acolor%3A%20red%3B%0Afont%2Dsize%3A%2060%25%3B%0Aheight%3A%201%2E2em%3B%0Aleft%3A%200%3B%0Apadding%2Dleft%3A%201em%3B%0Apadding%2Dright%3A%201em%3B%20position%3A%20fixed%3B%0Aright%3A%200%3B%0Atext%2Dalign%3A%20right%3B%0Atop%3A%20auto%3B%0Az%2Dindex%3A%20200%3B%0A%7D%0Adiv%2Etoolbar%20span%2Ecopyright%20%7B%0Acolor%3A%20black%3B%0Amargin%2Dleft%3A%200%2E5em%3B%0A%7D%0Adiv%2Einitial%5Fprompt%20%7B%0Abackground%2Dcolor%3A%20rgb%28200%2C200%2C200%29%3B%0Abackground%2Dcolor%3A%20rgba%28200%2C200%2C200%2C%200%2E35%29%3B%0Abottom%3A%201%2E2em%3B%0Acursor%3A%20pointer%3B%0Aopacity%3A%200%2E35%3B%0Aposition%3A%20absolute%3B%0Awidth%3A%20100%25%3B%0Az%2Dindex%3A%201000%3B%0A%7D%0Adiv%2Einitial%5Fprompt%20%2Ehelp%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Adiv%2Einitial%5Fprompt%20%2Eclose%20%7B%0Afont%2Dstyle%3A%20italic%3B%0Atext%2Dalign%3A%20right%3B%0A%7D%0Adiv%2Eslidy%5Ftoc%20%7B%0Abackground%3A%20rgb%28240%2C240%2C240%29%3B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%2Dwidth%3A%202px%3B%0Abottom%3A%204em%3B%0Afont%2Dsize%3A%2060%25%3B%0Aheight%3A%2030em%3B%0Aleft%3A%204em%3B%0Amax%2Dwidth%3A%2030em%3B%0Aoverflow%3A%20auto%3B%0Apadding%3A%201em%3B%0Aposition%3A%20absolute%3B%0Aright%3A%20auto%3B%0Atop%3A%20auto%3B%0Awidth%3A%2060%25%3B%0Az%2Dindex%3A%20300%3B%0A%7D%0Adiv%2Eslidy%5Ftoc%20%2Etoc%5Fheading%20%7B%0Aborder%2Dbottom%2Dcolor%3A%20rgb%28180%2C180%2C180%29%3B%0Aborder%2Dbottom%2Dstyle%3A%20solid%3B%0Aborder%2Dbottom%2Dwidth%3A%201px%3B%0Amargin%3A%200%3B%0Amargin%2Dbottom%3A%201em%3B%0Atext%2Dalign%3A%20center%3B%0Awidth%3A%20100%25%3B%0A%7D%0Adiv%2Eslide%20%7B%0Abackground%2Dcolor%3A%20transparent%3B%0Aborder%2Dwidth%3A%200%3B%0Abottom%3A%200%3B%0Aclear%3A%20both%3B%0Aleft%3A%200%3B%0Aline%2Dheight%3A%20120%25%3B%0Amargin%3A%200%200%200%200%3B%0Apadding%3A%200%2020px%200%2020px%3B%0Aright%3A%200%3B%0Atop%3A%200%3B%0Az%2Dindex%3A%2020%3B%0A%7D%0Adiv%2Ebackground%20%7B%0Adisplay%3A%20none%3B%0A%7D%0Adiv%2Ehandout%20%7B%0Amargin%2Dleft%3A%2020px%3B%0Amargin%2Dright%3A%2020px%3B%0A%7D%0Adiv%2Eslide%2Etitlepage%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Adiv%2Eslide%2Etitlepage%20h1%20%7B%0Apadding%2Dtop%3A%2010%25%3B%0Amargin%2Dright%3A%200%3B%0A%7D%0Adiv%2Eslide%20h1%20%7B%0Abackground%3A%20transparent%3B%0Adisplay%3A%20block%3B%20font%2Dsize%3A%20160%25%3B%0Aline%2Dheight%3A%201%2E2em%3B%0Amargin%3A%200%2060pt%200%2E5em%200%3B%0Apadding%3A%204pt%2020pt%204pt%200%3B%0A%7D%0A%40media%20screen%20and%20%28max%2Ddevice%2Dwidth%3A%201024px%29%20%7B%0Adiv%2Eslide%20%7B%20font%2Dsize%3A%20100%25%3B%20%7D%0A%7D%0A%40media%20screen%20and%20%28max%2Ddevice%2Dwidth%3A%20800px%29%20%7B%0Adiv%2Eslide%20%7B%0Afont%2Dsize%3A%20200%25%3B%0A%7D%0Adiv%2Eslidy%5Ftoc%20%7B%0Afont%2Dsize%3A%20180%25%3B%0Aleft%3A%201em%3B%0Aright%3A%20auto%3B%0Atop%3A%201em%3B%0Awidth%3A%2080%25%3B%0A%7D%0A%7D%0A%2Etoc%2Dheading%20%7B%0Aborder%2Dbottom%3A%20solid%201px%20rgb%28180%2C180%2C180%29%3B%0Amargin%2Dbottom%3A%201em%3B%0Atext%2Dalign%3A%20center%3B%0Awidth%3A%20100%25%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20transparent%3B%0Aimage%2Drendering%3A%20optimizeQuality%3B%0A%7D%0Apre%20%7B%0Abackground%2Dcolor%3A%20%23E4E5E7%3B%0Aborder%2Dcolor%3A%20%2395ABD0%3B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%2Dwidth%3A%20thin%20thin%20thin%201em%3B%0Acolor%3A%20%2300428C%3B%0Afont%2Dsize%3A%2080%25%3B%0Afont%2Dweight%3A%20bold%3B%0Aline%2Dheight%3A%20120%25%3B%0Apadding%3A%200%2E2em%201em%200%2E2em%201em%3B%0A%7D%0Ali%20pre%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Ablockquote%20%7B%0Afont%2Dstyle%3A%20italic%3B%0A%7D%0Ap%2Ecopyright%20%7B%0Afont%2Dsize%3A%20smaller%3B%0A%7D%0A%2Ecenter%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%2Efootnote%20%7B%0Afont%2Dsize%3A%20smaller%3B%0Amargin%2Dleft%3A%202em%3B%0A%7D%0Aa%20img%20%7B%0Aborder%2Dstyle%3A%20none%3B%0Aborder%2Dwidth%3A%200%3B%0A%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20navy%3B%0A%7D%0Aa%3Alink%20%7B%0Acolor%3A%20navy%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20red%3B%0Atext%2Ddecoration%3A%20underline%3B%0A%7D%0Aa%3Aactive%20%7B%0Acolor%3A%20red%3B%0Atext%2Ddecoration%3A%20underline%3B%0A%7D%0Aa%20%7B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0A%2Etoolbar%20a%3Alink%20%7B%0Acolor%3A%20blue%3B%0A%7D%0A%2Etoolbar%20a%3Avisited%20%7B%0Acolor%3A%20blue%3B%0A%7D%0A%2Etoolbar%20a%3Aactive%20%7B%0Acolor%3A%20red%3B%0A%7D%0A%2Etoolbar%20a%3Ahover%20%7B%0Acolor%3A%20red%3B%0A%7D%0Aul%20%7B%0Alist%2Dstyle%2Dtype%3A%20square%3B%0A%7D%0Aul%20ul%20%7B%0Alist%2Dstyle%2Dtype%3A%20disc%3B%0A%7D%0Aul%20ul%20ul%20%7B%0Alist%2Dstyle%2Dtype%3A%20circle%3B%0A%7D%0Aul%20ul%20ul%20ul%20%7B%0Alist%2Dstyle%2Dtype%3A%20disc%3B%0A%7D%0Ali%20%7B%0Amargin%2Dleft%3A%200%2E5em%3B%0Amargin%2Dtop%3A%200%2E5em%3B%20%7D%0Ali%20li%20%7B%0Afont%2Dsize%3A%2085%25%3B%0Afont%2Dstyle%3A%20italic%3B%0A%7D%0Ali%20li%20li%20%7B%0Afont%2Dsize%3A%2085%25%3B%0Afont%2Dstyle%3A%20normal%3B%0A%7D%0Adiv%20dt%0A%7B%0Afont%2Dweight%3A%20bold%3B%0Amargin%2Dbottom%3A%200%2E5em%3B%0Amargin%2Dleft%3A%200%3B%0Amargin%2Dtop%3A%201em%3B%0A%7D%0Adiv%20dd%0A%7B%0Amargin%2Dbottom%3A%200%2E5em%3B%0Amargin%2Dleft%3A%202em%3B%0A%7D%0Ap%2Cpre%2Cul%2Col%2Cblockquote%2Ch2%2Ch3%2Ch4%2Ch5%2Ch6%2Cdl%2Ctable%20%7B%0Amargin%2Dleft%3A%201em%3B%0Amargin%2Dright%3A%201em%3B%0A%7D%0A%2Esubhead%20%7B%0Afont%2Dweight%3A%20bold%3B%0Amargin%2Dtop%3A%202em%3B%0A%7D%0A%2Esmaller%20%7B%0Afont%2Dsize%3A%20smaller%3B%0A%7D%0A%2Ebigger%20%7B%0Afont%2Dsize%3A%20130%25%3B%0A%7D%0Atd%2Cth%20%7B%0Apadding%3A%200%2E2em%3B%0A%7D%0Aul%20%7B%0Amargin%3A%200%2E5em%201%2E5em%200%2E5em%201%2E5em%3B%0Apadding%3A%200%3B%0A%7D%0Aol%20%7B%0Amargin%3A%200%2E5em%201%2E5em%200%2E5em%201%2E5em%3B%0Apadding%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Aline%2Dheight%3A%20140%25%3B%0Alist%2Dstyle%3A%20square%3B%0Amargin%3A%200%2E1em%200%200%2E6em%200%3B%0Apadding%3A%200%200%200%200%3B%0A%7D%0Aol%20li%20%7B%20line%2Dheight%3A%20140%25%3B%0Alist%2Dstyle%2Dtype%3A%20decimal%3B%0Amargin%3A%200%2E1em%200%200%2E6em%201%2E5em%3B%0Apadding%3A%200%200%200%200%3B%0A%7D%0Ali%20ul%20li%20%7B%20background%3A%20transparent%3B%0Afont%2Dsize%3A%2085%25%3B%20font%2Dstyle%3A%20italic%3B%0Alist%2Dstyle%2Dtype%3A%20disc%3B%0Apadding%3A%200%200%200%200%3B%0A%7D%0Ali%20li%20ul%20li%20%7B%20background%3A%20transparent%3B%0Afont%2Dsize%3A%2085%25%3B%20font%2Dstyle%3A%20normal%3B%0Alist%2Dstyle%2Dtype%3A%20circle%3B%0Apadding%3A%200%200%200%200%3B%0A%7D%0Ali%20li%20li%20ul%20li%20%7B%0Abackground%3A%20transparent%3B%0Alist%2Dstyle%2Dtype%3A%20disc%3B%0Apadding%3A%200%200%200%200%3B%0A%7D%0Ali%20ol%20li%20%7B%0Alist%2Dstyle%2Dtype%3A%20decimal%3B%0A%7D%0Ali%20li%20ol%20li%20%7B%0Alist%2Dstyle%2Dtype%3A%20decimal%3B%0A%7D%0A%0Aol%2Eoutline%20li%3Ahover%20%7B%0Acursor%3A%20pointer%3B%0A%7D%0Aol%2Eoutline%20li%2Enofold%3Ahover%20%7B%0Acursor%3A%20default%3B%0A%7D%0Aul%2Eoutline%20li%3Ahover%20%7B%0Acursor%3A%20pointer%3B%0A%7D%0Aul%2Eoutline%20li%2Enofold%3Ahover%20%7B%0Acursor%3A%20default%3B%0A%7D%0Aol%2Eoutline%20%7B%0Alist%2Dstyle%3Adecimal%3B%0A%7D%0Aol%2Eoutline%20ol%20%7B%0Alist%2Dstyle%2Dtype%3Alower%2Dalpha%3B%0A%7D%0Aol%2Eoutline%20li%2Enofold%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAIACAMzMzOvr%2FywAAAAACQAJAAACD4SPoRvG614Dctb4MEMcFAA7%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0Aol%2Eoutline%20li%2Eunfolded%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAKEDAMPD%2F8zMzOvr%2F%2F%2F%2F%2FywAAAAACQAJAAACEYyPoivG614LAlg7ZZbxoR8UADs%3D%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0Aol%2Eoutline%20li%2Efolded%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAKEDAMPD%2F8zMzOvr%2F%2F%2F%2F%2FywAAAAACQAJAAACFIyPoiu2sJyCyoF7W3hxz850CFIAADs%3D%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0Aol%2Eoutline%20li%2Eunfolded%3Ahover%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAKEDAAAAAAAA%2F8PD%2F%2F%2F%2F%2FywAAAAACQAJAAACEYSPoivG614DIlg7ZZbxoQ8UADs%3D%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0Aol%2Eoutline%20li%2Efolded%3Ahover%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAKEDAAAAAAAA%2F8PD%2F%2F%2F%2F%2FywAAAAACQAJAAACFISPoiu2sZyCyoV7G3hxz850CFIAADs%3D%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0Aul%2Eoutline%20li%2Enofold%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAIACAMzMzOvr%2FywAAAAACQAJAAACD4SPoRvG614Dctb4MEMcFAA7%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0Aul%2Eoutline%20li%2Eunfolded%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAKEDAMPD%2F8zMzOvr%2F%2F%2F%2F%2FywAAAAACQAJAAACEYyPoivG614LAlg7ZZbxoR8UADs%3D%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0Aul%2Eoutline%20li%2Efolded%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAKEDAMPD%2F8zMzOvr%2F%2F%2F%2F%2FywAAAAACQAJAAACFIyPoiu2sJyCyoF7W3hxz850CFIAADs%3D%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0Aul%2Eoutline%20li%2Eunfolded%3Ahover%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAKEDAAAAAAAA%2F8PD%2F%2F%2F%2F%2FywAAAAACQAJAAACEYSPoivG614DIlg7ZZbxoQ8UADs%3D%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0Aul%2Eoutline%20li%2Efolded%3Ahover%20%7B%0Abackground%3A%20transparent%20url%28data%3Aimage%2Fgif%3Bbase64%2CR0lGODdhCQAJAKEDAAAAAAAA%2F8PD%2F%2F%2F%2F%2FywAAAAACQAJAAACFISPoiu2sZyCyoV7G3hxz850CFIAADs%3D%29%20no%2Drepeat%200%200%2E5em%3B%0Apadding%3A%200%200%200%2020px%3B%0A%7D%0A%0Aa%2Etitleslide%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dstyle%3A%20italic%0A%7D%0A%0Aimg%2Ehidden%20%7B%0Adisplay%3A%20none%3B%0Avisibility%3A%20hidden%3B%0A%7D%0Adiv%2Einitial%5Fprompt%20%7B%0Adisplay%3A%20none%3B%0Avisibility%3A%20hidden%3B%0A%7D%0Adiv%2Eslide%20%7B%0Avisibility%3A%20visible%3B%0Aposition%3A%20inherit%3B%0A%7D%0Adiv%2Ehandout%20%7B%0Aborder%2Dtop%2Dstyle%3A%20solid%3B%0Aborder%2Dtop%2Dwidth%3A%20thin%3B%0Aborder%2Dtop%2Dcolor%3A%20black%3B%0A%7D%0A%40media%20screen%20%7B%0A%2Ehidden%20%7B%20display%3A%20none%3B%20visibility%3A%20visible%20%7D%0Adiv%2Eslide%2Ehidden%20%7B%0Adisplay%3A%20block%3B%0Avisibility%3A%20visible%0A%7D%0Adiv%2Ehandout%2Ehidden%20%7B%0Adisplay%3A%20block%3B%0Avisibility%3A%20visible%0A%7D%0Adiv%2Ebackground%20%7B%0Adisplay%3A%20none%3B%0Avisibility%3A%20hidden%3B%0A%7D%0Abody%2Esingle%5Fslide%20div%2Einitial%5Fprompt%20%7B%0Adisplay%3A%20block%3B%0Avisibility%3A%20visible%3B%0A%7D%0Abody%2Esingle%5Fslide%20div%2Ebackground%20%7B%20display%3A%20block%3B%0Avisibility%3A%20visible%3B%0A%7D%0Abody%2Esingle%5Fslide%20div%2Ebackground%2Ehidden%20%7B%0Adisplay%3A%20none%3B%0Avisibility%3A%20hidden%3B%0A%7D%0Abody%2Esingle%5Fslide%20%2Einvisible%20%7B%0Avisibility%3A%20hidden%3B%0A%7D%0Abody%2Esingle%5Fslide%20%2Ehidden%20%7B%0Adisplay%3A%20none%3B%0Avisibility%3A%20hidden%3B%0A%7D%0Abody%2Esingle%5Fslide%20div%2Eslide%20%7B%0Aposition%3A%20absolute%3B%0A%7D%0Abody%2Esingle%5Fslide%20div%2Ehandout%20%7B%0Adisplay%3A%20none%3B%0Avisibility%3A%20hidden%3B%0A%7D%0A%7D%0A%40media%20print%20%7B%0A%2Ehidden%20%7B%0Adisplay%3A%20block%3B%0Avisibility%3A%20visible%3B%0A%7D%0Adiv%2Eslide%20pre%20%7B%0Afont%2Dsize%3A%2060%25%3B%0Apadding%2Dleft%3A%200%2E5em%3B%0A%7D%0Adiv%2Etoolbar%20%7B%0Adisplay%3A%20none%3B%0Avisibility%3A%20hidden%3B%0A%7D%0Adiv%2Eslidy%5Ftoc%20%7B%0Adisplay%3A%20none%3B%0Avisibility%3A%20hidden%3B%0A%7D%0Adiv%2Ebackground%20%7B%0Adisplay%3A%20none%3B%0Avisibility%3A%20hidden%3B%0A%7D%0Adiv%2Eslide%20%7B%0Apage%2Dbreak%2Dbefore%3A%20always%0A%7D%0A%0Adiv%2Eslide%2Efirst%2Dslide%20%7B%0Apage%2Dbreak%2Dbefore%3A%20avoid%0A%7D%0A%7D%0A%0Atable%2C%20th%2C%20td%20%7B%0Aborder%3A%201px%20solid%20black%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20%7B%0Amargin%2Dleft%3A%20auto%3B%0Amargin%2Dright%3A%20auto%3B%0Awidth%3A%2050%25%3B%0A%7D%0Ath%2C%20td%20%7B%0Aheight%3A%201em%3B%0Atext%2Dalign%3A%20center%3B%0Avertical%2Dalign%3A%20middle%3B%0A%7D%0Amath%2Einline%20%7B%0Apadding%3A%20auto%3B%0A%7D%0A%2Ecolumn1highlight%20th%3Anth%2Dchild%282%29%2C%20%2Ecolumn1highlight%20td%3Anth%2Dchild%282%29%20%7B%0Abackground%2Dcolor%3A%20lightgray%3B%0A%7D%0A%2Ecolumn2highlight%20th%3Anth%2Dchild%283%29%2C%20%2Ecolumn2highlight%20td%3Anth%2Dchild%283%29%20%7B%0Abackground%2Dcolor%3A%20lightgray%3B%0A%7D%0A%2Ecolumn3highlight%20th%3Anth%2Dchild%284%29%2C%20%2Ecolumn3highlight%20td%3Anth%2Dchild%284%29%20%7B%0Abackground%2Dcolor%3A%20lightgray%3B%0A%7D%0A%2Ecolumn4highlight%20th%3Anth%2Dchild%285%29%2C%20%2Ecolumn4highlight%20td%3Anth%2Dchild%285%29%20%7B%0Abackground%2Dcolor%3A%20lightgray%3B%0A%7D%0A%2Eevidence%20tr%3Anth%2Dchild%283%29%20td%3Anth%2Dchild%284%29%20%7B%0Abackground%2Dcolor%3A%20pink%3B%0A%7D%0A" />
  <script src="data:application/javascript;base64,Lyogc2xpZHkuanMKCiAgIENvcHlyaWdodCAoYykgMjAwNS0yMDEzIFczQyAoTUlULCBFUkNJTSwgS2VpbyksIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAgIFczQyBsaWFiaWxpdHksIHRyYWRlbWFyaywgZG9jdW1lbnQgdXNlIGFuZCBzb2Z0d2FyZSBsaWNlbnNpbmcKICAgcnVsZXMgYXBwbHksIHNlZToKCiAgIGh0dHA6Ly93d3cudzMub3JnL0NvbnNvcnRpdW0vTGVnYWwvY29weXJpZ2h0LWRvY3VtZW50cwogICBodHRwOi8vd3d3LnczLm9yZy9Db25zb3J0aXVtL0xlZ2FsL2NvcHlyaWdodC1zb2Z0d2FyZQoKICAgRGVmaW5lcyBzaW5nbGUgbmFtZSAidzNjX3NsaWR5IiBpbiBnbG9iYWwgbmFtZXNwYWNlCiAgIEFkZHMgZXZlbnQgaGFuZGxlcnMgd2l0aG91dCB0cmFtcGxpbmcgb24gYW55IG90aGVycwoqLwoKLy8gdGhlIHNsaWR5IG9iamVjdCBpbXBsZW1lbnRhdGlvbgpjb25zdCB3M2NTbGlkeSA9IHsKICAvLyBjbGFzc2lmeSB3aGljaCBraW5kIG9mIGJyb3dzZXIgd2UncmUgcnVubmluZyB1bmRlcgogIG5zX3BvczogKHR5cGVvZiB3aW5kb3cucGFnZVlPZmZzZXQgIT09ICd1bmRlZmluZWQnKSwKICBraHRtbDogISEoKG5hdmlnYXRvci51c2VyQWdlbnQpLmluZGV4T2YoJ0tIVE1MJykgPj0gMCksCiAgb3BlcmE6ICEhKChuYXZpZ2F0b3IudXNlckFnZW50KS5pbmRleE9mKCdPcGVyYScpID49IDApLAogIGlwYWQ6ICEhKChuYXZpZ2F0b3IudXNlckFnZW50KS5pbmRleE9mKCdpUGFkJykgPj0gMCksCiAgaXBob25lOiAhISgobmF2aWdhdG9yLnVzZXJBZ2VudCkuaW5kZXhPZignaVBob25lJykgPj0gMCksCiAgYW5kcm9pZDogISEoKG5hdmlnYXRvci51c2VyQWdlbnQpLmluZGV4T2YoJ0FuZHJvaWQnKSA+PSAwKSwKICBpZTogKHR5cGVvZiBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpICE9PSAndW5kZWZpbmVkJyAmJiAhdGhpcy5vcGVyYSksCiAgaWU2OiAoIXRoaXMubnNfcG9zICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignTVNJRSA2JykgIT09IC0xKSwKICBpZTc6ICghdGhpcy5uc19wb3MgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFIDcnKSAhPT0gLTEpLAogIGllODogKCF0aGlzLm5zX3BvcyAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ01TSUUgOCcpICE9PSAtMSksCiAgaWU5OiAoIXRoaXMubnNfcG9zICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignTVNJRSA5JykgIT09IC0xKSwKCiAgLy8gZGF0YSBmb3Igc3dpcGUgYW5kIGRvdWJsZSB0YXAgZGV0ZWN0aW9uIG9uIHRvdWNoIHNjcmVlbnMKICBsYXN0X3RhcDogMCwKICBwcmV2X3RhcDogMCwKICBzdGFydF94OiAwLAogIHN0YXJ0X3k6IDAsCiAgZGVsdGFfeDogMCwKICBkZWx0YV95OiAwLAoKICAvLyBhcmUgd2UgcnVubmluZyBhcyBYSFRNTD8gKGRvZXNuJ3Qgd29yayBvbiBPcGVyYSkKICBpc194aHRtbDogL3htbC8udGVzdChkb2N1bWVudC5jb250ZW50VHlwZSksCgogIHNsaWRlX251bWJlcjogMCwgLy8gaW50ZWdlciBzbGlkZSBjb3VudDogMCwgMSwgMiwgLi4uCiAgc2xpZGVfbnVtYmVyX2VsZW1lbnQ6IG51bGwsIC8vIGVsZW1lbnQgY29udGFpbmluZyBzbGlkZSBudW1iZXIKICBzbGlkZXM6IFtdLCAvLyBzZXQgdG8gYXJyYXkgb2Ygc2xpZGUgZGl2J3MKICBub3RlczogW10sIC8vIHNldCB0byBhcnJheSBvZiBoYW5kb3V0IGRpdidzCiAgYmFja2dyb3VuZHM6IFtdLCAvLyBzZXQgdG8gYXJyYXkgb2YgYmFja2dyb3VuZCBkaXYncwogIG9ic2VydmVyczogW10sIC8vIGxpc3Qgb2Ygb2JzZXJ2ZXIgZnVuY3Rpb25zCiAgdG9vbGJhcjogbnVsbCwgLy8gZWxlbWVudCBjb250YWluaW5nIHRvb2xiYXIKICB0aXRsZTogbnVsbCwgLy8gZG9jdW1lbnQgdGl0bGUKICBsYXN0X3Nob3duOiBudWxsLCAvLyBsYXN0IGluY3JlbWVudGFsbHkgc2hvd24gaXRlbQogIGVvczogbnVsbCwgLy8gc3BhbiBlbGVtZW50IGZvciBlbmQgb2Ygc2xpZGUgaW5kaWNhdG9yCiAgdG9jOiBudWxsLCAvLyB0YWJsZSBvZiBjb250ZW50cwogIG91dGxpbmU6IG51bGwsIC8vIG91dGxpbmUgZWxlbWVudCB3aXRoIHRoZSBmb2N1cwogIHNlbGVjdGVkX3RleHRfbGVuOiAwLCAvLyBsZW5ndGggb2YgZHJhZyBzZWxlY3Rpb24gb24gZG9jdW1lbnQKICB2aWV3X2FsbDogMCwgLy8gMSB0byB2aWV3IGFsbCBzbGlkZXMgKyBoYW5kb3V0cwogIHdhbnRfdG9vbGJhcjogdHJ1ZSwgLy8gdXNlciBwcmVmZXJlbmNlIHRvIHNob3cvaGlkZSB0b29sYmFyCiAgbW91c2VfY2xpY2tfZW5hYmxlZDogdHJ1ZSwgLy8gZW5hYmxlcyBsZWZ0IGNsaWNrIGZvciBuZXh0IHNsaWRlCiAgc2Nyb2xsX2hhY2s6IDAsIC8vIElFIHdvcmsgYXJvdW5kIGZvciBwb3NpdGlvbjogZml4ZWQKICBkaXNhYmxlX3NsaWRlX2NsaWNrOiBmYWxzZSwgLy8gdXNlZCBieSBjbGlja2VkIGFuY2hvcnMKCiAgbGVmdGNsaWNrOiBmYWxzZSwKICBtaWRkbGVjbGljazogZmFsc2UsCiAgcmlnaHRjbGljazogZmFsc2UsCgogIGxhbmc6ICdlbicsIC8vIHVwZGF0ZWQgdG8gbGFuZ3VhZ2Ugc3BlY2lmaWVkIGJ5IGh0bWwgZmlsZQoKICBoZWxwX2FuY2hvcjogbnVsbCwgLy8gdXNlZCBmb3Iga2V5Ym9hcmQgZm9jdXMgaGFjayBpbiBzaG93VG9vbGJhcigpCiAgaGVscF9wYWdlOiAnaHR0cDovL3d3dy53My5vcmcvVGFsa3MvVG9vbHMvU2xpZHkyL2hlbHAvaGVscC5odG1sJywKICBoZWxwX3RleHQ6ICdOYXZpZ2F0ZSB3aXRoIG1vdXNlIGNsaWNrLCBzcGFjZSBiYXIsIEN1cnNvciBMZWZ0L1JpZ2h0LCAnICsKICAgICdvciBQZyBVcCBhbmQgUGcgRG4uIFVzZSBTIGFuZCBCIHRvIGNoYW5nZSBmb250IHNpemUuJywKCiAgc2l6ZV9pbmRleDogMCwKICBzaXplX2FkanVzdG1lbnQ6IDAsCiAgc2l6ZXM6IFsnMTBwdCcsICcxMnB0JywgJzE0cHQnLCAnMTZwdCcsICcxOHB0JywgJzIwcHQnLAogICAgJzIycHQnLCAnMjRwdCcsICcyNnB0JywgJzI4cHQnLCAnMzBwdCcsICczMnB0J10sCgogIC8vIG5lZWRlZCBmb3IgZWZmaWNpZW50IHJlc2l6aW5nCiAgbGFzdF93aWR0aDogMCwKICBsYXN0X2hlaWdodDogMCwKCiAgLy8gTmVlZGVkIGZvciBjcm9zcyBicm93c2VyIHN1cHBvcnQgZm9yIHJlbGF0aXZlIHdpZHRoL2hlaWdodCBvbgogIC8vIG9iamVjdCBlbGVtZW50cy4gVGhlIHdvcmsgYXJvdW5kIGlzIHRvIHNhdmUgd2lkdGgvaGVpZ2h0IGF0dHJpYnV0ZXMKICAvLyBhbmQgdGhlbiB0byByZWNvbXB1dGUgYWJzb2x1dGUgd2lkdGgvaGVpZ2h0IGRpbWVuc2lvbnMgb24gcmVzaXppbmcKICBvYmplY3RzOiBbXSwKCiAgLy8gYXR0YWNoIGluaXRpYWxpemF0aW9uIGV2ZW50IGhhbmRsZXJzCiAgc2V0X3VwOiBmdW5jdGlvbiAoKSB7CiAgICBjb25zdCBpbml0ID0gZnVuY3Rpb24gKCkgeyB3M2NTbGlkeS5pbml0KCkgfQogICAgaWYgKHR5cGVvZiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBpbml0LCBmYWxzZSkKICAgIH0gZWxzZSB7IHdpbmRvdy5hdHRhY2hFdmVudCgnb25sb2FkJywgaW5pdCkgfQogIH0sCgogIGhpZGVfc2xpZGVzOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAoZG9jdW1lbnQuYm9keSAmJiAhdzNjU2xpZHkuaW5pdGlhbGl6ZWQpIHsKICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbicKICAgIH0gZWxzZSB7IHNldFRpbWVvdXQodzNjU2xpZHkuaGlkZV9zbGlkZXMsIDUwKSB9CiAgfSwKCiAgLy8gaGFjayB0byBwZXJzdWFkZSBJRSB0byBjb21wdXRlIGNvcnJlY3QgZG9jdW1lbnQgaGVpZ2h0CiAgLy8gYXMgbmVlZGVkIGZvciBzaW11bGF0aW5nIGZpeGVkIHBvc2l0aW9uaW5nIG9mIHRvb2xiYXIKICBpZV9oYWNrOiBmdW5jdGlvbiAoKSB7CiAgICB3aW5kb3cucmVzaXplQnkoMCwgLTEpCiAgICB3aW5kb3cucmVzaXplQnkoMCwgMSkKICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICAvLyBhbGVydCgic2xpZHkgc3RhcnRpbmcgdGVzdCAxMCIpOwogICAgZG9jdW1lbnQuYm9keS5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnCiAgICB0aGlzLmluaXRfbG9jYWxpemF0aW9uKCkKICAgIHRoaXMuYWRkX3Rvb2xiYXIoKQogICAgdGhpcy53cmFwX2ltcGxpY2l0X3NsaWRlcygpCiAgICB0aGlzLmNvbGxlY3Rfc2xpZGVzKCkKICAgIHRoaXMuY29sbGVjdF9ub3RlcygpCiAgICB0aGlzLmNvbGxlY3RfYmFja2dyb3VuZHMoKQogICAgdGhpcy5vYmplY3RzID0gZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb2JqZWN0JykKICAgIHRoaXMucGF0Y2hfYW5jaG9ycygpCiAgICB0aGlzLnNsaWRlX251bWJlciA9IHRoaXMuZmluZF9zbGlkZV9udW1iZXIobG9jYXRpb24uaHJlZikKICAgIHdpbmRvdy5vZmZzY3JlZW5idWZmZXJpbmcgPSB0cnVlCiAgICB0aGlzLnNpemVfYWRqdXN0bWVudCA9IHRoaXMuZmluZF9zaXplX2FkanVzdCgpCiAgICB0aGlzLnRpbWVfbGVmdCA9IHRoaXMuZmluZF9kdXJhdGlvbigpCiAgICB0aGlzLmhpZGVfaW1hZ2VfdG9vbGJhcigpIC8vIHN1cHByZXNzIElFIGltYWdlIHRvb2xiYXIgcG9wdXAKICAgIHRoaXMuaW5pdF9vdXRsaW5lcigpIC8vIGFjdGl2YXRlIGZvbGQvdW5mb2xkIHN1cHBvcnQKICAgIHRoaXMudGl0bGUgPSBkb2N1bWVudC50aXRsZQogICAgdGhpcy5rZXlib2FyZGxlc3MgPSAodGhpcy5pcGFkIHx8IHRoaXMuaXBob25lIHx8IHRoaXMuYW5kcm9pZCkKCiAgICBpZiAodGhpcy5rZXlib2FyZGxlc3MpIHsKICAgICAgdzNjU2xpZHkucmVtb3ZlX2NsYXNzKHczY1NsaWR5LnRvb2xiYXIsICdoaWRkZW4nKQogICAgICB0aGlzLndhbnRfdG9vbGJhciA9IDAKICAgIH0KCiAgICAvLyB3b3JrIGFyb3VuZCBmb3Igb3BlcmEgYnVnCiAgICB0aGlzLmlzX3hodG1sID0gISEoZG9jdW1lbnQuYm9keS50YWdOYW1lID09PSAnQk9EWScpCgogICAgaWYgKHRoaXMuc2xpZGVzLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3Qgc2xpZGUgPSB0aGlzLnNsaWRlc1t0aGlzLnNsaWRlX251bWJlcl0KCiAgICAgIGlmICh0aGlzLnNsaWRlX251bWJlciA+IDApIHsKICAgICAgICB0aGlzLnNldF92aXNpYmlsaXR5X2FsbF9pbmNyZW1lbnRhbCgndmlzaWJsZScpCiAgICAgICAgdGhpcy5sYXN0X3Nob3duID0gdGhpcy5wcmV2aW91c19pbmNyZW1lbnRhbF9pdGVtKG51bGwpCiAgICAgICAgdGhpcy5zZXRfZW9zX3N0YXR1cyh0cnVlKQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubGFzdF9zaG93biA9IG51bGwKICAgICAgICB0aGlzLnNldF92aXNpYmlsaXR5X2FsbF9pbmNyZW1lbnRhbCgnaGlkZGVuJykKICAgICAgICB0aGlzLnNldF9lb3Nfc3RhdHVzKCF0aGlzLm5leHRfaW5jcmVtZW50YWxfaXRlbSh0aGlzLmxhc3Rfc2hvd24pKQogICAgICB9CgogICAgICB0aGlzLnNldF9sb2NhdGlvbigpCiAgICAgIHRoaXMuYWRkX2NsYXNzKHRoaXMuc2xpZGVzWzBdLCAnZmlyc3Qtc2xpZGUnKQogICAgICB3M2NTbGlkeS5zaG93X3NsaWRlKHNsaWRlKQogICAgfQoKICAgIHRoaXMudG9jID0gdGhpcy50YWJsZV9vZl9jb250ZW50cygpCgogICAgdGhpcy5hZGRfaW5pdGlhbF9wcm9tcHQoKQoKICAgIC8vIGJpbmQgZXZlbnQgaGFuZGxlcnMgd2l0aG91dCBpbnRlcmZlcmluZyB3aXRoIGN1c3RvbSBwYWdlIHNjcmlwdHMKICAgIC8vIFRhcCBldmVudHMgYmVoYXZlIHRvbyB3ZWlyZGx5IHRvIHN1cHBvcnQgY2xpY2tzIHJlbGlhYmx5IG9uCiAgICAvLyBpUGhvbmUgYW5kIGlQYWQsIHNvIGV4Y2x1ZGUgdGhlc2UgZnJvbSBjbGljayBoYW5kbGVyCgogICAgaWYgKCF0aGlzLmtleWJvYXJkbGVzcykgewogICAgICB0aGlzLmFkZF9saXN0ZW5lcihkb2N1bWVudC5ib2R5LCAnY2xpY2snLCB0aGlzLm1vdXNlX2J1dHRvbl9jbGljaykKICAgICAgdGhpcy5hZGRfbGlzdGVuZXIoZG9jdW1lbnQuYm9keSwgJ21vdXNlZG93bicsIHRoaXMubW91c2VfYnV0dG9uX2Rvd24pCiAgICB9CgogICAgdGhpcy5hZGRfbGlzdGVuZXIoZG9jdW1lbnQsICdrZXlkb3duJywgdGhpcy5rZXlfZG93bikKICAgIHRoaXMuYWRkX2xpc3RlbmVyKGRvY3VtZW50LCAna2V5cHJlc3MnLCB0aGlzLmtleV9wcmVzcykKICAgIHRoaXMuYWRkX2xpc3RlbmVyKHdpbmRvdywgJ3Jlc2l6ZScsIHRoaXMucmVzaXplZCkKICAgIHRoaXMuYWRkX2xpc3RlbmVyKHdpbmRvdywgJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsZWQpCiAgICB0aGlzLmFkZF9saXN0ZW5lcih3aW5kb3csICd1bmxvYWQnLCB0aGlzLnVubG9hZGVkKQoKICAgIHRoaXMuYWRkX2xpc3RlbmVyKGRvY3VtZW50LCAnZ2VzdHVyZWNoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9KQoKICAgIHRoaXMuYXR0YWNoX3RvdWNoX2hhbmRlcnModGhpcy5zbGlkZXMpCgogICAgLy8gdGhpcyBzZWVtcyB0byBiZSBhIGRlYnVnZ2luZyBoYWNrCiAgICAvLyBpZiAoIWRvY3VtZW50LmJvZHkub25jbGljaykKICAgIC8vICBkb2N1bWVudC5ib2R5Lm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7IH07CgogICAgdGhpcy5zaW5nbGVfc2xpZGVfdmlldygpCgogICAgLy8gdGhpcy5zZXRfbG9jYXRpb24oKTsKCiAgICB0aGlzLnJlc2l6ZWQoKQoKICAgIGlmICh0aGlzLmllNykgeyBzZXRUaW1lb3V0KHczY1NsaWR5LmllX2hhY2ssIDEwMCkgfQoKICAgIHRoaXMuc2hvd190b29sYmFyKCkKCiAgICAvLyBmb3IgYmFjayBidXR0b24gZGV0ZWN0aW9uCiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7IHczY1NsaWR5LmNoZWNrX2xvY2F0aW9uKCkgfSwgMjAwKQogICAgdzNjU2xpZHkuaW5pdGlhbGl6ZWQgPSB0cnVlCiAgfSwKCiAgLy8gY3JlYXRlIGRpdiBlbGVtZW50IHdpdGggbGlua3MgdG8gZWFjaCBzbGlkZQogIHRhYmxlX29mX2NvbnRlbnRzOiBmdW5jdGlvbiAoKSB7CiAgICBjb25zdCB0b2MgPSB0aGlzLmNyZWF0ZV9lbGVtZW50KCdkaXYnKQogICAgdGhpcy5hZGRfY2xhc3ModG9jLCAnc2xpZHlfdG9jIGhpZGRlbicpCiAgICAvLyB0b2Muc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7CgogICAgY29uc3QgaGVhZGluZyA9IHRoaXMuY3JlYXRlX2VsZW1lbnQoJ2RpdicpCiAgICB0aGlzLmFkZF9jbGFzcyhoZWFkaW5nLCAndG9jLWhlYWRpbmcnKQogICAgaGVhZGluZy5pbm5lckhUTUwgPSB0aGlzLmxvY2FsaXplKCdUYWJsZSBvZiBDb250ZW50cycpCgogICAgdG9jLmFwcGVuZENoaWxkKGhlYWRpbmcpCiAgICBsZXQgcHJldmlvdXMgPSBudWxsCgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNsaWRlcy5sZW5ndGg7ICsraSkgewogICAgICBjb25zdCB0aXRsZSA9IHRoaXMuaGFzX2NsYXNzKHRoaXMuc2xpZGVzW2ldLCAndGl0bGUnKQogICAgICBjb25zdCBudW0gPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgoaSArIDEpICsgJy4gJykKCiAgICAgIHRvYy5hcHBlbmRDaGlsZChudW0pCgogICAgICBjb25zdCBhID0gdGhpcy5jcmVhdGVfZWxlbWVudCgnYScpCiAgICAgIGEuc2V0QXR0cmlidXRlKCdocmVmJywgJyMoJyArIChpICsgMSkgKyAnKScpCgogICAgICBpZiAodGl0bGUpIHsgdGhpcy5hZGRfY2xhc3MoYSwgJ3RpdGxlc2xpZGUnKSB9CgogICAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGhpcy5zbGlkZV9uYW1lKGkpKQogICAgICBhLmFwcGVuZENoaWxkKG5hbWUpCiAgICAgIGEub25jbGljayA9IHczY1NsaWR5LnRvY19jbGljawogICAgICBhLm9ua2V5ZG93biA9IHczY1NsaWR5LnRvY19rZXlfZG93bgogICAgICBhLnByZXZpb3VzID0gcHJldmlvdXMKCiAgICAgIGlmIChwcmV2aW91cykgeyBwcmV2aW91cy5uZXh0ID0gYSB9CgogICAgICB0b2MuYXBwZW5kQ2hpbGQoYSkKCiAgICAgIGlmIChpID09PSAwKSB7IHRvYy5maXJzdCA9IGEgfQoKICAgICAgaWYgKGkgPCB0aGlzLnNsaWRlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgY29uc3QgYnIgPSB0aGlzLmNyZWF0ZV9lbGVtZW50KCdicicpCiAgICAgICAgdG9jLmFwcGVuZENoaWxkKGJyKQogICAgICB9CgogICAgICBwcmV2aW91cyA9IGEKICAgIH0KCiAgICB0b2MuZm9jdXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLmZpcnN0KSB7IHRoaXMuZmlyc3QuZm9jdXMoKSB9CiAgICB9CgogICAgdG9jLm9ubW91c2V1cCA9IHczY1NsaWR5Lm1vdXNlX2J1dHRvbl91cAoKICAgIHRvYy5vbmNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgZSB8fCAoZSA9IHdpbmRvdy5ldmVudCkKCiAgICAgIGlmICh3M2NTbGlkeS5zZWxlY3RlZF90ZXh0X2xlbiA8PSAwKSB7CiAgICAgICAgdzNjU2xpZHkuaGlkZV90YWJsZV9vZl9jb250ZW50cyh0cnVlKQogICAgICB9CgogICAgICB3M2NTbGlkeS5zdG9wX3Byb3BhZ2F0aW9uKGUpCgogICAgICBpZiAoZS5jYW5jZWwgIT09IHVuZGVmaW5lZCkgeyBlLmNhbmNlbCA9IHRydWUgfQoKICAgICAgaWYgKGUucmV0dXJuVmFsdWUgIT09IHVuZGVmaW5lZCkgeyBlLnJldHVyblZhbHVlID0gZmFsc2UgfQoKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CgogICAgZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUodG9jLCBkb2N1bWVudC5ib2R5LmZpcnN0Q2hpbGQpCiAgICByZXR1cm4gdG9jCiAgfSwKCiAgaXNfc2hvd25fdG9jOiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gIXczY1NsaWR5Lmhhc19jbGFzcyh3M2NTbGlkeS50b2MsICdoaWRkZW4nKQogIH0sCgogIHNob3dfdGFibGVfb2ZfY29udGVudHM6IGZ1bmN0aW9uICgpIHsKICAgIHczY1NsaWR5LnJlbW92ZV9jbGFzcyh3M2NTbGlkeS50b2MsICdoaWRkZW4nKQogICAgY29uc3QgdG9jID0gdzNjU2xpZHkudG9jCiAgICB0b2MuZm9jdXMoKQoKICAgIGlmICh3M2NTbGlkeS5pZTcgJiYgdzNjU2xpZHkuc2xpZGVfbnVtYmVyID09PSAwKSB7CiAgICAgIHNldFRpbWVvdXQodzNjU2xpZHkuaWVfaGFjaywgMTAwKQogICAgfQogIH0sCgogIGhpZGVfdGFibGVfb2ZfY29udGVudHM6IGZ1bmN0aW9uIChmb2N1cykgewogICAgdzNjU2xpZHkuYWRkX2NsYXNzKHczY1NsaWR5LnRvYywgJ2hpZGRlbicpCgogICAgaWYgKGZvY3VzICYmICF3M2NTbGlkeS5vcGVyYSAmJgogICAgICAhdzNjU2xpZHkuaGFzX2NsYXNzKHczY1NsaWR5LnRvYywgJ2hpZGRlbicpKSB7CiAgICAgIHczY1NsaWR5LnNldF9mb2N1cygpCiAgICB9CiAgfSwKCiAgdG9nZ2xlX3RhYmxlX29mX2NvbnRlbnRzOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAodzNjU2xpZHkuaXNfc2hvd25fdG9jKCkpIHsKICAgICAgdzNjU2xpZHkuaGlkZV90YWJsZV9vZl9jb250ZW50cyh0cnVlKQogICAgfSBlbHNlIHsgdzNjU2xpZHkuc2hvd190YWJsZV9vZl9jb250ZW50cygpIH0KICB9LAoKICAvLyBjYWxsZWQgb24gY2xpY2tpbmcgdG9jIGVudHJ5CiAgdG9jX2NsaWNrOiBmdW5jdGlvbiAoZSkgewogICAgaWYgKCFlKSB7IGUgPSB3aW5kb3cuZXZlbnQgfQoKICAgIGNvbnN0IHRhcmdldCA9IHczY1NsaWR5LmdldF90YXJnZXQoZSkKCiAgICBpZiAodGFyZ2V0ICYmIHRhcmdldC5ub2RlVHlwZSA9PT0gMSkgewogICAgICBjb25zdCB1cmkgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJykKCiAgICAgIGlmICh1cmkpIHsKICAgICAgICAvLyBhbGVydCgiZ29pbmcgdG8gIiArIHVyaSk7CiAgICAgICAgbGV0IHNsaWRlID0gdzNjU2xpZHkuc2xpZGVzW3czY1NsaWR5LnNsaWRlX251bWJlcl0KICAgICAgICB3M2NTbGlkeS5oaWRlX3NsaWRlKHNsaWRlKQogICAgICAgIHczY1NsaWR5LnNsaWRlX251bWJlciA9IHczY1NsaWR5LmZpbmRfc2xpZGVfbnVtYmVyKHVyaSkKICAgICAgICBzbGlkZSA9IHczY1NsaWR5LnNsaWRlc1t3M2NTbGlkeS5zbGlkZV9udW1iZXJdCiAgICAgICAgdzNjU2xpZHkubGFzdF9zaG93biA9IG51bGwKICAgICAgICB3M2NTbGlkeS5zZXRfbG9jYXRpb24oKQogICAgICAgIHczY1NsaWR5LnNldF92aXNpYmlsaXR5X2FsbF9pbmNyZW1lbnRhbCgnaGlkZGVuJykKICAgICAgICB3M2NTbGlkeS5zZXRfZW9zX3N0YXR1cyghdzNjU2xpZHkubmV4dF9pbmNyZW1lbnRhbF9pdGVtKHczY1NsaWR5Lmxhc3Rfc2hvd24pKQogICAgICAgIHczY1NsaWR5LnNob3dfc2xpZGUoc2xpZGUpCiAgICAgICAgLy8gdGFyZ2V0LmZvY3VzKCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIXczY1NsaWR5Lm9wZXJhKSB7IHczY1NsaWR5LnNldF9mb2N1cygpIH0KICAgICAgICB9IGNhdGNoIChlKSB7IH0KICAgICAgfQogICAgfQoKICAgIHczY1NsaWR5LmhpZGVfdGFibGVfb2ZfY29udGVudHModHJ1ZSkKICAgIGlmICh3M2NTbGlkeS5pZTcpIHczY1NsaWR5LmllX2hhY2soKQogICAgdzNjU2xpZHkuc3RvcF9wcm9wYWdhdGlvbihlKQogICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChlKQogIH0sCgogIC8vIGNhbGxlZCBvbmtleWRvd24gZm9yIHRvYyBlbnRyeQogIHRvY19rZXlfZG93bjogZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBsZXQga2V5CgogICAgaWYgKCFldmVudCkgeyBldmVudCA9IHdpbmRvdy5ldmVudCB9CgogICAgLy8ga2x1ZGdlIGFyb3VuZCBOUy9JRSBkaWZmZXJlbmNlcwogICAgaWYgKHdpbmRvdy5ldmVudCkgewogICAgICBrZXkgPSB3aW5kb3cuZXZlbnQua2V5Q29kZQogICAgfSBlbHNlIGlmIChldmVudC53aGljaCkgewogICAgICBrZXkgPSBldmVudC53aGljaAogICAgfSBlbHNlIHsgcmV0dXJuIHRydWUgfSAvLyBZaWtlcyEgdW5rbm93biBicm93c2VyCgogICAgLy8gaWdub3JlIGV2ZW50IGlmIGtleSB2YWx1ZSBpcyB6ZXJvCiAgICAvLyBhcyBmb3IgYWx0IG9uIE9wZXJhIGFuZCBLb25xdWVyb3IKICAgIGlmICgha2V5KSB7IHJldHVybiB0cnVlIH0KCiAgICAvLyBjaGVjayBmb3IgY29uY3VycmVudCBjb250cm9sL2NvbW1hbmQvYWx0IGtleQogICAgLy8gYnV0IGFyZSB0aGVzZSBvbmx5IHByZXNlbnQgb24gbW91c2UgZXZlbnRzPwoKICAgIGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50LmFsdEtleSkgeyByZXR1cm4gdHJ1ZSB9CgogICAgaWYgKGtleSA9PT0gMTMpIHsKICAgICAgY29uc3QgdXJpID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2hyZWYnKQoKICAgICAgaWYgKHVyaSkgewogICAgICAgIC8vIGFsZXJ0KCJnb2luZyB0byAiICsgdXJpKTsKICAgICAgICBsZXQgc2xpZGUgPSB3M2NTbGlkeS5zbGlkZXNbdzNjU2xpZHkuc2xpZGVfbnVtYmVyXQogICAgICAgIHczY1NsaWR5LmhpZGVfc2xpZGUoc2xpZGUpCiAgICAgICAgdzNjU2xpZHkuc2xpZGVfbnVtYmVyID0gdzNjU2xpZHkuZmluZF9zbGlkZV9udW1iZXIodXJpKQogICAgICAgIHNsaWRlID0gdzNjU2xpZHkuc2xpZGVzW3czY1NsaWR5LnNsaWRlX251bWJlcl0KICAgICAgICB3M2NTbGlkeS5sYXN0X3Nob3duID0gbnVsbAogICAgICAgIHczY1NsaWR5LnNldF9sb2NhdGlvbigpCiAgICAgICAgdzNjU2xpZHkuc2V0X3Zpc2liaWxpdHlfYWxsX2luY3JlbWVudGFsKCdoaWRkZW4nKQogICAgICAgIHczY1NsaWR5LnNldF9lb3Nfc3RhdHVzKCF3M2NTbGlkeS5uZXh0X2luY3JlbWVudGFsX2l0ZW0odzNjU2xpZHkubGFzdF9zaG93bikpCiAgICAgICAgdzNjU2xpZHkuc2hvd19zbGlkZShzbGlkZSkKICAgICAgICAvLyB0YXJnZXQuZm9jdXMoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICghdzNjU2xpZHkub3BlcmEpIHsgdzNjU2xpZHkuc2V0X2ZvY3VzKCkgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsgfQogICAgICB9CgogICAgICB3M2NTbGlkeS5oaWRlX3RhYmxlX29mX2NvbnRlbnRzKHRydWUpCgogICAgICBpZiAoc2VsZi5pZTcpIHsgdzNjU2xpZHkuaWVfaGFjaygpIH0KCiAgICAgIHJldHVybiB3M2NTbGlkeS5jYW5jZWwoZXZlbnQpCiAgICB9CgogICAgaWYgKGtleSA9PT0gNDAgJiYgdGhpcy5uZXh0KSB7CiAgICAgIHRoaXMubmV4dC5mb2N1cygpCiAgICAgIHJldHVybiB3M2NTbGlkeS5jYW5jZWwoZXZlbnQpCiAgICB9CgogICAgaWYgKGtleSA9PT0gMzggJiYgdGhpcy5wcmV2aW91cykgewogICAgICB0aGlzLnByZXZpb3VzLmZvY3VzKCkKICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgIH0KCiAgICByZXR1cm4gdHJ1ZQogIH0sCgogIHRvdWNoc3RhcnQ6IGZ1bmN0aW9uIChlKSB7CiAgICAvLyBhIGRvdWJsZSB0b3VjaCBvZnRlbiBzdGFydHMgd2l0aCBhCiAgICAvLyBzaW5nbGUgdG91Y2ggZHVlIHRvIGZpbmdlcnMgdG91Y2hpbmcKICAgIC8vIGRvd24gYXQgc2xpZ2h0bHkgZGlmZmVyZW50IHRpbWVzCiAgICAvLyB0aHVzIGF2b2lkIGNhbGxpbmcgcHJldmVudERlZmF1bHQgaGVyZQogICAgdGhpcy5wcmV2X3RhcCA9IHRoaXMubGFzdF90YXAKICAgIHRoaXMubGFzdF90YXAgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpCgogICAgY29uc3QgdGFwRGVsYXkgPSB0aGlzLmxhc3RfdGFwIC0gdGhpcy5wcmV2X3RhcAoKICAgIGlmICh0YXBEZWxheSA8PSAyMDApIHsKICAgICAgLy8gZG91YmxlIHRhcAogICAgfQoKICAgIGNvbnN0IHRvdWNoID0gZS50b3VjaGVzWzBdCgogICAgdGhpcy5wYWdlWCA9IHRvdWNoLnBhZ2VYCiAgICB0aGlzLnBhZ2VZID0gdG91Y2gucGFnZVkKICAgIHRoaXMuc2NyZWVuWCA9IHRvdWNoLnNjcmVlblgKICAgIHRoaXMuc2NyZWVuWSA9IHRvdWNoLnNjcmVlblkKICAgIHRoaXMuY2xpZW50WCA9IHRvdWNoLmNsaWVudFgKICAgIHRoaXMuY2xpZW50WSA9IHRvdWNoLmNsaWVudFkKCiAgICB0aGlzLmRlbHRhX3ggPSB0aGlzLmRlbHRhX3kgPSAwCiAgfSwKCiAgdG91Y2htb3ZlOiBmdW5jdGlvbiAoZSkgewogICAgLy8gb3ZlcnJpZGUgbmF0aXZlIGdlc3R1cmVzIGZvciBzaW5nbGUgdG91Y2gKICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID4gMSkgeyByZXR1cm4gfQoKICAgIGUucHJldmVudERlZmF1bHQoKQogICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF0KICAgIHRoaXMuZGVsdGFfeCA9IHRvdWNoLnBhZ2VYIC0gdGhpcy5wYWdlWAogICAgdGhpcy5kZWx0YV95ID0gdG91Y2gucGFnZVkgLSB0aGlzLnBhZ2VZCiAgfSwKCiAgdG91Y2hlbmQ6IGZ1bmN0aW9uIChlKSB7CiAgICAvLyBkZWZhdWx0IGJlaGF2aW9yIGZvciBtdWx0aS10b3VjaAogICAgaWYgKGUudG91Y2hlcy5sZW5ndGggPiAxKSB7IHJldHVybiB9CgogICAgY29uc3QgZGVsYXkgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gdGhpcy5sYXN0X3RhcAogICAgY29uc3QgZHggPSB0aGlzLmRlbHRhX3gKICAgIGNvbnN0IGR5ID0gdGhpcy5kZWx0YV95CiAgICBjb25zdCBhYnNEeCA9IE1hdGguYWJzKGR4KQogICAgY29uc3QgYWJzRHkgPSBNYXRoLmFicyhkeSkKCiAgICBpZiAoZGVsYXkgPCA1MDAgJiYgKGFic0R4ID4gMTAwIHx8IGFic0R5ID4gMTAwKSkgewogICAgICBpZiAoYWJzRHggPiAwLjUgKiBhYnNEeSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKQoKICAgICAgICBpZiAoZHggPCAwKSB7CiAgICAgICAgICB3M2NTbGlkeS5uZXh0X3NsaWRlKHRydWUpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHczY1NsaWR5LnByZXZpb3VzX3NsaWRlKHRydWUpCiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGFic0R5ID4gMiAqIGFic0R4KSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgdzNjU2xpZHkudG9nZ2xlX3RhYmxlX29mX2NvbnRlbnRzKCkKICAgICAgfQogICAgfQogIH0sCgogIC8vICMjIyBPQlNPTEVURSAjIyMKICBiZWZvcmVfcHJpbnQ6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuc2hvd19hbGxfc2xpZGVzKCkKICAgIHRoaXMuaGlkZV90b29sYmFyKCkKICAgIGFsZXJ0KCdiZWZvcmUgcHJpbnQnKQogIH0sCgogIC8vICMjIyBPQlNPTEVURSAjIyMKICBhZnRlcl9wcmludDogZnVuY3Rpb24gKCkgewogICAgaWYgKCF0aGlzLnZpZXdfYWxsKSB7CiAgICAgIHRoaXMuc2luZ2xlX3NsaWRlX3ZpZXcoKQogICAgICB0aGlzLnNob3dfdG9vbGJhcigpCiAgICB9CiAgICBhbGVydCgnYWZ0ZXIgcHJpbnQnKQogIH0sCgogIC8vICMjIyBPQlNPTEVURSAjIyMKICBwcmludF9zbGlkZXM6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuYmVmb3JlX3ByaW50KCkKICAgIHdpbmRvdy5wcmludCgpCiAgICB0aGlzLmFmdGVyX3ByaW50KCkKICB9LAoKICAvLyAjIyMgT0JTT0xFVEUgPz8gIyMjCiAgdG9nZ2xlX3ZpZXc6IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLnZpZXdfYWxsKSB7CiAgICAgIHRoaXMuc2luZ2xlX3NsaWRlX3ZpZXcoKQogICAgICB0aGlzLnNob3dfdG9vbGJhcigpCiAgICAgIHRoaXMudmlld19hbGwgPSAwCiAgICB9IGVsc2UgewogICAgICB0aGlzLnNob3dfYWxsX3NsaWRlcygpCiAgICAgIHRoaXMuaGlkZV90b29sYmFyKCkKICAgICAgdGhpcy52aWV3X2FsbCA9IDEKICAgIH0KICB9LAoKICAvLyBwcmVwYXJlIGZvciBwcmludGluZyAgIyMjIE9CU09MRVRFICMjIwogIHNob3dfYWxsX3NsaWRlczogZnVuY3Rpb24gKCkgewogICAgdGhpcy5yZW1vdmVfY2xhc3MoZG9jdW1lbnQuYm9keSwgJ3NpbmdsZV9zbGlkZScpCiAgICB0aGlzLnNldF92aXNpYmlsaXR5X2FsbF9pbmNyZW1lbnRhbCgndmlzaWJsZScpCiAgfSwKCiAgLy8gcmVzdG9yZSBhZnRlciBwcmludGluZyAgIyMjIE9CU09MRVRFICMjIwogIHNpbmdsZV9zbGlkZV92aWV3OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmFkZF9jbGFzcyhkb2N1bWVudC5ib2R5LCAnc2luZ2xlX3NsaWRlJykKICAgIHRoaXMuc2V0X3Zpc2liaWxpdHlfYWxsX2luY3JlbWVudGFsKCd2aXNpYmxlJykKICAgIHRoaXMubGFzdF9zaG93biA9IHRoaXMucHJldmlvdXNfaW5jcmVtZW50YWxfaXRlbShudWxsKQogIH0sCgogIC8vIHN1cHByZXNzIElFJ3MgaW1hZ2UgdG9vbGJhciBwb3AgdXAKICBoaWRlX2ltYWdlX3Rvb2xiYXI6IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5uc19wb3MpIHsKICAgICAgY29uc3QgaW1hZ2VzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ0lNRycpCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlcy5sZW5ndGg7ICsraSkgewogICAgICAgIGltYWdlc1tpXS5zZXRBdHRyaWJ1dGUoJ2dhbGxlcnlpbWcnLCAnbm8nKQogICAgICB9CiAgICB9CiAgfSwKCiAgdW5sb2FkZWQ6IGZ1bmN0aW9uIChlKSB7CiAgICAvLyBhbGVydCgidW5sb2FkZWQiKTsKICAgIGNvbnNvbGUubG9nKGUpCiAgfSwKCiAgLy8gU2FmYXJpIGFuZCBLb25xdWVyb3IgZG9uJ3QgeWV0IHN1cHBvcnQgZ2V0Q29tcHV0ZWRTdHlsZSgpCiAgLy8gYW5kIHRoZXkgYWx3YXlzIHJlbG9hZCBwYWdlIHdoZW4gbG9jYXRpb24uaHJlZiBpcyB1cGRhdGVkCiAgaXNfS0hUTUw6IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IGFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudAogICAgcmV0dXJuICghIWFnZW50LmluZGV4T2YoJ0tIVE1MJykgPj0gMCkKICB9LAoKICAvLyBmaW5kIHNsaWRlIG5hbWUgZnJvbSBmaXJzdCBoMSBlbGVtZW50CiAgLy8gZGVmYXVsdCB0byBkb2N1bWVudCB0aXRsZSArIHNsaWRlIG51bWJlcgogIHNsaWRlX25hbWU6IGZ1bmN0aW9uIChpbmRleCkgewogICAgbGV0IG5hbWUgPSBudWxsCiAgICBjb25zdCBzbGlkZSA9IHRoaXMuc2xpZGVzW2luZGV4XQoKICAgIGNvbnN0IGhlYWRpbmcgPSB0aGlzLmZpbmRfaGVhZGluZyhzbGlkZSkKCiAgICBpZiAoaGVhZGluZykgeyBuYW1lID0gdGhpcy5leHRyYWN0X3RleHQoaGVhZGluZykgfQoKICAgIGlmICghbmFtZSkgeyBuYW1lID0gdGhpcy50aXRsZSArICcoJyArIChpbmRleCArIDEpICsgJyknIH0KCiAgICBuYW1lLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgIG5hbWUucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICBuYW1lLnJlcGxhY2UoLz4vZywgJyZndDsnKQoKICAgIHJldHVybiBuYW1lCiAgfSwKCiAgLy8gZmluZCBmaXJzdCBoMSBlbGVtZW50IGluIERPTSB0cmVlCiAgZmluZF9oZWFkaW5nOiBmdW5jdGlvbiAobm9kZSkgewogICAgaWYgKCFub2RlIHx8IG5vZGUubm9kZVR5cGUgIT09IDEpIHsgcmV0dXJuIG51bGwgfQoKICAgIGlmIChub2RlLm5vZGVOYW1lID09PSAnSDEnIHx8IG5vZGUubm9kZU5hbWUgPT09ICdoMScpIHsgcmV0dXJuIG5vZGUgfQoKICAgIGxldCBjaGlsZCA9IG5vZGUuZmlyc3RDaGlsZAoKICAgIHdoaWxlIChjaGlsZCkgewogICAgICBub2RlID0gdGhpcy5maW5kX2hlYWRpbmcoY2hpbGQpCgogICAgICBpZiAobm9kZSkgeyByZXR1cm4gbm9kZSB9CgogICAgICBjaGlsZCA9IGNoaWxkLm5leHRTaWJsaW5nCiAgICB9CgogICAgcmV0dXJuIG51bGwKICB9LAoKICAvLyByZWN1cnNpdmVseSBleHRyYWN0IHRleHQgZnJvbSBET00gdHJlZQogIGV4dHJhY3RfdGV4dDogZnVuY3Rpb24gKG5vZGUpIHsKICAgIGlmICghbm9kZSkgeyByZXR1cm4gJycgfQoKICAgIC8vIHRleHQgbm9kZXMKICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7IHJldHVybiBub2RlLm5vZGVWYWx1ZSB9CgogICAgLy8gZWxlbWVudHMKICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxKSB7CiAgICAgIG5vZGUgPSBub2RlLmZpcnN0Q2hpbGQKICAgICAgbGV0IHRleHQgPSAnJwoKICAgICAgd2hpbGUgKG5vZGUpIHsKICAgICAgICB0ZXh0ID0gdGV4dCArIHRoaXMuZXh0cmFjdF90ZXh0KG5vZGUpCiAgICAgICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmcKICAgICAgfQoKICAgICAgcmV0dXJuIHRleHQKICAgIH0KCiAgICByZXR1cm4gJycKICB9LAoKICAvLyBmaW5kIGNvcHlyaWdodCB0ZXh0IGZyb20gbWV0YSBlbGVtZW50CiAgZmluZF9jb3B5cmlnaHQ6IGZ1bmN0aW9uICgpIHsKICAgIGxldCBuYW1lLCBjb250ZW50CiAgICBjb25zdCBtZXRhID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ21ldGEnKQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWV0YS5sZW5ndGg7ICsraSkgewogICAgICBuYW1lID0gbWV0YVtpXS5nZXRBdHRyaWJ1dGUoJ25hbWUnKQogICAgICBjb250ZW50ID0gbWV0YVtpXS5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnKQoKICAgICAgaWYgKG5hbWUgPT09ICdjb3B5cmlnaHQnKSB7IHJldHVybiBjb250ZW50IH0KICAgIH0KCiAgICByZXR1cm4gbnVsbAogIH0sCgogIGZpbmRfc2l6ZV9hZGp1c3Q6IGZ1bmN0aW9uICgpIHsKICAgIGxldCBuYW1lLCBjb250ZW50CiAgICBjb25zdCBtZXRhID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ21ldGEnKQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWV0YS5sZW5ndGg7ICsraSkgewogICAgICBuYW1lID0gbWV0YVtpXS5nZXRBdHRyaWJ1dGUoJ25hbWUnKQogICAgICBjb250ZW50ID0gbWV0YVtpXS5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnKQoKICAgICAgaWYgKG5hbWUgPT09ICdmb250LXNpemUtYWRqdXN0bWVudCcpIHsgcmV0dXJuIDEgKiBjb250ZW50IH0KICAgIH0KCiAgICByZXR1cm4gMQogIH0sCgogIC8vIDxtZXRhIG5hbWU9ImR1cmF0aW9uIiBjb250ZW50PSIyMCIgLz4gIGZvciAyMCBtaW51dGVzCiAgZmluZF9kdXJhdGlvbjogZnVuY3Rpb24gKCkgewogICAgbGV0IG5hbWUsIGNvbnRlbnQKICAgIGNvbnN0IG1ldGEgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbWV0YScpCgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZXRhLmxlbmd0aDsgKytpKSB7CiAgICAgIG5hbWUgPSBtZXRhW2ldLmdldEF0dHJpYnV0ZSgnbmFtZScpCiAgICAgIGNvbnRlbnQgPSBtZXRhW2ldLmdldEF0dHJpYnV0ZSgnY29udGVudCcpCgogICAgICBpZiAobmFtZSA9PT0gJ2R1cmF0aW9uJykgeyByZXR1cm4gNjAwMDAgKiBjb250ZW50IH0KICAgIH0KCiAgICByZXR1cm4gbnVsbAogIH0sCgogIHJlcGxhY2VfYnlfbm9uX2JyZWFraW5nX3NwYWNlOiBmdW5jdGlvbiAoc3RyKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkgewogICAgICBzdHJbaV0gPSAxNjAKICAgIH0KICB9LAoKICAvLyAjIyMgQ0hFQ0sgTUUgIyMjIGlzIHVzZSBvZiAibGkiIG9rYXkgZm9yIHRleHQvaHRtbD8KICAvLyBmb3IgWEhUTUwgZG8gd2UgYWxzbyBuZWVkIHRvIHNwZWNpZnkgbmFtZXNwYWNlPwogIGluaXRfb3V0bGluZXI6IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IGl0ZW1zID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2xpJykKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgKytpKSB7CiAgICAgIGNvbnN0IHRhcmdldCA9IGl0ZW1zW2ldCgogICAgICBpZiAoIXRoaXMuaGFzX2NsYXNzKHRhcmdldC5wYXJlbnROb2RlLCAnb3V0bGluZScpKSB7IGNvbnRpbnVlIH0KCiAgICAgIHRhcmdldC5vbmNsaWNrID0gdGhpcy5vdXRsaW5lX2NsaWNrCiAgICAgIC8qICMjIyBtb3JlIHdvcmsgbmVlZGVkIGZvciBJRTYKICAgICAgICAgICAgaWYgKCF0aGlzLm5zX3BvcykKICAgICAgICAgICAgewogICAgICAgICAgICAgIHRhcmdldC5vbm1vdXNlb3ZlciA9IHRoaXMuaG92ZXJfb3V0bGluZQogICAgICAgICAgICAgIHRhcmdldC5vbm1vdXNlb3V0ID0gdGhpcy51bmhvdmVyX291dGxpbmUKICAgICAgICAgICAgfQogICAgICAqLwogICAgICBpZiAodGhpcy5mb2xkYWJsZSh0YXJnZXQpKSB7CiAgICAgICAgdGFyZ2V0LmZvbGRhYmxlID0gdHJ1ZQogICAgICAgIHRhcmdldC5vbmZvY3VzID0gZnVuY3Rpb24gKCkgeyB3M2NTbGlkeS5vdXRsaW5lID0gdGhpcyB9CiAgICAgICAgdGFyZ2V0Lm9uYmx1ciA9IGZ1bmN0aW9uICgpIHsgdzNjU2xpZHkub3V0bGluZSA9IG51bGwgfQoKICAgICAgICBpZiAoIXRhcmdldC5nZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JykpIHsKICAgICAgICAgIHRhcmdldC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuaGFzX2NsYXNzKHRhcmdldCwgJ2V4cGFuZCcpKSB7CiAgICAgICAgICB0aGlzLnVuZm9sZCh0YXJnZXQpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZm9sZCh0YXJnZXQpCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWRkX2NsYXNzKHRhcmdldCwgJ25vZm9sZCcpCiAgICAgICAgdGFyZ2V0LnZpc2libGUgPSB0cnVlCiAgICAgICAgdGFyZ2V0LmZvbGRhYmxlID0gZmFsc2UKICAgICAgfQogICAgfQogIH0sCgogIGZvbGRhYmxlOiBmdW5jdGlvbiAoaXRlbSkgewogICAgaWYgKCFpdGVtIHx8IGl0ZW0ubm9kZVR5cGUgIT09IDEpIHsgcmV0dXJuIGZhbHNlIH0KCiAgICBsZXQgbm9kZSA9IGl0ZW0uZmlyc3RDaGlsZAoKICAgIHdoaWxlIChub2RlKSB7CiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxICYmIHRoaXMuaXNfYmxvY2sobm9kZSkpIHsgcmV0dXJuIHRydWUgfQoKICAgICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmcKICAgIH0KCiAgICByZXR1cm4gZmFsc2UKICB9LAoKICAvLyAjIyMgQ0hFQ0sgTUUgIyMjIHN3aXRjaCB0byBhZGQvcmVtb3ZlICJoaWRkZW4iIGNsYXNzCiAgZm9sZDogZnVuY3Rpb24gKGl0ZW0pIHsKICAgIGlmIChpdGVtKSB7CiAgICAgIHRoaXMucmVtb3ZlX2NsYXNzKGl0ZW0sICd1bmZvbGRlZCcpCiAgICAgIHRoaXMuYWRkX2NsYXNzKGl0ZW0sICdmb2xkZWQnKQogICAgfQoKICAgIGxldCBub2RlID0gaXRlbSA/IGl0ZW0uZmlyc3RDaGlsZCA6IG51bGwKCiAgICB3aGlsZSAobm9kZSkgewogICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSAmJiB0aGlzLmlzX2Jsb2NrKG5vZGUpKSB7IC8vIGVsZW1lbnQKICAgICAgICB3M2NTbGlkeS5hZGRfY2xhc3Mobm9kZSwgJ2hpZGRlbicpCiAgICAgIH0KCiAgICAgIG5vZGUgPSBub2RlLm5leHRTaWJsaW5nCiAgICB9CgogICAgaXRlbS52aXNpYmxlID0gZmFsc2UKICB9LAoKICAvLyAjIyMgQ0hFQ0sgTUUgIyMjIHN3aXRjaCB0byBhZGQvcmVtb3ZlICJoaWRkZW4iIGNsYXNzCiAgdW5mb2xkOiBmdW5jdGlvbiAoaXRlbSkgewogICAgaWYgKGl0ZW0pIHsKICAgICAgdGhpcy5hZGRfY2xhc3MoaXRlbSwgJ3VuZm9sZGVkJykKICAgICAgdGhpcy5yZW1vdmVfY2xhc3MoaXRlbSwgJ2ZvbGRlZCcpCiAgICB9CgogICAgbGV0IG5vZGUgPSBpdGVtID8gaXRlbS5maXJzdENoaWxkIDogbnVsbAoKICAgIHdoaWxlIChub2RlKSB7CiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxICYmIHRoaXMuaXNfYmxvY2sobm9kZSkpIHsgLy8gZWxlbWVudAogICAgICAgIHczY1NsaWR5LnJlbW92ZV9jbGFzcyhub2RlLCAnaGlkZGVuJykKICAgICAgfQoKICAgICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmcKICAgIH0KCiAgICBpdGVtLnZpc2libGUgPSB0cnVlCiAgfSwKCiAgb3V0bGluZV9jbGljazogZnVuY3Rpb24gKGUpIHsKICAgIGlmICghZSkgeyBlID0gd2luZG93LmV2ZW50IH0KCiAgICB0aGlzLnJpZ2h0Y2xpY2sgPSBmYWxzZQogICAgbGV0IHRhcmdldCA9IHczY1NsaWR5LmdldF90YXJnZXQoZSkKCiAgICB3aGlsZSAodGFyZ2V0ICYmIHRhcmdldC52aXNpYmxlID09PSB1bmRlZmluZWQpIHsKICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGUKICAgIH0KCiAgICBpZiAoIXRhcmdldCkgeyByZXR1cm4gdHJ1ZSB9CgogICAgaWYgKGUud2hpY2gpIHsKICAgICAgdGhpcy5yaWdodGNsaWNrID0gKGUud2hpY2ggPT09IDMpCiAgICB9IGVsc2UgaWYgKGUuYnV0dG9uKSB7CiAgICAgIHRoaXMucmlnaHRjbGljayA9IChlLmJ1dHRvbiA9PT0gMikKICAgIH0KCiAgICBpZiAoIXRoaXMucmlnaHRjbGljayAmJiB0YXJnZXQudmlzaWJsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICh0YXJnZXQuZm9sZGFibGUpIHsKICAgICAgICBpZiAodGFyZ2V0LnZpc2libGUpIHsKICAgICAgICAgIHczY1NsaWR5LmZvbGQodGFyZ2V0KQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3M2NTbGlkeS51bmZvbGQodGFyZ2V0KQogICAgICAgIH0KICAgICAgfQoKICAgICAgdzNjU2xpZHkuc3RvcF9wcm9wYWdhdGlvbihlKQogICAgICBlLmNhbmNlbCA9IHRydWUKICAgICAgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlCiAgICB9CgogICAgcmV0dXJuIGZhbHNlCiAgfSwKCiAgYWRkX2luaXRpYWxfcHJvbXB0OiBmdW5jdGlvbiAoKSB7CiAgICBjb25zdCBwcm9tcHQgPSB0aGlzLmNyZWF0ZV9lbGVtZW50KCdkaXYnKQogICAgcHJvbXB0LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnaW5pdGlhbF9wcm9tcHQnKQoKICAgIGNvbnN0IHAxID0gdGhpcy5jcmVhdGVfZWxlbWVudCgncCcpCiAgICBwcm9tcHQuYXBwZW5kQ2hpbGQocDEpCiAgICBwMS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2hlbHAnKQoKICAgIGlmICh0aGlzLmtleWJvYXJkbGVzcykgewogICAgICBwMS5pbm5lckhUTUwgPSAnc3dpcGUgbGVmdCB0byBtb3ZlIHRvIG5leHQgc2xpZGUnCiAgICB9IGVsc2UgewogICAgICBwMS5pbm5lckhUTUwgPSAnU3BhY2UsIFJpZ2h0IEFycm93IG9yIHN3aXBlIGxlZnQgdG8gbW92ZSB0byAnICsKICAgICAgICAnbmV4dCBzbGlkZSwgY2xpY2sgaGVscCBiZWxvdyBmb3IgbW9yZSBkZXRhaWxzJwogICAgfQoKICAgIHRoaXMuYWRkX2xpc3RlbmVyKHByb21wdCwgJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsKICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChwcm9tcHQpCiAgICAgIHczY1NsaWR5LnN0b3BfcHJvcGFnYXRpb24oZSkKCiAgICAgIGlmIChlLmNhbmNlbCAhPT0gdW5kZWZpbmVkKSB7IGUuY2FuY2VsID0gdHJ1ZSB9CgogICAgICBpZiAoZS5yZXR1cm5WYWx1ZSAhPT0gdW5kZWZpbmVkKSB7IGUucmV0dXJuVmFsdWUgPSBmYWxzZSB9CgogICAgICByZXR1cm4gZmFsc2UKICAgIH0pCgogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwcm9tcHQpCiAgICB0aGlzLmluaXRpYWxfcHJvbXB0ID0gcHJvbXB0CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChwcm9tcHQpIH0sIDUwMDApCiAgfSwKCiAgYWRkX3Rvb2xiYXI6IGZ1bmN0aW9uICgpIHsKICAgIGxldCBjb3VudGVyCgogICAgdGhpcy50b29sYmFyID0gdGhpcy5jcmVhdGVfZWxlbWVudCgnZGl2JykKICAgIHRoaXMudG9vbGJhci5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Rvb2xiYXInKQoKICAgIC8vIGEgcmVhc29uYWJseSBiZWhhdmVkIGJyb3dzZXIKICAgIGlmICh0aGlzLm5zX3BvcyB8fCAhdGhpcy5pZTYpIHsKICAgICAgY29uc3QgcmlnaHQgPSB0aGlzLmNyZWF0ZV9lbGVtZW50KCdkaXYnKQogICAgICByaWdodC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ2Zsb2F0OiByaWdodDsgdGV4dC1hbGlnbjogcmlnaHQnKQoKICAgICAgY291bnRlciA9IHRoaXMuY3JlYXRlX2VsZW1lbnQoJ3NwYW4nKQogICAgICBjb3VudGVyLmlubmVySFRNTCA9IHRoaXMubG9jYWxpemUoJ3NsaWRlJykgKyAnIG4vbScKICAgICAgcmlnaHQuYXBwZW5kQ2hpbGQoY291bnRlcikKICAgICAgdGhpcy50b29sYmFyLmFwcGVuZENoaWxkKHJpZ2h0KQoKICAgICAgY29uc3QgbGVmdCA9IHRoaXMuY3JlYXRlX2VsZW1lbnQoJ2RpdicpCiAgICAgIGxlZnQuc2V0QXR0cmlidXRlKCdzdHlsZScsICd0ZXh0LWFsaWduOiBsZWZ0JykKCiAgICAgIC8vIGdsb2JhbCBlbmQgb2Ygc2xpZGUgaW5kaWNhdG9yCiAgICAgIHRoaXMuZW9zID0gdGhpcy5jcmVhdGVfZWxlbWVudCgnc3BhbicpCiAgICAgIHRoaXMuZW9zLmlubmVySFRNTCA9ICcqICcKICAgICAgbGVmdC5hcHBlbmRDaGlsZCh0aGlzLmVvcykKCiAgICAgIGNvbnN0IGhlbHAgPSB0aGlzLmNyZWF0ZV9lbGVtZW50KCdhJykKICAgICAgaGVscC5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB0aGlzLmhlbHBfcGFnZSkKICAgICAgaGVscC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgdGhpcy5sb2NhbGl6ZSh0aGlzLmhlbHBfdGV4dCkpCiAgICAgIGhlbHAuaW5uZXJIVE1MID0gdGhpcy5sb2NhbGl6ZSgnaGVscD8nKQogICAgICBsZWZ0LmFwcGVuZENoaWxkKGhlbHApCiAgICAgIHRoaXMuaGVscF9hbmNob3IgPSBoZWxwIC8vIHNhdmUgZm9yIGZvY3VzIGhhY2sKCiAgICAgIGNvbnN0IGdhcDEgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICcpCiAgICAgIGxlZnQuYXBwZW5kQ2hpbGQoZ2FwMSkKCiAgICAgIGNvbnN0IGNvbnRlbnRzID0gdGhpcy5jcmVhdGVfZWxlbWVudCgnYScpCiAgICAgIGNvbnRlbnRzLnNldEF0dHJpYnV0ZSgnaHJlZicsICdqYXZhc2NyaXB0OnczY19zbGlkeS50b2dnbGVfdGFibGVfb2ZfY29udGVudHMoKScpCiAgICAgIGNvbnRlbnRzLnNldEF0dHJpYnV0ZSgndGl0bGUnLCB0aGlzLmxvY2FsaXplKCd0YWJsZSBvZiBjb250ZW50cycpKQogICAgICBjb250ZW50cy5pbm5lckhUTUwgPSB0aGlzLmxvY2FsaXplKCdjb250ZW50cz8nKQogICAgICBsZWZ0LmFwcGVuZENoaWxkKGNvbnRlbnRzKQoKICAgICAgY29uc3QgZ2FwMiA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcgJykKICAgICAgbGVmdC5hcHBlbmRDaGlsZChnYXAyKQoKICAgICAgY29uc3QgY29weXJpZ2h0ID0gdGhpcy5maW5kX2NvcHlyaWdodCgpCgogICAgICBpZiAoY29weXJpZ2h0KSB7CiAgICAgICAgY29uc3Qgc3BhbiA9IHRoaXMuY3JlYXRlX2VsZW1lbnQoJ3NwYW4nKQogICAgICAgIHNwYW4uY2xhc3NOYW1lID0gJ2NvcHlyaWdodCcKICAgICAgICBzcGFuLmlubmVySFRNTCA9IGNvcHlyaWdodAogICAgICAgIGxlZnQuYXBwZW5kQ2hpbGQoc3BhbikKICAgICAgfQoKICAgICAgdGhpcy50b29sYmFyLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpCiAgICAgIHRoaXMudG9vbGJhci5hcHBlbmRDaGlsZChsZWZ0KQogICAgfSBlbHNlIHsgLy8gSUU2IHNvIG5lZWQgdG8gd29yayBhcm91bmQgaXRzIHBvb3IgQ1NTIHN1cHBvcnQKICAgICAgdGhpcy50b29sYmFyLnN0eWxlLnBvc2l0aW9uID0gKHRoaXMuaWU3ID8gJ2ZpeGVkJyA6ICdhYnNvbHV0ZScpCiAgICAgIHRoaXMudG9vbGJhci5zdHlsZS56SW5kZXggPSAnMjAwJwogICAgICB0aGlzLnRvb2xiYXIuc3R5bGUud2lkdGggPSAnOTkuOSUnCiAgICAgIHRoaXMudG9vbGJhci5zdHlsZS5oZWlnaHQgPSAnMS4yZW0nCiAgICAgIHRoaXMudG9vbGJhci5zdHlsZS50b3AgPSAnYXV0bycKICAgICAgdGhpcy50b29sYmFyLnN0eWxlLmJvdHRvbSA9ICcwJwogICAgICB0aGlzLnRvb2xiYXIuc3R5bGUubGVmdCA9ICcwJwogICAgICB0aGlzLnRvb2xiYXIuc3R5bGUucmlnaHQgPSAnMCcKICAgICAgdGhpcy50b29sYmFyLnN0eWxlLnRleHRBbGlnbiA9ICdsZWZ0JwogICAgICB0aGlzLnRvb2xiYXIuc3R5bGUuZm9udFNpemUgPSAnNjAlJwogICAgICB0aGlzLnRvb2xiYXIuc3R5bGUuY29sb3IgPSAncmVkJwogICAgICB0aGlzLnRvb2xiYXIuYm9yZGVyV2lkdGggPSAwCiAgICAgIHRoaXMudG9vbGJhci5jbGFzc05hbWUgPSAndG9vbGJhcicKICAgICAgdGhpcy50b29sYmFyLnN0eWxlLmJhY2tncm91bmQgPSAncmdiKDI0MCwyNDAsMjQwKScKCiAgICAgIC8vIHdvdWxkIGxpa2UgdG8gaGF2ZSBoZWxwIHRleHQgbGVmdCBhbGlnbmVkCiAgICAgIC8vIGFuZCBwYWdlIGNvdW50ZXIgcmlnaHQgYWxpZ25lZCwgZmxvYXRpbmcKICAgICAgLy8gZGl2J3MgZG9uJ3Qgd29yaywgc28gaW5zdGVhZCB1c2UgbmVzdGVkCiAgICAgIC8vIGFic29sdXRlbHkgcG9zaXRpb25lZCBkaXYncy4KCiAgICAgIGNvbnN0IHNwID0gdGhpcy5jcmVhdGVfZWxlbWVudCgnc3BhbicpCiAgICAgIHNwLmlubmVySFRNTCA9ICcmbmJzcDsmbmJzcDsqJm5ic3A7JwogICAgICB0aGlzLnRvb2xiYXIuYXBwZW5kQ2hpbGQoc3ApCiAgICAgIHRoaXMuZW9zID0gc3AgLy8gZW5kIG9mIHNsaWRlIGluZGljYXRvcgoKICAgICAgY29uc3QgaGVscCA9IHRoaXMuY3JlYXRlX2VsZW1lbnQoJ2EnKQogICAgICBoZWxwLnNldEF0dHJpYnV0ZSgnaHJlZicsIHRoaXMuaGVscF9wYWdlKQogICAgICBoZWxwLnNldEF0dHJpYnV0ZSgndGl0bGUnLCB0aGlzLmxvY2FsaXplKHRoaXMuaGVscF90ZXh0KSkKICAgICAgaGVscC5pbm5lckhUTUwgPSB0aGlzLmxvY2FsaXplKCdoZWxwPycpCiAgICAgIHRoaXMudG9vbGJhci5hcHBlbmRDaGlsZChoZWxwKQogICAgICB0aGlzLmhlbHBfYW5jaG9yID0gaGVscCAvLyBzYXZlIGZvciBmb2N1cyBoYWNrCgogICAgICBjb25zdCBnYXAxID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyAnKQogICAgICB0aGlzLnRvb2xiYXIuYXBwZW5kQ2hpbGQoZ2FwMSkKCiAgICAgIGNvbnN0IGNvbnRlbnRzID0gdGhpcy5jcmVhdGVfZWxlbWVudCgnYScpCiAgICAgIGNvbnRlbnRzLnNldEF0dHJpYnV0ZSgnaHJlZicsICdqYXZhc2NyaXB0OnRvZ2dsZVRhYmxlT2ZDb250ZW50cygpJykKICAgICAgY29udGVudHMuc2V0QXR0cmlidXRlKCd0aXRsZScsIHRoaXMubG9jYWxpemUoJ3RhYmxlIG9mIGNvbnRlbnRzJy5sb2NhbGl6ZSkpCiAgICAgIGNvbnRlbnRzLmlubmVySFRNTCA9IHRoaXMubG9jYWxpemUoJ2NvbnRlbnRzPycpCiAgICAgIHRoaXMudG9vbGJhci5hcHBlbmRDaGlsZChjb250ZW50cykKCiAgICAgIGNvbnN0IGdhcDIgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICcpCiAgICAgIHRoaXMudG9vbGJhci5hcHBlbmRDaGlsZChnYXAyKQoKICAgICAgY29uc3QgY29weXJpZ2h0ID0gdGhpcy5maW5kX2NvcHlyaWdodCgpCgogICAgICBpZiAoY29weXJpZ2h0KSB7CiAgICAgICAgY29uc3Qgc3BhbiA9IHRoaXMuY3JlYXRlX2VsZW1lbnQoJ3NwYW4nKQogICAgICAgIHNwYW4uaW5uZXJIVE1MID0gY29weXJpZ2h0CiAgICAgICAgc3Bhbi5zdHlsZS5jb2xvciA9ICdibGFjaycKICAgICAgICBzcGFuLnN0eWxlLm1hcmdpbkxlZnQgPSAnMC41ZW0nCiAgICAgICAgdGhpcy50b29sYmFyLmFwcGVuZENoaWxkKHNwYW4pCiAgICAgIH0KCiAgICAgIGNvdW50ZXIgPSB0aGlzLmNyZWF0ZV9lbGVtZW50KCdkaXYnKQogICAgICBjb3VudGVyLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJwogICAgICBjb3VudGVyLnN0eWxlLndpZHRoID0gJ2F1dG8nIC8vICIyMCUiOwogICAgICBjb3VudGVyLnN0eWxlLmhlaWdodCA9ICcxLjJlbScKICAgICAgY291bnRlci5zdHlsZS50b3AgPSAnYXV0bycKICAgICAgY291bnRlci5zdHlsZS5ib3R0b20gPSAwCiAgICAgIGNvdW50ZXIuc3R5bGUucmlnaHQgPSAnMCcKICAgICAgY291bnRlci5zdHlsZS50ZXh0QWxpZ24gPSAncmlnaHQnCiAgICAgIGNvdW50ZXIuc3R5bGUuY29sb3IgPSAncmVkJwogICAgICBjb3VudGVyLnN0eWxlLmJhY2tncm91bmQgPSAncmdiKDI0MCwyNDAsMjQwKScKCiAgICAgIGNvdW50ZXIuaW5uZXJIVE1MID0gdGhpcy5sb2NhbGl6ZSgnc2xpZGUnKSArICcgbi9tJwogICAgICB0aGlzLnRvb2xiYXIuYXBwZW5kQ2hpbGQoY291bnRlcikKICAgIH0KCiAgICAvLyBlbnN1cmUgdGhhdCBjbGljayBpc24ndCBwYXNzZWQgdGhyb3VnaCB0byB0aGUgcGFnZQogICAgdGhpcy50b29sYmFyLm9uY2xpY2sgPQogICAgICBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICghZSkgeyBlID0gd2luZG93LmV2ZW50IH0KCiAgICAgICAgbGV0IHRhcmdldCA9IGUudGFyZ2V0CgogICAgICAgIGlmICghdGFyZ2V0ICYmIGUuc3JjRWxlbWVudCkgeyB0YXJnZXQgPSBlLnNyY0VsZW1lbnQgfQoKICAgICAgICAvLyB3b3JrIGFyb3VuZCBTYWZhcmkgYnVnCiAgICAgICAgaWYgKHRhcmdldCAmJiB0YXJnZXQubm9kZVR5cGUgPT09IDMpIHsgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGUgfQoKICAgICAgICB3M2NTbGlkeS5zdG9wX3Byb3BhZ2F0aW9uKGUpCgogICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICdhJykgewogICAgICAgICAgdzNjU2xpZHkubW91c2VfYnV0dG9uX2NsaWNrKGUpCiAgICAgICAgfQogICAgICB9CgogICAgdGhpcy5zbGlkZV9udW1iZXJfZWxlbWVudCA9IGNvdW50ZXIKICAgIHRoaXMuc2V0X2Vvc19zdGF0dXMoZmFsc2UpCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMudG9vbGJhcikKICB9LAoKICAvLyB3eXNpd3lnIGVkaXRvcnMgbWFrZSBpdCBoYXJkIHRvIHVzZSBkaXYgZWxlbWVudHMKICAvLyBlLmcuIGFtYXlhIGxvc2VzIHRoZSBkaXYgd2hlbiB5b3UgY29weSBhbmQgcGFzdGUKICAvLyB0aGlzIGZ1bmN0aW9uIHdyYXBzIGRpdiBlbGVtZW50cyBhcm91bmQgaW1wbGljaXQKICAvLyBzbGlkZXMgd2hpY2ggc3RhcnQgd2l0aCBhbiBoMSBlbGVtZW50IGFuZCBjb250aW51ZQogIC8vIHVwIHRvIHRoZSBuZXh0IGhlYWRpbmcgb3IgZGl2IGVsZW1lbnQKICB3cmFwX2ltcGxpY2l0X3NsaWRlczogZnVuY3Rpb24gKCkgewogICAgbGV0IGhlYWRpbmcsIG5vZGUsIG5leHQsIGRpdgogICAgY29uc3QgaGVhZGluZ3MgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaDEnKQoKICAgIGlmICghaGVhZGluZ3MpIHsgcmV0dXJuIH0KCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhlYWRpbmdzLmxlbmd0aDsgKytpKSB7CiAgICAgIGhlYWRpbmcgPSBoZWFkaW5nc1tpXQoKICAgICAgaWYgKGhlYWRpbmcucGFyZW50Tm9kZSAhPT0gZG9jdW1lbnQuYm9keSkgeyBjb250aW51ZSB9CgogICAgICBub2RlID0gaGVhZGluZy5uZXh0U2libGluZwoKICAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykKICAgICAgdGhpcy5hZGRfY2xhc3MoZGl2LCAnc2xpZGUnKQogICAgICBkb2N1bWVudC5ib2R5LnJlcGxhY2VDaGlsZChkaXYsIGhlYWRpbmcpCiAgICAgIGRpdi5hcHBlbmRDaGlsZChoZWFkaW5nKQoKICAgICAgd2hpbGUgKG5vZGUpIHsKICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSkgeyAvLyBhbiBlbGVtZW50CiAgICAgICAgICBpZiAobm9kZS5ub2RlTmFtZSA9PT0gJ0gxJyB8fCBub2RlLm5vZGVOYW1lID09PSAnaDEnKSB7IGJyZWFrIH0KCiAgICAgICAgICBpZiAobm9kZS5ub2RlTmFtZSA9PT0gJ0RJVicgfHwgbm9kZS5ub2RlTmFtZSA9PT0gJ2RpdicpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaGFzX2NsYXNzKG5vZGUsICdzbGlkZScpKSB7IGJyZWFrIH0KCiAgICAgICAgICAgIGlmICh0aGlzLmhhc19jbGFzcyhub2RlLCAnaGFuZG91dCcpKSB7IGJyZWFrIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG5leHQgPSBub2RlLm5leHRTaWJsaW5nCiAgICAgICAgbm9kZSA9IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobm9kZSkKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQobm9kZSkKICAgICAgICBub2RlID0gbmV4dAogICAgICB9CiAgICB9CiAgfSwKCiAgYXR0YWNoX3RvdWNoX2hhbmRlcnM6IGZ1bmN0aW9uIChzbGlkZXMpIHsKICAgIGxldCBzbGlkZQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2xpZGVzLmxlbmd0aDsgKytpKSB7CiAgICAgIHNsaWRlID0gc2xpZGVzW2ldCiAgICAgIHRoaXMuYWRkX2xpc3RlbmVyKHNsaWRlLCAndG91Y2hzdGFydCcsIHRoaXMudG91Y2hzdGFydCkKICAgICAgdGhpcy5hZGRfbGlzdGVuZXIoc2xpZGUsICd0b3VjaG1vdmUnLCB0aGlzLnRvdWNobW92ZSkKICAgICAgdGhpcy5hZGRfbGlzdGVuZXIoc2xpZGUsICd0b3VjaGVuZCcsIHRoaXMudG91Y2hlbmQpCiAgICB9CiAgfSwKCiAgLy8gcmV0dXJuIG5ldyBhcnJheSBvZiBhbGwgc2xpZGVzCiAgY29sbGVjdF9zbGlkZXM6IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IHNsaWRlcyA9IFtdCiAgICBjb25zdCBkaXZzID0gZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnZGl2JykKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRpdnMubGVuZ3RoOyArK2kpIHsKICAgICAgY29uc3QgZGl2ID0gZGl2cy5pdGVtKGkpCgogICAgICBpZiAodGhpcy5oYXNfY2xhc3MoZGl2LCAnc2xpZGUnKSkgewogICAgICAgIC8vIGFkZCBzbGlkZSB0byBjb2xsZWN0aW9uCiAgICAgICAgc2xpZGVzW3NsaWRlcy5sZW5ndGhdID0gZGl2CgogICAgICAgIC8vIGhpZGUgZWFjaCBzbGlkZSBhcyBpdCBpcyBmb3VuZAogICAgICAgIHRoaXMuYWRkX2NsYXNzKGRpdiwgJ2hpZGRlbicpCgogICAgICAgIC8vIGFkZCBkdW1teSA8YnIvPiBhdCBlbmQgZm9yIHNjcm9sbGluZyBoYWNrCiAgICAgICAgY29uc3Qgbm9kZTEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdicicpCiAgICAgICAgZGl2LmFwcGVuZENoaWxkKG5vZGUxKQogICAgICAgIGNvbnN0IG5vZGUyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnInKQogICAgICAgIGRpdi5hcHBlbmRDaGlsZChub2RlMikKICAgICAgfSBlbHNlIGlmICh0aGlzLmhhc19jbGFzcyhkaXYsICdiYWNrZ3JvdW5kJykpIHsgLy8gd29yayBhcm91bmQgZm9yIEZpcmVmb3ggU1ZHIHJlbG9hZCBidWcKICAgICAgICAvLyB3aGljaCBvdGhlcndpc2UgcmVwbGFjZXMgMXN0IFNWRyBncmFwaGljIHdpdGggMm5kCiAgICAgICAgZGl2LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snCiAgICAgIH0KICAgIH0KCiAgICB0aGlzLnNsaWRlcyA9IHNsaWRlcwogIH0sCgogIC8vIHJldHVybiBuZXcgYXJyYXkgb2YgYWxsIDxkaXYgY2xhc3M9ImhhbmRvdXQiPgogIGNvbGxlY3Rfbm90ZXM6IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IG5vdGVzID0gW10KICAgIGNvbnN0IGRpdnMgPSBkb2N1bWVudC5ib2R5LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGl2cy5sZW5ndGg7ICsraSkgewogICAgICBjb25zdCBkaXYgPSBkaXZzLml0ZW0oaSkKCiAgICAgIGlmICh0aGlzLmhhc19jbGFzcyhkaXYsICdoYW5kb3V0JykpIHsKICAgICAgICAvLyBhZGQgbm90ZSB0byBjb2xsZWN0aW9uCiAgICAgICAgbm90ZXNbbm90ZXMubGVuZ3RoXSA9IGRpdgoKICAgICAgICAvLyBhbmQgaGlkZSBpdAogICAgICAgIHRoaXMuYWRkX2NsYXNzKGRpdiwgJ2hpZGRlbicpCiAgICAgIH0KICAgIH0KCiAgICB0aGlzLm5vdGVzID0gbm90ZXMKICB9LAoKICAvLyByZXR1cm4gbmV3IGFycmF5IG9mIGFsbCA8ZGl2IGNsYXNzPSJiYWNrZ3JvdW5kIj4KICAvLyBpbmNsdWRpbmcgbmFtZWQgYmFja2dyb3VuZHMgZS5nLiBjbGFzcz0iYmFja2dyb3VuZCB0aXRsZXBhZ2UiCiAgY29sbGVjdF9iYWNrZ3JvdW5kczogZnVuY3Rpb24gKCkgewogICAgY29uc3QgYmFja2dyb3VuZHMgPSBbXQogICAgY29uc3QgZGl2cyA9IGRvY3VtZW50LmJvZHkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpCgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXZzLmxlbmd0aDsgKytpKSB7CiAgICAgIGNvbnN0IGRpdiA9IGRpdnMuaXRlbShpKQoKICAgICAgaWYgKHRoaXMuaGFzX2NsYXNzKGRpdiwgJ2JhY2tncm91bmQnKSkgewogICAgICAgIC8vIGFkZCBiYWNrZ3JvdW5kIHRvIGNvbGxlY3Rpb24KICAgICAgICBiYWNrZ3JvdW5kc1tiYWNrZ3JvdW5kcy5sZW5ndGhdID0gZGl2CgogICAgICAgIC8vIGFuZCBoaWRlIGl0CiAgICAgICAgdGhpcy5hZGRfY2xhc3MoZGl2LCAnaGlkZGVuJykKICAgICAgfQogICAgfQoKICAgIHRoaXMuYmFja2dyb3VuZHMgPSBiYWNrZ3JvdW5kcwogIH0sCgogIC8vIHNldCBjbGljayBoYW5kbGVycyBvbiBhbGwgYW5jaG9ycwogIHBhdGNoX2FuY2hvcnM6IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IHNlbGYgPSB3M2NTbGlkeQogICAgY29uc3QgaGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAvLyBjb21wYXJlIHRoaXMuaHJlZiB3aXRoIGxvY2F0aW9uLmhyZWYKICAgICAgLy8gZm9yIGxpbmsgdG8gYW5vdGhlciBzbGlkZSBpbiB0aGlzIGRvYwoKICAgICAgaWYgKHNlbGYucGFnZV9hZGRyZXNzKHRoaXMuaHJlZikgPT09IHNlbGYucGFnZV9hZGRyZXNzKGxvY2F0aW9uLmhyZWYpKSB7CiAgICAgICAgLy8geWVzLCBzbyBmaW5kIG5ldyBzbGlkZSBudW1iZXIKICAgICAgICBjb25zdCBuZXdzbGlkZW51bSA9IHNlbGYuZmluZF9zbGlkZV9udW1iZXIodGhpcy5ocmVmKQoKICAgICAgICBpZiAobmV3c2xpZGVudW0gIT09IHNlbGYuc2xpZGVfbnVtYmVyKSB7CiAgICAgICAgICBsZXQgc2xpZGUgPSBzZWxmLnNsaWRlc1tzZWxmLnNsaWRlX251bWJlcl0KICAgICAgICAgIHNlbGYuaGlkZV9zbGlkZShzbGlkZSkKICAgICAgICAgIHNlbGYuc2xpZGVfbnVtYmVyID0gbmV3c2xpZGVudW0KICAgICAgICAgIHNsaWRlID0gc2VsZi5zbGlkZXNbc2VsZi5zbGlkZV9udW1iZXJdCiAgICAgICAgICBzZWxmLnNob3dfc2xpZGUoc2xpZGUpCiAgICAgICAgICBzZWxmLnNldF9sb2NhdGlvbigpCiAgICAgICAgfQogICAgICB9IGVsc2UgeyB3M2NTbGlkeS5zdG9wX3Byb3BhZ2F0aW9uKGV2ZW50KSB9CgogICAgICAvLyAgICAgIGVsc2UgaWYgKHRoaXMudGFyZ2V0ID09IG51bGwpCiAgICAgIC8vICAgICAgICBsb2NhdGlvbi5ocmVmID0gdGhpcy5ocmVmCgogICAgICB0aGlzLmJsdXIoKQogICAgICBzZWxmLmRpc2FibGVfc2xpZGVfY2xpY2sgPSB0cnVlCiAgICB9CgogICAgY29uc3QgYW5jaG9ycyA9IGRvY3VtZW50LmJvZHkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2EnKQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYW5jaG9ycy5sZW5ndGg7ICsraSkgewogICAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICBhbmNob3JzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlciwgZmFsc2UpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgYW5jaG9yc1tpXS5hdHRhY2hFdmVudCgnb25jbGljaycsIGhhbmRsZXIpCiAgICAgIH0KICAgIH0KICB9LAoKICAvLyAjIyMgQ0hFQ0sgTUUgIyMjIHNlZSB3aGljaCBmdW5jdGlvbnMgYXJlIGludm9rZWQgdmlhIHNldFRpbWVvdXQKICAvLyBlaXRoZXIgZGlyZWN0bHkgb3IgaW5kaXJlY3RseSBmb3IgdXNlIG9mIHczY19zbGlkeSB2cyB0aGlzCiAgc2hvd19zbGlkZV9udW1iZXI6IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IHRpbWVyID0gdzNjU2xpZHkuZ2V0X3RpbWVyKCkKICAgIHczY1NsaWR5LnNsaWRlX251bWJlcl9lbGVtZW50LmlubmVySFRNTCA9IHRpbWVyICsgdzNjU2xpZHkubG9jYWxpemUoJ3NsaWRlJykgKyAnICcgKwogICAgICAodzNjU2xpZHkuc2xpZGVfbnVtYmVyICsgMSkgKyAnLycgKyB3M2NTbGlkeS5zbGlkZXMubGVuZ3RoCiAgfSwKCiAgLy8gZXZlcnkgMjAwbVMgY2hlY2sgaWYgdGhlIGxvY2F0aW9uIGhhcyBiZWVuIGNoYW5nZWQgYXMgYQogIC8vIHJlc3VsdCBvZiB0aGUgdXNlciBhY3RpdmF0aW5nIHRoZSBCYWNrIGJ1dHRvbi9tZW51IGl0ZW0KICAvLyBkb2Vzbid0IHdvcmsgZm9yIE9wZXJhIDwgOS41CiAgY2hlY2tfbG9jYXRpb246IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IGhhc2ggPSBsb2NhdGlvbi5oYXNoCgogICAgaWYgKHczY1NsaWR5LnNsaWRlX251bWJlciA+IDAgJiYgKGhhc2ggPT09ICcnIHx8IGhhc2ggPT09ICcjJykpIHsKICAgICAgdzNjU2xpZHkuZ290b19zbGlkZSgwKQogICAgfSBlbHNlIGlmIChoYXNoLmxlbmd0aCA+IDIgJiYgaGFzaCAhPT0gJyMoJyArICh3M2NTbGlkeS5zbGlkZV9udW1iZXIgKyAxKSArICcpJykgewogICAgICBjb25zdCBudW0gPSBwYXJzZUludChsb2NhdGlvbi5oYXNoLnN1YnN0cigyKSkKCiAgICAgIGlmICghaXNOYU4obnVtKSkgeyB3M2NTbGlkeS5nb3RvX3NsaWRlKG51bSAtIDEpIH0KICAgIH0KCiAgICBpZiAodzNjU2xpZHkudGltZV9sZWZ0ICYmIHczY1NsaWR5LnNsaWRlX251bWJlciA+IDApIHsKICAgICAgdzNjU2xpZHkuc2hvd19zbGlkZV9udW1iZXIoKQoKICAgICAgaWYgKHczY1NsaWR5LnRpbWVfbGVmdCA+IDApIHsgdzNjU2xpZHkudGltZV9sZWZ0IC09IDIwMCB9CiAgICB9CiAgfSwKCiAgZ2V0X3RpbWVyOiBmdW5jdGlvbiAoKSB7CiAgICBsZXQgdGltZXIgPSAnJwogICAgaWYgKHczY1NsaWR5LnRpbWVfbGVmdCkgewogICAgICBsZXQgc2VjcyA9IE1hdGguZmxvb3IodzNjU2xpZHkudGltZV9sZWZ0IC8gMTAwMCkKICAgICAgY29uc3QgbWlucyA9IE1hdGguZmxvb3Ioc2VjcyAvIDYwKQogICAgICBzZWNzID0gc2VjcyAlIDYwCiAgICAgIHRpbWVyID0gKG1pbnMgPyBtaW5zICsgJ20nIDogJycpICsgc2VjcyArICdzICcKICAgIH0KCiAgICByZXR1cm4gdGltZXIKICB9LAoKICAvLyB0aGlzIGRvZXNuJ3QgcHVzaCBsb2NhdGlvbiBvbnRvIGhpc3Rvcnkgc3RhY2sgZm9yIElFCiAgLy8gZm9yIHdoaWNoIGEgaGlkZGVuIGlmcmFtZSBoYWNrIGlzIG5lZWRlZDogbG9hZCBwYWdlIGludG8KICAvLyB0aGUgaWZyYW1lIHdpdGggc2NyaXB0IHRoYXQgc2V0J3MgcGFyZW50J3MgbG9jYXRpb24uaGFzaAogIC8vIGJ1dCB0aGF0IHdvbid0IHdvcmsgZm9yIHN0YW5kYWxvbmUgdXNlIHVubGVzcyB3ZSBjYW4KICAvLyBjcmVhdGUgdGhlIHBhZ2UgZHluYW1pY2FsbHkgdmlhIGEgamF2YXNjcmlwdDogVVJMCiAgLy8gIyMjIHVzZSBoaXN0b3J5LnB1c2hTdGF0ZSBpZiBhdmFpbGFibGUKICBzZXRfbG9jYXRpb246IGZ1bmN0aW9uICgpIHsKICAgIGxldCB1cmkgPSB3M2NTbGlkeS5wYWdlX2FkZHJlc3MobG9jYXRpb24uaHJlZikKICAgIGxldCBoYXNoID0gJyMoJyArICh3M2NTbGlkeS5zbGlkZV9udW1iZXIgKyAxKSArICcpJwoKICAgIGlmICh3M2NTbGlkeS5zbGlkZV9udW1iZXIgPj0gMCkgeyB1cmkgPSB1cmkgKyBoYXNoIH0KCiAgICBpZiAodHlwZW9mIChoaXN0b3J5LnB1c2hTdGF0ZSkgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIGRvY3VtZW50LnRpdGxlID0gdzNjU2xpZHkudGl0bGUgKyAnICgnICsgKHczY1NsaWR5LnNsaWRlX251bWJlciArIDEpICsgJyknCiAgICAgIGhpc3RvcnkucHVzaFN0YXRlKDAsIGRvY3VtZW50LnRpdGxlLCBoYXNoKQogICAgICB3M2NTbGlkeS5zaG93X3NsaWRlX251bWJlcigpCiAgICAgIHczY1NsaWR5Lm5vdGlmeV9vYnNlcnZlcnMoKQogICAgICByZXR1cm4KICAgIH0KCiAgICBpZiAodzNjU2xpZHkuaWUgJiYgKHczY1NsaWR5LmllNiB8fCB3M2NTbGlkeS5pZTcpKSB7IHczY1NsaWR5LnB1c2hfaGFzaChoYXNoKSB9CgogICAgaWYgKHVyaSAhPT0gbG9jYXRpb24uaHJlZikgeyBsb2NhdGlvbi5ocmVmID0gdXJpIH0vLyAmJiAha2h0bWwKCiAgICBpZiAodGhpcy5raHRtbCkgeyBoYXNoID0gJygnICsgKHczY1NsaWR5LnNsaWRlX251bWJlciArIDEpICsgJyknIH0KCiAgICBpZiAoIXRoaXMuaWUgJiYgbG9jYXRpb24uaGFzaCAhPT0gaGFzaCAmJiBsb2NhdGlvbi5oYXNoICE9PSAnJykgewogICAgICBsb2NhdGlvbi5oYXNoID0gaGFzaAogICAgfQoKICAgIGRvY3VtZW50LnRpdGxlID0gdzNjU2xpZHkudGl0bGUgKyAnICgnICsgKHczY1NsaWR5LnNsaWRlX251bWJlciArIDEpICsgJyknCiAgICB3M2NTbGlkeS5zaG93X3NsaWRlX251bWJlcigpCiAgICB3M2NTbGlkeS5ub3RpZnlfb2JzZXJ2ZXJzKCkKICB9LAoKICBub3RpZnlfb2JzZXJ2ZXJzOiBmdW5jdGlvbiAoKSB7CiAgICBjb25zdCBzbGlkZSA9IHRoaXMuc2xpZGVzW3RoaXMuc2xpZGVfbnVtYmVyXQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5vYnNlcnZlcnMubGVuZ3RoOyArK2kpIHsKICAgICAgdGhpcy5vYnNlcnZlcnNbaV0odGhpcy5zbGlkZV9udW1iZXIgKyAxLCB0aGlzLmZpbmRfaGVhZGluZyhzbGlkZSkuaW5uZXJUZXh0LCBsb2NhdGlvbi5ocmVmKQogICAgfQogIH0sCgogIGFkZF9vYnNlcnZlcjogZnVuY3Rpb24gKG9ic2VydmVyKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub2JzZXJ2ZXJzLmxlbmd0aDsgKytpKSB7CiAgICAgIGlmIChvYnNlcnZlciA9PT0gdGhpcy5vYnNlcnZlcnNbaV0pIHsgcmV0dXJuIH0KICAgIH0KCiAgICB0aGlzLm9ic2VydmVycy5wdXNoKG9ic2VydmVyKQogIH0sCgogIHJlbW92ZV9vYnNlcnZlcjogZnVuY3Rpb24gKG9ic2VydmVyKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub2JzZXJ2ZXJzLmxlbmd0aDsgKytpKSB7CiAgICAgIGlmIChvYnNlcnZlciA9PT0gdGhpcy5vYnNlcnZlcnNbaV0pIHsKICAgICAgICB0aGlzLm9ic2VydmVycy5zcGxpY2UoaSwgMSkKICAgICAgICBicmVhawogICAgICB9CiAgICB9CiAgfSwKCiAgcGFnZV9hZGRyZXNzOiBmdW5jdGlvbiAodXJpKSB7CiAgICBsZXQgaSA9IHVyaS5pbmRleE9mKCcjJykKCiAgICBpZiAoaSA8IDApIHsgaSA9IHVyaS5pbmRleE9mKCclMjMnKSB9CgogICAgLy8gY2hlY2sgaWYgYW5jaG9yIGlzIGVudGlyZSBwYWdlCgogICAgaWYgKGkgPCAwKSB7IHJldHVybiB1cmkgfS8vIHllcwoKICAgIHJldHVybiB1cmkuc3Vic3RyKDAsIGkpCiAgfSwKCiAgLy8gb25seSB1c2VkIGZvciBJRTYgYW5kIElFNwogIG9uX2ZyYW1lX2xvYWRlZDogZnVuY3Rpb24gKGhhc2gpIHsKICAgIGxvY2F0aW9uLmhhc2ggPSBoYXNoCiAgICBjb25zdCB1cmkgPSB3M2NTbGlkeS5wYWdlX2FkZHJlc3MobG9jYXRpb24uaHJlZikKICAgIGxvY2F0aW9uLmhyZWYgPSB1cmkgKyBoYXNoCiAgfSwKCiAgLy8gaGlzdG9yeSBoYWNrIHdpdGggdGhhbmtzIHRvIEJlcnRyYW5kIExlIFJveQogIHB1c2hfaGFzaDogZnVuY3Rpb24gKGhhc2gpIHsKICAgIGlmIChoYXNoID09PSAnJykgaGFzaCA9ICcjKDEpJwogICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBoYXNoCgogICAgY29uc3QgZG9jID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpc3RvcnlGcmFtZScpLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQKICAgIGRvYy5vcGVuKCJqYXZhc2NyaXB0Oic8aHRtbD48L2h0bWw+JyIpCiAgICBkb2Mud3JpdGUoIjxodG1sPjxoZWFkPjxzY3JpcHQgdHlwZT1cInRleHQvamF2YXNjcmlwdFwiPndpbmRvdy5wYXJlbnQudzNjX3NsaWR5Lm9uX2ZyYW1lX2xvYWRlZCgnIiArCiAgICAgIChoYXNoKSArICInKTs8L3NjcmlwdD48L2hlYWQ+PGJvZHk+aGVsbG8gbXVtPC9ib2R5PjwvaHRtbD4iKQogICAgZG9jLmNsb3NlKCkKICB9LAoKICAvLyBmaW5kIGN1cnJlbnQgc2xpZGUgYmFzZWQgdXBvbiBsb2NhdGlvbgogIC8vIGZpcnN0IGZpbmQgdGFyZ2V0IGFuY2hvciBhbmQgdGhlbiBsb29rCiAgLy8gZm9yIGFzc29jaWF0ZWQgZGl2IGVsZW1lbnQgZW5jbG9zaW5nIGl0CiAgLy8gZmluYWxseSBtYXAgdGhhdCB0byBzbGlkZSBudW1iZXIKICBmaW5kX3NsaWRlX251bWJlcjogZnVuY3Rpb24gKHVyaSkgewogICAgLy8gZmlyc3QgZ2V0IGFuY2hvciBmcm9tIHBhZ2UgbG9jYXRpb24KCiAgICBjb25zdCBpID0gdXJpLmluZGV4T2YoJyMnKQoKICAgIC8vIGNoZWNrIGlmIGFuY2hvciBpcyBlbnRpcmUgcGFnZQogICAgaWYgKGkgPCAwKSB7IHJldHVybiAwIH0gLy8geWVzCgogICAgY29uc3QgYW5jaG9yID0gdW5lc2NhcGUodXJpLnN1YnN0cihpICsgMSkpCgogICAgLy8gbm93IHVzZSBhbmNob3IgYXMgWE1MIElEIHRvIGZpbmQgdGFyZ2V0CiAgICBsZXQgdGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYW5jaG9yKQoKICAgIGlmICghdGFyZ2V0KSB7CiAgICAgIC8vIGRvZXMgYW5jaG9yIGxvb2sgbGlrZSAiKDIpIiBmb3Igc2xpZGUgMiA/PwogICAgICAvLyB3aGVyZSBmaXJzdCBzbGlkZSBpcyAoMSkKICAgICAgbGV0IHJlID0gL1woKFxkKStcKS8KCiAgICAgIGlmIChhbmNob3IubWF0Y2gocmUpKSB7CiAgICAgICAgbGV0IG51bSA9IHBhcnNlSW50KGFuY2hvci5zdWJzdHJpbmcoMSwgYW5jaG9yLmxlbmd0aCAtIDEpKQoKICAgICAgICBpZiAobnVtID4gdGhpcy5zbGlkZXMubGVuZ3RoKSB7IG51bSA9IDEgfQoKICAgICAgICBpZiAoLS1udW0gPCAwKSB7IG51bSA9IDAgfQoKICAgICAgICByZXR1cm4gbnVtCiAgICAgIH0KCiAgICAgIC8vIGFjY2VwdCBbMl0gZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CiAgICAgIHJlID0gL1xbKFxkKStcXS8KCiAgICAgIGlmIChhbmNob3IubWF0Y2gocmUpKSB7CiAgICAgICAgbGV0IG51bSA9IHBhcnNlSW50KGFuY2hvci5zdWJzdHJpbmcoMSwgYW5jaG9yLmxlbmd0aCAtIDEpKQoKICAgICAgICBpZiAobnVtID4gdGhpcy5zbGlkZXMubGVuZ3RoKSB7IG51bSA9IDEgfQoKICAgICAgICBpZiAoLS1udW0gPCAwKSB7IG51bSA9IDAgfQoKICAgICAgICByZXR1cm4gbnVtCiAgICAgIH0KCiAgICAgIC8vIG9oIGRlYXIgdW5rbm93biBhbmNob3IKICAgICAgcmV0dXJuIDAKICAgIH0KCiAgICAvLyBzZWFyY2ggZm9yIGVuY2xvc2luZyBzbGlkZQoKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIC8vIGJyb3dzZXIgY29lcmNlcyBodG1sIGVsZW1lbnRzIHRvIHVwcGVyY2FzZSEKICAgICAgaWYgKHRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnZGl2JyAmJgogICAgICAgIHRoaXMuaGFzX2NsYXNzKHRhcmdldCwgJ3NsaWRlJykpIHsKICAgICAgICAvLyBmb3VuZCB0aGUgc2xpZGUgZWxlbWVudAogICAgICAgIGJyZWFrCiAgICAgIH0KCiAgICAgIC8vIG90aGVyd2lzZSB0cnkgcGFyZW50IGVsZW1lbnQgaWYgYW55CgogICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZQoKICAgICAgaWYgKCF0YXJnZXQpIHsgcmV0dXJuIDAgfSAvLyBubyBsdWNrIQogICAgfQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zbGlkZXMubGVuZ3RoOyArK2kpIHsKICAgICAgaWYgKHRoaXMuc2xpZGVzW2ldID09PSB0YXJnZXQpIHsgcmV0dXJuIGkgfSAvLyBzdWNjZXNzCiAgICB9CgogICAgLy8gb2ggZGVhciBzdGlsbCBubyBsdWNrCiAgICByZXR1cm4gMAogIH0sCgogIHByZXZpb3VzX3NsaWRlOiBmdW5jdGlvbiAoaW5jcmVtZW50YWwpIHsKICAgIGlmICghdzNjU2xpZHkudmlld19hbGwpIHsKICAgICAgbGV0IHNsaWRlCgogICAgICBpZiAoKGluY3JlbWVudGFsIHx8IHczY1NsaWR5LnNsaWRlX251bWJlciA9PT0gMCkgJiYgdzNjU2xpZHkubGFzdF9zaG93biAhPT0gbnVsbCkgewogICAgICAgIHczY1NsaWR5Lmxhc3Rfc2hvd24gPSB3M2NTbGlkeS5oaWRlX3ByZXZpb3VzX2l0ZW0odzNjU2xpZHkubGFzdF9zaG93bikKICAgICAgICB3M2NTbGlkeS5zZXRfZW9zX3N0YXR1cyhmYWxzZSkKICAgICAgfSBlbHNlIGlmICh3M2NTbGlkeS5zbGlkZV9udW1iZXIgPiAwKSB7CiAgICAgICAgc2xpZGUgPSB3M2NTbGlkeS5zbGlkZXNbdzNjU2xpZHkuc2xpZGVfbnVtYmVyXQogICAgICAgIHczY1NsaWR5LmhpZGVfc2xpZGUoc2xpZGUpCgogICAgICAgIHczY1NsaWR5LnNsaWRlX251bWJlciA9IHczY1NsaWR5LnNsaWRlX251bWJlciAtIDEKICAgICAgICBzbGlkZSA9IHczY1NsaWR5LnNsaWRlc1t3M2NTbGlkeS5zbGlkZV9udW1iZXJdCiAgICAgICAgdzNjU2xpZHkuc2V0X3Zpc2liaWxpdHlfYWxsX2luY3JlbWVudGFsKCd2aXNpYmxlJykKICAgICAgICB3M2NTbGlkeS5sYXN0X3Nob3duID0gdzNjU2xpZHkucHJldmlvdXNfaW5jcmVtZW50YWxfaXRlbShudWxsKQogICAgICAgIHczY1NsaWR5LnNldF9lb3Nfc3RhdHVzKHRydWUpCiAgICAgICAgdzNjU2xpZHkuc2hvd19zbGlkZShzbGlkZSkKICAgICAgfQoKICAgICAgdzNjU2xpZHkuc2V0X2xvY2F0aW9uKCkKCiAgICAgIGlmICghdzNjU2xpZHkubnNfcG9zKSB7IHczY1NsaWR5LnJlZnJlc2hfdG9vbGJhcigyMDApIH0KICAgIH0KICB9LAoKICBuZXh0X3NsaWRlOiBmdW5jdGlvbiAoaW5jcmVtZW50YWwpIHsKICAgIGlmICghdzNjU2xpZHkudmlld19hbGwpIHsKICAgICAgbGV0IHNsaWRlID0gdzNjU2xpZHkubGFzdF9zaG93bgogICAgICBjb25zdCBsYXN0ID0gdzNjU2xpZHkubGFzdF9zaG93bgoKICAgICAgaWYgKGluY3JlbWVudGFsIHx8IHczY1NsaWR5LnNsaWRlX251bWJlciA9PT0gdzNjU2xpZHkuc2xpZGVzLmxlbmd0aCAtIDEpIHsKICAgICAgICB3M2NTbGlkeS5sYXN0X3Nob3duID0gdzNjU2xpZHkucmV2ZWFsX25leHRfaXRlbSh3M2NTbGlkeS5sYXN0X3Nob3duKQogICAgICB9CgogICAgICBpZiAoKCFpbmNyZW1lbnRhbCB8fCB3M2NTbGlkeS5sYXN0X3Nob3duID09IG51bGwpICYmCiAgICAgICAgdzNjU2xpZHkuc2xpZGVfbnVtYmVyIDwgdzNjU2xpZHkuc2xpZGVzLmxlbmd0aCAtIDEpIHsKICAgICAgICBzbGlkZSA9IHczY1NsaWR5LnNsaWRlc1t3M2NTbGlkeS5zbGlkZV9udW1iZXJdCiAgICAgICAgdzNjU2xpZHkuaGlkZV9zbGlkZShzbGlkZSkKCiAgICAgICAgdzNjU2xpZHkuc2xpZGVfbnVtYmVyID0gdzNjU2xpZHkuc2xpZGVfbnVtYmVyICsgMQogICAgICAgIHNsaWRlID0gdzNjU2xpZHkuc2xpZGVzW3czY1NsaWR5LnNsaWRlX251bWJlcl0KICAgICAgICB3M2NTbGlkeS5sYXN0X3Nob3duID0gbnVsbAogICAgICAgIHczY1NsaWR5LnNldF92aXNpYmlsaXR5X2FsbF9pbmNyZW1lbnRhbCgnaGlkZGVuJykKICAgICAgICB3M2NTbGlkeS5zaG93X3NsaWRlKHNsaWRlKQogICAgICB9IGVsc2UgaWYgKCF3M2NTbGlkeS5sYXN0X3Nob3duKSB7CiAgICAgICAgaWYgKGxhc3QgJiYgaW5jcmVtZW50YWwpIHsgdzNjU2xpZHkubGFzdF9zaG93biA9IGxhc3QgfQogICAgICB9CgogICAgICB3M2NTbGlkeS5zZXRfbG9jYXRpb24oKQoKICAgICAgdzNjU2xpZHkuc2V0X2Vvc19zdGF0dXMoIXczY1NsaWR5Lm5leHRfaW5jcmVtZW50YWxfaXRlbSh3M2NTbGlkeS5sYXN0X3Nob3duKSkKCiAgICAgIGlmICghdzNjU2xpZHkubnNfcG9zKSB7IHczY1NsaWR5LnJlZnJlc2hfdG9vbGJhcigyMDApIH0KICAgIH0KICB9LAoKICAvLyB0byBmaXJzdCBzbGlkZSB3aXRoIG5vdGhpbmcgcmV2ZWFsZWQKICAvLyBpLmUuIHN0YXRlIGF0IHN0YXJ0IG9mIHByZXNlbnRhdGlvbgogIGZpcnN0X3NsaWRlOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXczY1NsaWR5LnZpZXdfYWxsKSB7CiAgICAgIGxldCBzbGlkZQoKICAgICAgaWYgKHczY1NsaWR5LnNsaWRlX251bWJlciAhPT0gMCkgewogICAgICAgIHNsaWRlID0gdzNjU2xpZHkuc2xpZGVzW3czY1NsaWR5LnNsaWRlX251bWJlcl0KICAgICAgICB3M2NTbGlkeS5oaWRlX3NsaWRlKHNsaWRlKQoKICAgICAgICB3M2NTbGlkeS5zbGlkZV9udW1iZXIgPSAwCiAgICAgICAgc2xpZGUgPSB3M2NTbGlkeS5zbGlkZXNbdzNjU2xpZHkuc2xpZGVfbnVtYmVyXQogICAgICAgIHczY1NsaWR5Lmxhc3Rfc2hvd24gPSBudWxsCiAgICAgICAgdzNjU2xpZHkuc2V0X3Zpc2liaWxpdHlfYWxsX2luY3JlbWVudGFsKCdoaWRkZW4nKQogICAgICAgIHczY1NsaWR5LnNob3dfc2xpZGUoc2xpZGUpCiAgICAgIH0KCiAgICAgIHczY1NsaWR5LnNldF9lb3Nfc3RhdHVzKAogICAgICAgICF3M2NTbGlkeS5uZXh0X2luY3JlbWVudGFsX2l0ZW0odzNjU2xpZHkubGFzdF9zaG93bikpCiAgICAgIHczY1NsaWR5LnNldF9sb2NhdGlvbigpCiAgICB9CiAgfSwKCiAgLy8gZ290byBsYXN0IHNsaWRlIHdpdGggZXZlcnl0aGluZyByZXZlYWxlZAogIC8vIGkuZS4gc3RhdGUgYXQgZW5kIG9mIHByZXNlbnRhdGlvbgogIGxhc3Rfc2xpZGU6IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdzNjU2xpZHkudmlld19hbGwpIHsKICAgICAgbGV0IHNsaWRlCgogICAgICB3M2NTbGlkeS5sYXN0X3Nob3duID0gbnVsbCAvLyByZXZlYWxOZXh0SXRlbShsYXN0U2hvd24pOwoKICAgICAgaWYgKHczY1NsaWR5Lmxhc3Rfc2hvd24gPT0gbnVsbCAmJgogICAgICAgIHczY1NsaWR5LnNsaWRlX251bWJlciA8IHczY1NsaWR5LnNsaWRlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgc2xpZGUgPSB3M2NTbGlkeS5zbGlkZXNbdzNjU2xpZHkuc2xpZGVfbnVtYmVyXQogICAgICAgIHczY1NsaWR5LmhpZGVfc2xpZGUoc2xpZGUpCiAgICAgICAgdzNjU2xpZHkuc2xpZGVfbnVtYmVyID0gdzNjU2xpZHkuc2xpZGVzLmxlbmd0aCAtIDEKICAgICAgICBzbGlkZSA9IHczY1NsaWR5LnNsaWRlc1t3M2NTbGlkeS5zbGlkZV9udW1iZXJdCiAgICAgICAgdzNjU2xpZHkuc2V0X3Zpc2liaWxpdHlfYWxsX2luY3JlbWVudGFsKCd2aXNpYmxlJykKICAgICAgICB3M2NTbGlkeS5sYXN0X3Nob3duID0gdzNjU2xpZHkucHJldmlvdXNfaW5jcmVtZW50YWxfaXRlbShudWxsKQoKICAgICAgICB3M2NTbGlkeS5zaG93X3NsaWRlKHNsaWRlKQogICAgICB9IGVsc2UgewogICAgICAgIHczY1NsaWR5LnNldF92aXNpYmlsaXR5X2FsbF9pbmNyZW1lbnRhbCgndmlzaWJsZScpCiAgICAgICAgdzNjU2xpZHkubGFzdF9zaG93biA9IHczY1NsaWR5LnByZXZpb3VzX2luY3JlbWVudGFsX2l0ZW0obnVsbCkKICAgICAgfQoKICAgICAgdzNjU2xpZHkuc2V0X2Vvc19zdGF0dXModHJ1ZSkKICAgICAgdzNjU2xpZHkuc2V0X2xvY2F0aW9uKCkKICAgIH0KICB9LAoKICAvLyAjIyMgY2hlY2sgdGhpcyBhbmQgY29uc2lkZXIgYWRkL3JlbW92ZSBjbGFzcwogIHNldF9lb3Nfc3RhdHVzOiBmdW5jdGlvbiAoc3RhdGUpIHsKICAgIGlmICh0aGlzLmVvcykgewogICAgICB0aGlzLmVvcy5zdHlsZS5jb2xvciA9IChzdGF0ZSA/ICdyZ2IoMjQwLDI0MCwyNDApJyA6ICdyZWQnKQogICAgfQogIH0sCgogIC8vIGZpcnN0IHNsaWRlIGlzIDAKICBnb3RvX3NsaWRlOiBmdW5jdGlvbiAobnVtKSB7CiAgICAvLyBhbGVydCgiZ29pbmcgdG8gc2xpZGUgIiArIChudW0rMSkpOwogICAgbGV0IHNsaWRlID0gdzNjU2xpZHkuc2xpZGVzW3czY1NsaWR5LnNsaWRlX251bWJlcl0KICAgIHczY1NsaWR5LmhpZGVfc2xpZGUoc2xpZGUpCiAgICB3M2NTbGlkeS5zbGlkZV9udW1iZXIgPSBudW0KICAgIHNsaWRlID0gdzNjU2xpZHkuc2xpZGVzW3czY1NsaWR5LnNsaWRlX251bWJlcl0KICAgIHczY1NsaWR5Lmxhc3Rfc2hvd24gPSBudWxsCiAgICB3M2NTbGlkeS5zZXRfdmlzaWJpbGl0eV9hbGxfaW5jcmVtZW50YWwoJ2hpZGRlbicpCiAgICB3M2NTbGlkeS5zZXRfZW9zX3N0YXR1cyghdzNjU2xpZHkubmV4dF9pbmNyZW1lbnRhbF9pdGVtKHczY1NsaWR5Lmxhc3Rfc2hvd24pKQogICAgZG9jdW1lbnQudGl0bGUgPSB3M2NTbGlkeS50aXRsZSArICcgKCcgKyAodzNjU2xpZHkuc2xpZGVfbnVtYmVyICsgMSkgKyAnKScKICAgIHczY1NsaWR5LnNob3dfc2xpZGUoc2xpZGUpCiAgICB3M2NTbGlkeS5zaG93X3NsaWRlX251bWJlcigpCiAgfSwKCiAgc2hvd19zbGlkZTogZnVuY3Rpb24gKHNsaWRlKSB7CiAgICB0aGlzLnN5bmNfYmFja2dyb3VuZChzbGlkZSkKICAgIHRoaXMucmVtb3ZlX2NsYXNzKHNsaWRlLCAnaGlkZGVuJykKCiAgICAvLyB3b3JrIGFyb3VuZCBJRTkgb2JqZWN0IHJlbmRlcmluZyBidWcKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCkKICAgIH0sIDEpCiAgfSwKCiAgaGlkZV9zbGlkZTogZnVuY3Rpb24gKHNsaWRlKSB7CiAgICB0aGlzLmFkZF9jbGFzcyhzbGlkZSwgJ2hpZGRlbicpCiAgfSwKCiAgc2V0X2ZvY3VzOiBmdW5jdGlvbiAoZWxlbWVudCkgewogICAgaWYgKGVsZW1lbnQpIHsKICAgICAgZWxlbWVudC5mb2N1cygpCiAgICB9IGVsc2UgewogICAgICB3M2NTbGlkeS5oZWxwX2FuY2hvci5mb2N1cygpCgogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB3M2NTbGlkeS5oZWxwX2FuY2hvci5ibHVyKCkKICAgICAgfSwgMSkKICAgIH0KICB9LAoKICAvLyBzaG93IGp1c3QgdGhlIGJhY2tncm91bmRzIHBlcnRpbmVudCB0byB0aGlzIHNsaWRlCiAgLy8gd2hlbiBzbGlkZSBiYWNrZ3JvdW5kLWNvbG9yIGlzIHRyYW5zcGFyZW50CiAgLy8gdGhpcyBzaG91bGQgbm93IHdvcmsgd2l0aCByZ2JhIGNvbG9yIHZhbHVlcwogIHN5bmNfYmFja2dyb3VuZDogZnVuY3Rpb24gKHNsaWRlKSB7CiAgICBsZXQgYmFja2dyb3VuZAogICAgbGV0IGJnQ29sb3IKCiAgICBpZiAoc2xpZGUuY3VycmVudFN0eWxlKSB7CiAgICAgIGJnQ29sb3IgPSBzbGlkZS5jdXJyZW50U3R5bGUuYmFja2dyb3VuZENvbG9yCiAgICB9IGVsc2UgaWYgKGRvY3VtZW50LmRlZmF1bHRWaWV3KSB7CiAgICAgIGNvbnN0IHN0eWxlcyA9IGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoc2xpZGUsIG51bGwpCgogICAgICBpZiAoc3R5bGVzKSB7CiAgICAgICAgYmdDb2xvciA9IHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCdiYWNrZ3JvdW5kLWNvbG9yJykKICAgICAgfSBlbHNlIHsgLy8gYnJva2VuIGltcGxlbWVudGF0aW9uIHByb2JhYmx5IGR1ZSBTYWZhcmkgb3IgS29ucXVlcm9yCiAgICAgICAgLy8gYWxlcnQoImRlZmVjdGl2ZSBpbXBsZW1lbnRhdGlvbiBvZiBnZXRDb21wdXRlZFN0eWxlKCkiKTsKICAgICAgICBiZ0NvbG9yID0gJ3RyYW5zcGFyZW50JwogICAgICB9CiAgICB9IGVsc2UgeyBiZ0NvbG9yID0gJ3RyYW5zcGFyZW50JyB9CgogICAgaWYgKGJnQ29sb3IgPT09ICd0cmFuc3BhcmVudCcgfHwKICAgICAgYmdDb2xvci5pbmRleE9mKCdyZ2JhJykgPj0gMCB8fAogICAgICBiZ0NvbG9yLmluZGV4T2YoJ29wYWNpdHknKSA+PSAwKSB7CiAgICAgIGNvbnN0IHNsaWRlQ2xhc3MgPSB0aGlzLmdldF9jbGFzc19saXN0KHNsaWRlKQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJhY2tncm91bmRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYmFja2dyb3VuZCA9IHRoaXMuYmFja2dyb3VuZHNbaV0KCiAgICAgICAgY29uc3QgYmdDbGFzcyA9IHRoaXMuZ2V0X2NsYXNzX2xpc3QoYmFja2dyb3VuZCkKCiAgICAgICAgaWYgKHRoaXMubWF0Y2hpbmdfYmFja2dyb3VuZChzbGlkZUNsYXNzLCBiZ0NsYXNzKSkgewogICAgICAgICAgdGhpcy5yZW1vdmVfY2xhc3MoYmFja2dyb3VuZCwgJ2hpZGRlbicpCiAgICAgICAgfSBlbHNlIHsgdGhpcy5hZGRfY2xhc3MoYmFja2dyb3VuZCwgJ2hpZGRlbicpIH0KICAgICAgfQogICAgfSBlbHNlIHsgLy8gZm9yY2libHkgaGlkZSBhbGwgYmFja2dyb3VuZHMKICAgICAgdGhpcy5oaWRlX2JhY2tncm91bmRzKCkKICAgIH0KICB9LAoKICBoaWRlX2JhY2tncm91bmRzOiBmdW5jdGlvbiAoKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYmFja2dyb3VuZHMubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYmFja2dyb3VuZCA9IHRoaXMuYmFja2dyb3VuZHNbaV0KICAgICAgdGhpcy5hZGRfY2xhc3MoYmFja2dyb3VuZCwgJ2hpZGRlbicpCiAgICB9CiAgfSwKCiAgLy8gY29tcGFyZSBjbGFzc2VzIGZvciBzbGlkZSBhbmQgYmFja2dyb3VuZAogIG1hdGNoaW5nX2JhY2tncm91bmQ6IGZ1bmN0aW9uIChzbGlkZUNsYXNzLCBiZ0NsYXNzKSB7CiAgICBsZXQgY291bnQsIHJlc3VsdAoKICAgIC8vIGRlZmluZSBwYXR0ZXJuIGFzIHJlZ3VsYXIgZXhwcmVzc2lvbgogICAgY29uc3QgcGF0dGVybiA9IC9cdysvZwoKICAgIC8vIGNoZWNrIGJhY2tncm91bmQgY2xhc3MgbmFtZXMKICAgIHJlc3VsdCA9IGJnQ2xhc3MubWF0Y2gocGF0dGVybikKCiAgICBmb3IgKGxldCBpID0gY291bnQgPSAwOyBpIDwgcmVzdWx0Lmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChyZXN1bHRbaV0gPT09ICdoaWRkZW4nKSB7IGNvbnRpbnVlIH0KCiAgICAgIGlmIChyZXN1bHRbaV0gPT09ICdiYWNrZ3JvdW5kJykgeyBjb250aW51ZSB9CgogICAgICArK2NvdW50CiAgICB9CgogICAgaWYgKGNvdW50ID09PSAwKSB7IHJldHVybiB0cnVlIH0vLyBkZWZhdWx0IG1hdGNoCgogICAgLy8gY2hlY2sgZm9yIG1hdGNoZXMgYW5kIHBsYWNlIHJlc3VsdCBpbiBhcnJheQogICAgcmVzdWx0ID0gc2xpZGVDbGFzcy5tYXRjaChwYXR0ZXJuKQoKICAgIC8vIG5vdyBjaGVjayBpZiBkZXNpcmVkIG5hbWUgaXMgcHJlc2VudCBmb3IgYmFja2dyb3VuZAogICAgZm9yIChsZXQgaSA9IGNvdW50ID0gMDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKykgewogICAgICBpZiAocmVzdWx0W2ldID09PSAnaGlkZGVuJykgeyBjb250aW51ZSB9CgogICAgICBpZiAodGhpcy5oYXNfdG9rZW4oYmdDbGFzcywgcmVzdWx0W2ldKSkgeyByZXR1cm4gdHJ1ZSB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlCiAgfSwKCiAgcmVzaXplZDogZnVuY3Rpb24gKCkgewogICAgbGV0IHdpZHRoID0gMAoKICAgIGlmICh0eXBlb2YgKHdpbmRvdy5pbm5lcldpZHRoKSA9PT0gJ251bWJlcicpIHsKICAgICAgd2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCAvLyBOb24gSUUgYnJvd3NlcgogICAgfSBlbHNlIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoKSB7CiAgICAgIHdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC8vIElFNgogICAgfSBlbHNlIGlmIChkb2N1bWVudC5ib2R5ICYmIGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGgpIHsKICAgICAgd2lkdGggPSBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIC8vIElFNAogICAgfQoKICAgIGxldCBoZWlnaHQgPSAwCiAgICBpZiAodHlwZW9mICh3aW5kb3cuaW5uZXJIZWlnaHQpID09PSAnbnVtYmVyJykgewogICAgICBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLy8gTm9uIElFIGJyb3dzZXIKICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpIHsKICAgICAgaGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAvLyBJRTYKICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuYm9keSAmJiBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCkgewogICAgICBoZWlnaHQgPSBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAvLyBJRTQKICAgIH0KCiAgICBpZiAoaGVpZ2h0ICYmICh3aWR0aCAvIGhlaWdodCA+IDEuMDUgKiAxMDI0IC8gNzY4KSkgewogICAgICB3aWR0aCA9IGhlaWdodCAqIDEwMjQuMCAvIDc2OAogICAgfQoKICAgIC8vIElFIGZpcmVzIG9uIHJlc2l6ZSBldmVuIHdoZW4gb25seSBmb250IHNpemUgaXMgY2hhbmdlZCEKICAgIC8vIHNvIHdlIGRvIGEgY2hlY2sgdG8gYXZvaWQgYmxvY2tpbmcgPCBhbmQgPiBhY3Rpb25zCiAgICBpZiAod2lkdGggIT09IHczY1NsaWR5Lmxhc3Rfd2lkdGggfHwgaGVpZ2h0ICE9PSB3M2NTbGlkeS5sYXN0X2hlaWdodCkgewogICAgICBpZiAod2lkdGggPj0gMTEwMCkgewogICAgICAgIHczY1NsaWR5LnNpemVfaW5kZXggPSA1IC8vIDQKICAgICAgfSBlbHNlIGlmICh3aWR0aCA+PSAxMDAwKSB7CiAgICAgICAgdzNjU2xpZHkuc2l6ZV9pbmRleCA9IDQgLy8gMwogICAgICB9IGVsc2UgaWYgKHdpZHRoID49IDgwMCkgewogICAgICAgIHczY1NsaWR5LnNpemVfaW5kZXggPSAzIC8vIDIKICAgICAgfSBlbHNlIGlmICh3aWR0aCA+PSA2MDApIHsKICAgICAgICB3M2NTbGlkeS5zaXplX2luZGV4ID0gMiAvLyAxCiAgICAgIH0gZWxzZSBpZiAod2lkdGgpIHsKICAgICAgICB3M2NTbGlkeS5zaXplX2luZGV4ID0gMAogICAgICB9CgogICAgICAvLyBhZGQgaW4gZm9udCBzaXplIGFkanVzdG1lbnQgZnJvbSBtZXRhIGVsZW1lbnQgZS5nLgogICAgICAvLyA8bWV0YSBuYW1lPSJmb250LXNpemUtYWRqdXN0bWVudCIgY29udGVudD0iLTIiIC8+CiAgICAgIC8vIHVzZWZ1bCB3aGVuIHNsaWRlcyBoYXZlIHRvbyBtdWNoIGNvbnRlbnQgOy0pCgogICAgICBpZiAodzNjU2xpZHkuc2l6ZV9pbmRleCArIHczY1NsaWR5LnNpemVfYWRqdXN0bWVudCA+PSAwICYmCiAgICAgICAgdzNjU2xpZHkuc2l6ZV9pbmRleCArIHczY1NsaWR5LnNpemVfYWRqdXN0bWVudCA8IHczY1NsaWR5LnNpemVzLmxlbmd0aCkgewogICAgICAgIHczY1NsaWR5LnNpemVfaW5kZXggPSB3M2NTbGlkeS5zaXplX2luZGV4ICsgdzNjU2xpZHkuc2l6ZV9hZGp1c3RtZW50CiAgICAgIH0KCiAgICAgIC8vIGVuYWJsZXMgY3Jvc3MgYnJvd3NlciB1c2Ugb2YgcmVsYXRpdmUgd2lkdGgvaGVpZ2h0CiAgICAgIC8vIG9uIG9iamVjdCBlbGVtZW50cyBmb3IgdXNlIHdpdGggU1ZHIGFuZCBGbGFzaCBtZWRpYQogICAgICB3M2NTbGlkeS5hZGp1c3Rfb2JqZWN0X2RpbWVuc2lvbnMod2lkdGgsIGhlaWdodCkKCiAgICAgIGlmIChkb2N1bWVudC5ib2R5LnN0eWxlLmZvbnRTaXplICE9PSB3M2NTbGlkeS5zaXplc1t3M2NTbGlkeS5zaXplX2luZGV4XSkgewogICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuZm9udFNpemUgPSB3M2NTbGlkeS5zaXplc1t3M2NTbGlkeS5zaXplX2luZGV4XQogICAgICB9CgogICAgICB3M2NTbGlkeS5sYXN0X3dpZHRoID0gd2lkdGgKICAgICAgdzNjU2xpZHkubGFzdF9oZWlnaHQgPSBoZWlnaHQKCiAgICAgIC8vIGZvcmNlIHJlZmxvdyB0byB3b3JrIGFyb3VuZCBNb3ppbGxhIGJ1ZwogICAgICBpZiAodzNjU2xpZHkubnNfcG9zKSB7CiAgICAgICAgY29uc3Qgc2xpZGUgPSB3M2NTbGlkeS5zbGlkZXNbdzNjU2xpZHkuc2xpZGVfbnVtYmVyXQogICAgICAgIHczY1NsaWR5LmhpZGVfc2xpZGUoc2xpZGUpCiAgICAgICAgdzNjU2xpZHkuc2hvd19zbGlkZShzbGlkZSkKICAgICAgfQoKICAgICAgLy8gZm9yY2UgY29ycmVjdCBwb3NpdGlvbmluZyBvZiB0b29sYmFyCiAgICAgIHczY1NsaWR5LnJlZnJlc2hfdG9vbGJhcigyMDApCiAgICB9CiAgfSwKCiAgc2Nyb2xsZWQ6IGZ1bmN0aW9uICgpIHsKICAgIGlmICh3M2NTbGlkeS50b29sYmFyICYmICF3M2NTbGlkeS5uc19wb3MgJiYgIXczY1NsaWR5LmllNykgewogICAgICB3M2NTbGlkeS5oYWNrX29mZnNldCA9IHczY1NsaWR5LnNjcm9sbF94X29mZnNldCgpCiAgICAgIC8vIGhpZGUgdG9vbGJhcgogICAgICB3M2NTbGlkeS50b29sYmFyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScKCiAgICAgIC8vIG1ha2UgaXQgcmVhcHBlYXIgbGF0ZXIKICAgICAgaWYgKHczY1NsaWR5LnNjcm9sbGhhY2sgPT09IDAgJiYgIXczY1NsaWR5LnZpZXdfYWxsKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHczY1NsaWR5LnNob3dfdG9vbGJhcigpIH0sIDEwMDApCiAgICAgICAgdzNjU2xpZHkuc2Nyb2xsaGFjayA9IDEKICAgICAgfQogICAgfQogIH0sCgogIGhpZGVfdG9vbGJhcjogZnVuY3Rpb24gKCkgewogICAgdzNjU2xpZHkuYWRkX2NsYXNzKHczY1NsaWR5LnRvb2xiYXIsICdoaWRkZW4nKQogICAgd2luZG93LmZvY3VzKCkKICB9LAoKICAvLyB1c2VkIHRvIGVuc3VyZSBJRSByZWZyZXNoZXMgdG9vbGJhciBpbiBjb3JyZWN0IHBvc2l0aW9uCiAgcmVmcmVzaF90b29sYmFyOiBmdW5jdGlvbiAoaW50ZXJ2YWwpIHsKICAgIGlmICghdzNjU2xpZHkubnNfcG9zICYmICF3M2NTbGlkeS5pZTcpIHsKICAgICAgdzNjU2xpZHkuaGlkZV90b29sYmFyKCkKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHczY1NsaWR5LnNob3dfdG9vbGJhcigpIH0sIGludGVydmFsKQogICAgfQogIH0sCgogIC8vIHJlc3RvcmVzIHRvb2xiYXIgYWZ0ZXIgc2hvcnQgZGVsYXkKICBzaG93X3Rvb2xiYXI6IGZ1bmN0aW9uICgpIHsKICAgIGlmICh3M2NTbGlkeS53YW50X3Rvb2xiYXIpIHsKICAgICAgdzNjU2xpZHkudG9vbGJhci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJwoKICAgICAgaWYgKCF3M2NTbGlkeS5uc19wb3MpIHsKICAgICAgICAvLyBhZGp1c3QgcG9zaXRpb24gdG8gYWxsb3cgZm9yIHNjcm9sbGluZwogICAgICAgIGNvbnN0IHhvZmZzZXQgPSB3M2NTbGlkeS5zY3JvbGxfeF9vZmZzZXQoKQogICAgICAgIHczY1NsaWR5LnRvb2xiYXIuc3R5bGUubGVmdCA9IHhvZmZzZXQKICAgICAgICB3M2NTbGlkeS50b29sYmFyLnN0eWxlLnJpZ2h0ID0geG9mZnNldAoKICAgICAgICAvLyBkZXRlcm1pbmUgdmVydGljYWwgc2Nyb2xsIG9mZnNldAogICAgICAgIC8vIHZhciB5b2Zmc2V0ID0gc2Nyb2xsWU9mZnNldCgpOwoKICAgICAgICAvLyBib3R0b20gaXMgZG9jIGhlaWdodCAtIHdpbmRvdyBoZWlnaHQgLSBzY3JvbGwgb2Zmc2V0CiAgICAgICAgLy8gdmFyIGJvdHRvbSA9IGRvY3VtZW50SGVpZ2h0KCkgLSBsYXN0SGVpZ2h0IC0geW9mZnNldAoKICAgICAgICAvLyBpZiAoeW9mZnNldCA+IDAgfHwgZG9jdW1lbnRIZWlnaHQoKSA+IGxhc3RIZWlnaHQpCiAgICAgICAgLy8gICBib3R0b20gKz0gMTY7ICAvLyBhbGxvdyBmb3IgaGVpZ2h0IG9mIHNjcm9sbGJhcgoKICAgICAgICB3M2NTbGlkeS50b29sYmFyLnN0eWxlLmJvdHRvbSA9IDAgLy8gYm90dG9tOwogICAgICB9CgogICAgICB3M2NTbGlkeS5yZW1vdmVfY2xhc3ModzNjU2xpZHkudG9vbGJhciwgJ2hpZGRlbicpCiAgICB9CgogICAgdzNjU2xpZHkuc2Nyb2xsaGFjayA9IDAKCiAgICAvLyBzZXQgdGhlIGtleWJvYXJkIGZvY3VzIHRvIHRoZSBoZWxwIGxpbmsgb24gdGhlCiAgICAvLyB0b29sYmFyIHRvIGVuc3VyZSB0aGF0IGRvY3VtZW50IGhhcyB0aGUgZm9jdXMKICAgIC8vIElFIGRvZXNuJ3QgYWx3YXlzIHdvcmsgd2l0aCB3aW5kb3cuZm9jdXMoKQogICAgLy8gYW5kIHRoaXMgaGFjayBoYXMgYmVuZWZpdCBvZiBFbnRlciBmb3IgaGVscAoKICAgIHRyeSB7CiAgICAgIGlmICghdzNjU2xpZHkub3BlcmEpIHsgdzNjU2xpZHkuc2V0X2ZvY3VzKCkgfQogICAgfSBjYXRjaCAoZSkgeyB9CiAgfSwKCiAgLy8gaW52b2tlZCB2aWEgRiBrZXkKICB0b2dnbGVfdG9vbGJhcjogZnVuY3Rpb24gKCkgewogICAgaWYgKCF3M2NTbGlkeS52aWV3X2FsbCkgewogICAgICBpZiAodzNjU2xpZHkuaGFzX2NsYXNzKHczY1NsaWR5LnRvb2xiYXIsICdoaWRkZW4nKSkgewogICAgICAgIHczY1NsaWR5LnJlbW92ZV9jbGFzcyh3M2NTbGlkeS50b29sYmFyLCAnaGlkZGVuJykKICAgICAgICB3M2NTbGlkeS53YW50X3Rvb2xiYXIgPSAxCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdzNjU2xpZHkuYWRkX2NsYXNzKHczY1NsaWR5LnRvb2xiYXIsICdoaWRkZW4nKQogICAgICAgIHczY1NsaWR5LndhbnRfdG9vbGJhciA9IDAKICAgICAgfQogICAgfQogIH0sCgogIHNjcm9sbF94X29mZnNldDogZnVuY3Rpb24gKCkgewogICAgaWYgKHdpbmRvdy5wYWdlWE9mZnNldCkgeyByZXR1cm4gc2VsZi5wYWdlWE9mZnNldCB9CgogICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJgogICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0KSB7CiAgICAgIHJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdAogICAgfQoKICAgIGlmIChkb2N1bWVudC5ib2R5KSB7IHJldHVybiBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQgfQoKICAgIHJldHVybiAwCiAgfSwKCiAgc2Nyb2xsX3lfb2Zmc2V0OiBmdW5jdGlvbiAoKSB7CiAgICBpZiAod2luZG93LnBhZ2VZT2Zmc2V0KSB7IHJldHVybiBzZWxmLnBhZ2VZT2Zmc2V0IH0KCiAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmCiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCkgewogICAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcAogICAgfQoKICAgIGlmIChkb2N1bWVudC5ib2R5KSB7IHJldHVybiBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCB9CgogICAgcmV0dXJuIDAKICB9LAoKICAvLyBsb29raW5nIGZvciBhIHdheSB0byBkZXRlcm1pbmUgaGVpZ2h0IG9mIHNsaWRlIGNvbnRlbnQKICAvLyB0aGUgc2xpZGUgaXRzZWxmIGlzIHNldCB0byB0aGUgaGVpZ2h0IG9mIHRoZSB3aW5kb3cKICBvcHRpbWl6ZV9mb250X3NpemU6IGZ1bmN0aW9uICgpIHsKICAgIGNvbnN0IHNsaWRlID0gdzNjU2xpZHkuc2xpZGVzW3czY1NsaWR5LnNsaWRlX251bWJlcl0KCiAgICAvLyB2YXIgZGggPSBkb2N1bWVudEhlaWdodCgpOyAvL2dldERvY0hlaWdodChkb2N1bWVudCk7CiAgICBjb25zdCBkaCA9IHNsaWRlLnNjcm9sbEhlaWdodAogICAgY29uc3Qgd2ggPSB0aGlzLmdldFdpbmRvd0hlaWdodCgpCiAgICBjb25zdCB1ID0gMTAwICogZGggLyB3aAoKICAgIGFsZXJ0KCd3aW5kb3cgdXRpbGl6YXRpb24gPSAnICsgdSArICclIChkb2MgJyArCiAgICAgIGRoICsgJyB3aW4gJyArIHdoICsgJyknKQogIH0sCgogIC8vIGZyb20gZG9jdW1lbnQgb2JqZWN0CiAgZ2V0X2RvY19oZWlnaHQ6IGZ1bmN0aW9uIChkb2MpIHsKICAgIGlmICghZG9jKSB7IGRvYyA9IGRvY3VtZW50IH0KCiAgICBpZiAoZG9jICYmIGRvYy5ib2R5ICYmIGRvYy5ib2R5Lm9mZnNldEhlaWdodCkgewogICAgICByZXR1cm4gZG9jLmJvZHkub2Zmc2V0SGVpZ2h0IC8vIG5zL2dlY2tvIHN5bnRheAogICAgfQoKICAgIGlmIChkb2MgJiYgZG9jLmJvZHkgJiYgZG9jLmJvZHkuc2Nyb2xsSGVpZ2h0KSB7CiAgICAgIHJldHVybiBkb2MuYm9keS5zY3JvbGxIZWlnaHQKICAgIH0KCiAgICBhbGVydCgiY291bGRuJ3QgZGV0ZXJtaW5lIGRvY3VtZW50IGhlaWdodCIpCiAgfSwKCiAgZ2V0X3dpbmRvd19oZWlnaHQ6IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0eXBlb2YgKHdpbmRvdy5pbm5lckhlaWdodCkgPT09ICdudW1iZXInKSB7CiAgICAgIHJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQgLy8gTm9uIElFIGJyb3dzZXIKICAgIH0KCiAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpIHsKICAgICAgcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLy8gSUU2CiAgICB9CgogICAgaWYgKGRvY3VtZW50LmJvZHkgJiYgZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQpIHsKICAgICAgcmV0dXJuIGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0IC8vIElFNAogICAgfQogIH0sCgogIGRvY3VtZW50X2hlaWdodDogZnVuY3Rpb24gKCkgewogICAgY29uc3Qgc2ggPSBkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodAogICAgY29uc3Qgb2ggPSBkb2N1bWVudC5ib2R5Lm9mZnNldEhlaWdodAoKICAgIGlmIChzaCAmJiBvaCkgewogICAgICByZXR1cm4gKHNoID4gb2ggPyBzaCA6IG9oKQogICAgfQoKICAgIC8vIG5vIGlkZWEhCiAgICByZXR1cm4gMAogIH0sCgogIHNtYWxsZXI6IGZ1bmN0aW9uICgpIHsKICAgIGlmICh3M2NTbGlkeS5zaXplX2luZGV4ID4gMCkgewogICAgICAtLXczY1NsaWR5LnNpemVfaW5kZXgKICAgIH0KCiAgICB3M2NTbGlkeS50b29sYmFyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScKICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuZm9udFNpemUgPSB3M2NTbGlkeS5zaXplc1t3M2NTbGlkeS5zaXplX2luZGV4XQogICAgY29uc3Qgc2xpZGUgPSB3M2NTbGlkeS5zbGlkZXNbdzNjU2xpZHkuc2xpZGVfbnVtYmVyXQogICAgdzNjU2xpZHkuaGlkZV9zbGlkZShzbGlkZSkKICAgIHczY1NsaWR5LnNob3dfc2xpZGUoc2xpZGUpCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgdzNjU2xpZHkuc2hvd190b29sYmFyKCkgfSwgNTApCiAgfSwKCiAgYmlnZ2VyOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAodzNjU2xpZHkuc2l6ZV9pbmRleCA8IHczY1NsaWR5LnNpemVzLmxlbmd0aCAtIDEpIHsKICAgICAgKyt3M2NTbGlkeS5zaXplX2luZGV4CiAgICB9CgogICAgdzNjU2xpZHkudG9vbGJhci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnCiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmZvbnRTaXplID0gdzNjU2xpZHkuc2l6ZXNbdzNjU2xpZHkuc2l6ZV9pbmRleF0KICAgIGNvbnN0IHNsaWRlID0gdzNjU2xpZHkuc2xpZGVzW3czY1NsaWR5LnNsaWRlX251bWJlcl0KICAgIHczY1NsaWR5LmhpZGVfc2xpZGUoc2xpZGUpCiAgICB3M2NTbGlkeS5zaG93X3NsaWRlKHNsaWRlKQogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHczY1NsaWR5LnNob3dfdG9vbGJhcigpIH0sIDUwKQogIH0sCgogIC8vIGVuYWJsZXMgY3Jvc3MgYnJvd3NlciB1c2Ugb2YgcmVsYXRpdmUgd2lkdGgvaGVpZ2h0CiAgLy8gb24gb2JqZWN0IGVsZW1lbnRzIGZvciB1c2Ugd2l0aCBTVkcgYW5kIEZsYXNoIG1lZGlhCiAgLy8gd2l0aCB0aGFua3MgdG8gSXZhbiBIZXJtYW4gZm9yIHRoZSBzdWdnZXN0aW9uCiAgYWRqdXN0X29iamVjdF9kaW1lbnNpb25zOiBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3M2NTbGlkeS5vYmplY3RzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXMub2JqZWN0c1tpXQogICAgICBjb25zdCBtaW1lVHlwZSA9IG9iai5nZXRBdHRyaWJ1dGUoJ3R5cGUnKQoKICAgICAgaWYgKG1pbWVUeXBlID09PSAnaW1hZ2Uvc3ZnK3htbCcgfHwgbWltZVR5cGUgPT09ICdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcpIHsKICAgICAgICBpZiAoIW9iai5pbml0aWFsV2lkdGgpIHsKICAgICAgICAgIG9iai5pbml0aWFsV2lkdGggPSBvYmouZ2V0QXR0cmlidXRlKCd3aWR0aCcpCiAgICAgICAgfQoKICAgICAgICBpZiAoIW9iai5pbml0aWFsSGVpZ2h0KSB7CiAgICAgICAgICBvYmouaW5pdGlhbEhlaWdodCA9IG9iai5nZXRBdHRyaWJ1dGUoJ2hlaWdodCcpCiAgICAgICAgfQoKICAgICAgICBpZiAob2JqLmluaXRpYWxXaWR0aCAmJiBvYmouaW5pdGlhbFdpZHRoLmNoYXJBdChvYmouaW5pdGlhbFdpZHRoLmxlbmd0aCAtIDEpID09PSAnJScpIHsKICAgICAgICAgIGNvbnN0IHcgPSBwYXJzZUludChvYmouaW5pdGlhbFdpZHRoLnNsaWNlKDAsIG9iai5pbml0aWFsV2lkdGgubGVuZ3RoIC0gMSkpCiAgICAgICAgICBjb25zdCBuZXdXID0gd2lkdGggKiAodyAvIDEwMC4wKQogICAgICAgICAgb2JqLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBuZXdXKQogICAgICAgIH0KCiAgICAgICAgaWYgKG9iai5pbml0aWFsSGVpZ2h0ICYmCiAgICAgICAgICAgIG9iai5pbml0aWFsSGVpZ2h0LmNoYXJBdChvYmouaW5pdGlhbEhlaWdodC5sZW5ndGggLSAxKSA9PT0gJyUnKSB7CiAgICAgICAgICBjb25zdCBoID0gcGFyc2VJbnQob2JqLmluaXRpYWxIZWlnaHQuc2xpY2UoMCwgb2JqLmluaXRpYWxIZWlnaHQubGVuZ3RoIC0gMSkpCiAgICAgICAgICBjb25zdCBuZXdIID0gaGVpZ2h0ICogKGggLyAxMDAuMCkKICAgICAgICAgIG9iai5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIG5ld0gpCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKCiAgLy8gbmVlZGVkIGZvciBPcGVyYSB0byBpbmhpYml0IGRlZmF1bHQgYmVoYXZpb3IKICAvLyBzaW5jZSBPcGVyYSBkZWxpdmVycyBrZXlQcmVzcyBldmVuIGlmIGtleURvd24KICAvLyB3YXMgY2FuY2VsbGVkCiAga2V5X3ByZXNzOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIGlmICghZXZlbnQpIHsgZXZlbnQgPSB3aW5kb3cuZXZlbnQgfQoKICAgIGlmICghdzNjU2xpZHkua2V5X3dhbnRlZCkgeyByZXR1cm4gdzNjU2xpZHkuY2FuY2VsKGV2ZW50KSB9CgogICAgcmV0dXJuIHRydWUKICB9LAoKICAvLyAgU2VlIGUuZy4gaHR0cDovL3d3dy5xdWlya3Ntb2RlLm9yZy9qcy9ldmVudHMva2V5cy5odG1sIGZvciBrZXljb2RlcwogIGtleV9kb3duOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIGxldCBrZXksIHRhcmdldAoKICAgIHczY1NsaWR5LmtleV93YW50ZWQgPSB0cnVlCgogICAgaWYgKCFldmVudCkgeyBldmVudCA9IHdpbmRvdy5ldmVudCB9CgogICAgLy8ga2x1ZGdlIGFyb3VuZCBOUy9JRSBkaWZmZXJlbmNlcwogICAgaWYgKHdpbmRvdy5ldmVudCkgewogICAgICBrZXkgPSB3aW5kb3cuZXZlbnQua2V5Q29kZQogICAgICB0YXJnZXQgPSB3aW5kb3cuZXZlbnQudGFyZ2V0CiAgICB9IGVsc2UgaWYgKGV2ZW50LndoaWNoKSB7CiAgICAgIGtleSA9IGV2ZW50LndoaWNoCiAgICAgIHRhcmdldCA9IGV2ZW50LnRhcmdldAogICAgfSBlbHNlIHsgcmV0dXJuIHRydWUgfSAvLyBZaWtlcyEgdW5rbm93biBicm93c2VyCgogICAgLy8gaWdub3JlIGV2ZW50IGlmIGtleSB2YWx1ZSBpcyB6ZXJvCiAgICAvLyBhcyBmb3IgYWx0IG9uIE9wZXJhIGFuZCBLb25xdWVyb3IKICAgIGlmICgha2V5KSB7IHJldHVybiB0cnVlIH0KCiAgICAvLyBhdm9pZCBpbnRlcmZlcmluZyB3aXRoIGtleXN0cm9rZQogICAgLy8gYmVoYXZpb3IgZm9yIG5vbi1zbGlkeSBjaHJvbWUgZWxlbWVudHMKICAgIGlmICghdzNjU2xpZHkuc2xpZHlfY2hyb21lKHRhcmdldCkgJiYKICAgICAgICB3M2NTbGlkeS5zcGVjaWFsX2VsZW1lbnQodGFyZ2V0KSkgewogICAgICByZXR1cm4gdHJ1ZQogICAgfQoKICAgIC8vIGNoZWNrIGZvciBjb25jdXJyZW50IGNvbnRyb2wvY29tbWFuZC9hbHQga2V5CiAgICAvLyBidXQgYXJlIHRoZXNlIG9ubHkgcHJlc2VudCBvbiBtb3VzZSBldmVudHM/CgogICAgaWYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQuYWx0S2V5IHx8IGV2ZW50Lm1ldGFLZXkpIHsKICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICAvLyBkaXNtaXNzIHRhYmxlIG9mIGNvbnRlbnRzIGlmIHZpc2libGUKICAgIGlmICh3M2NTbGlkeS5pc19zaG93bl90b2MoKSAmJiBrZXkgIT09IDkgJiYga2V5ICE9PSAxNiAmJiBrZXkgIT09IDM4ICYmIGtleSAhPT0gNDApIHsKICAgICAgdzNjU2xpZHkuaGlkZV90YWJsZV9vZl9jb250ZW50cyh0cnVlKQoKICAgICAgaWYgKGtleSA9PT0gMjcgfHwga2V5ID09PSA4NCB8fCBrZXkgPT09IDY3KSB7CiAgICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgICAgfQogICAgfQoKICAgIGlmIChrZXkgPT09IDM0KSB7IC8vIFBhZ2UgRG93bgogICAgICBpZiAodzNjU2xpZHkudmlld19hbGwpIHsgcmV0dXJuIHRydWUgfQoKICAgICAgdzNjU2xpZHkubmV4dF9zbGlkZShmYWxzZSkKCiAgICAgIHJldHVybiB3M2NTbGlkeS5jYW5jZWwoZXZlbnQpCiAgICB9IGVsc2UgaWYgKGtleSA9PT0gMzMpIHsgLy8gUGFnZSBVcAogICAgICBpZiAodzNjU2xpZHkudmlld19hbGwpIHsgcmV0dXJuIHRydWUgfQoKICAgICAgdzNjU2xpZHkucHJldmlvdXNfc2xpZGUoZmFsc2UpCgogICAgICByZXR1cm4gdzNjU2xpZHkuY2FuY2VsKGV2ZW50KQogICAgfSBlbHNlIGlmIChrZXkgPT09IDMyKSB7IC8vIHNwYWNlIGJhcgogICAgICB3M2NTbGlkeS5uZXh0X3NsaWRlKHRydWUpCgogICAgICByZXR1cm4gdzNjU2xpZHkuY2FuY2VsKGV2ZW50KQogICAgfSBlbHNlIGlmIChrZXkgPT09IDM3KSB7IC8vIExlZnQgYXJyb3cKICAgICAgdzNjU2xpZHkucHJldmlvdXNfc2xpZGUoIWV2ZW50LnNoaWZ0S2V5KQoKICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgIH0gZWxzZSBpZiAoa2V5ID09PSAzNikgeyAvLyBIb21lCiAgICAgIHczY1NsaWR5LmZpcnN0X3NsaWRlKCkKCiAgICAgIHJldHVybiB3M2NTbGlkeS5jYW5jZWwoZXZlbnQpCiAgICB9IGVsc2UgaWYgKGtleSA9PT0gMzUpIHsgLy8gRW5kCiAgICAgIHczY1NsaWR5Lmxhc3Rfc2xpZGUoKQoKICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgIH0gZWxzZSBpZiAoa2V5ID09PSAzOSkgeyAvLyBSaWdodCBhcnJvdwogICAgICB3M2NTbGlkeS5uZXh0X3NsaWRlKCFldmVudC5zaGlmdEtleSkKCiAgICAgIHJldHVybiB3M2NTbGlkeS5jYW5jZWwoZXZlbnQpCiAgICB9IGVsc2UgaWYgKGtleSA9PT0gMTMpIHsgLy8gRW50ZXIKICAgICAgaWYgKHczY1NsaWR5Lm91dGxpbmUpIHsKICAgICAgICBpZiAodzNjU2xpZHkub3V0bGluZS52aXNpYmxlKSB7CiAgICAgICAgICB3M2NTbGlkeS5mb2xkKHczY1NsaWR5Lm91dGxpbmUpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHczY1NsaWR5LnVuZm9sZCh3M2NTbGlkeS5vdXRsaW5lKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgICAgfQogICAgfSBlbHNlIGlmIChrZXkgPT09IDE4OCkgeyAvLyA8IGZvciBzbWFsbGVyIGZvbnRzCiAgICAgIHczY1NsaWR5LnNtYWxsZXIoKQoKICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgIH0gZWxzZSBpZiAoa2V5ID09PSAxOTApIHsgLy8gPiBmb3IgbGFyZ2VyIGZvbnRzCiAgICAgIHczY1NsaWR5LmJpZ2dlcigpCgogICAgICByZXR1cm4gdzNjU2xpZHkuY2FuY2VsKGV2ZW50KQogICAgfSBlbHNlIGlmIChrZXkgPT09IDE4OSB8fCBrZXkgPT09IDEwOSkgeyAvLyAtIGZvciBzbWFsbGVyIGZvbnRzCiAgICAgIHczY1NsaWR5LnNtYWxsZXIoKQoKICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgIH0gZWxzZSBpZiAoa2V5ID09PSAxODcgfHwga2V5ID09PSAxOTEgfHwga2V5ID09PSAxMDcpIHsgLy8gPSArICBmb3IgbGFyZ2VyIGZvbnRzCiAgICAgIHczY1NsaWR5LmJpZ2dlcigpCgogICAgICByZXR1cm4gdzNjU2xpZHkuY2FuY2VsKGV2ZW50KQogICAgfSBlbHNlIGlmIChrZXkgPT09IDgzKSB7IC8vIFMgZm9yIHNtYWxsZXIgZm9udHMKICAgICAgdzNjU2xpZHkuc21hbGxlcigpCgogICAgICByZXR1cm4gdzNjU2xpZHkuY2FuY2VsKGV2ZW50KQogICAgfSBlbHNlIGlmIChrZXkgPT09IDY2KSB7IC8vIEIgZm9yIGxhcmdlciBmb250cwogICAgICB3M2NTbGlkeS5iaWdnZXIoKQoKICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgIH0gZWxzZSBpZiAoa2V5ID09PSA5MCkgeyAvLyBaIGZvciBsYXN0IHNsaWRlCiAgICAgIHczY1NsaWR5Lmxhc3Rfc2xpZGUoKQoKICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgIH0gZWxzZSBpZiAoa2V5ID09PSA3MCkgeyAvLyBGIGZvciB0b2dnbGUgdG9vbGJhcgogICAgICB3M2NTbGlkeS50b2dnbGVfdG9vbGJhcigpCgogICAgICByZXR1cm4gdzNjU2xpZHkuY2FuY2VsKGV2ZW50KQogICAgfSBlbHNlIGlmIChrZXkgPT09IDY1KSB7IC8vIEEgZm9yIHRvZ2dsZSB2aWV3IHNpbmdsZS9hbGwgc2xpZGVzCiAgICAgIHczY1NsaWR5LnRvZ2dsZV92aWV3KCkKCiAgICAgIHJldHVybiB3M2NTbGlkeS5jYW5jZWwoZXZlbnQpCiAgICB9IGVsc2UgaWYgKGtleSA9PT0gNzUpIHsgLy8gdG9nZ2xlIGFjdGlvbiBvZiBsZWZ0IGNsaWNrIGZvciBuZXh0IHBhZ2UKICAgICAgdzNjU2xpZHkubW91c2VfY2xpY2tfZW5hYmxlZCA9ICF3M2NTbGlkeS5tb3VzZV9jbGlja19lbmFibGVkCgogICAgICBjb25zdCBhbGVydE1zZyA9ICh3M2NTbGlkeS5tb3VzZV9jbGlja19lbmFibGVkCiAgICAgICAgPyAnZW5hYmxlZCcKICAgICAgICA6ICdkaXNhYmxlZCcpICsgJyBtb3VzZSBjbGljayBhZHZhbmNlJwoKICAgICAgYWxlcnQodzNjU2xpZHkubG9jYWxpemUoYWxlcnRNc2cpKQoKICAgICAgcmV0dXJuIHczY1NsaWR5LmNhbmNlbChldmVudCkKICAgIH0gZWxzZSBpZiAoa2V5ID09PSA4NCB8fCBrZXkgPT09IDY3KSB7IC8vIFQgb3IgQyBmb3IgdGFibGUgb2YgY29udGVudHMKICAgICAgaWYgKHczY1NsaWR5LnRvYykgewogICAgICAgIHczY1NsaWR5LnRvZ2dsZV90YWJsZV9vZl9jb250ZW50cygpCiAgICAgIH0KCiAgICAgIHJldHVybiB3M2NTbGlkeS5jYW5jZWwoZXZlbnQpCiAgICB9IGVsc2UgaWYgKGtleSA9PT0gNzIpIHsgLy8gSCBmb3IgaGVscAogICAgICB3aW5kb3cubG9jYXRpb24gPSB3M2NTbGlkeS5oZWxwX3BhZ2UKCiAgICAgIHJldHVybiB3M2NTbGlkeS5jYW5jZWwoZXZlbnQpCiAgICB9CiAgICAvLyBlbHNlIGFsZXJ0KCJrZXkgY29kZSBpcyAiKyBrZXkpOwoKICAgIHJldHVybiB0cnVlCiAgfSwKCiAgLy8gc2FmZSBmb3IgYm90aCB0ZXh0L2h0bWwgYW5kIGFwcGxpY2F0aW9uL3hodG1sK3htbAogIGNyZWF0ZV9lbGVtZW50OiBmdW5jdGlvbiAobmFtZSkgewogICAgaWYgKHRoaXMueGh0bWwgJiYgKHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMgIT09ICd1bmRlZmluZWQnKSkgewogICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sJywgbmFtZSkKICAgIH0KCiAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChuYW1lKQogIH0sCgogIGdldF9lbGVtZW50X3N0eWxlOiBmdW5jdGlvbiAoZWxlbSwgSUVTdHlsZVByb3AsIENTU1N0eWxlUHJvcCkgewogICAgaWYgKGVsZW0uY3VycmVudFN0eWxlKSB7CiAgICAgIHJldHVybiBlbGVtLmN1cnJlbnRTdHlsZVtJRVN0eWxlUHJvcF0KICAgIH0gZWxzZSBpZiAod2luZG93LmdldENvbXB1dGVkU3R5bGUpIHsKICAgICAgY29uc3QgY29tcFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbSwgJycpCiAgICAgIHJldHVybiBjb21wU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShDU1NTdHlsZVByb3ApCiAgICB9CiAgICByZXR1cm4gJycKICB9LAoKICAvLyB0aGUgc3RyaW5nIHN0ciBpcyBhIHdoaXRlc3BhY2Ugc2VwYXJhdGVkIGxpc3Qgb2YgdG9rZW5zCiAgLy8gdGVzdCBpZiBzdHIgY29udGFpbnMgYSBwYXJ0aWN1bGFyIHRva2VuLCBlLmcuICJzbGlkZSIKICBoYXNfdG9rZW46IGZ1bmN0aW9uIChzdHIsIHRva2VuKSB7CiAgICBpZiAoc3RyKSB7CiAgICAgIC8vIGRlZmluZSBwYXR0ZXJuIGFzIHJlZ3VsYXIgZXhwcmVzc2lvbgogICAgICBjb25zdCBwYXR0ZXJuID0gL1x3Ky9nCgogICAgICAvLyBjaGVjayBmb3IgbWF0Y2hlcwogICAgICAvLyBwbGFjZSByZXN1bHQgaW4gYXJyYXkKICAgICAgY29uc3QgcmVzdWx0ID0gc3RyLm1hdGNoKHBhdHRlcm4pCgogICAgICAvLyBub3cgY2hlY2sgaWYgZGVzaXJlZCB0b2tlbiBpcyBwcmVzZW50CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHJlc3VsdFtpXSA9PT0gdG9rZW4pIHsgcmV0dXJuIHRydWUgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlCiAgfSwKCiAgZ2V0X2NsYXNzX2xpc3Q6IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICBpZiAodHlwZW9mIGVsZW1lbnQuY2xhc3NOYW1lICE9PSAndW5kZWZpbmVkJykgewogICAgICByZXR1cm4gZWxlbWVudC5jbGFzc05hbWUKICAgIH0KCiAgICByZXR1cm4gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykKICB9LAoKICBoYXNfY2xhc3M6IGZ1bmN0aW9uIChlbGVtZW50LCBuYW1lKSB7CiAgICBpZiAoZWxlbWVudC5ub2RlVHlwZSAhPT0gMSkgeyByZXR1cm4gZmFsc2UgfQoKICAgIGNvbnN0IHJlZ2V4cCA9IG5ldyBSZWdFeHAoYChefCApJHtuYW1lfVcqYCkKCiAgICBpZiAodHlwZW9mIGVsZW1lbnQuY2xhc3NOYW1lICE9PSAndW5kZWZpbmVkJykgewogICAgICByZXR1cm4gcmVnZXhwLnRlc3QoZWxlbWVudC5jbGFzc05hbWUpCiAgICB9CgogICAgcmV0dXJuIHJlZ2V4cC50ZXN0KGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdjbGFzcycpKQogIH0sCgogIHJlbW92ZV9jbGFzczogZnVuY3Rpb24gKGVsZW1lbnQsIG5hbWUpIHsKICAgIGNvbnN0IHJlZ2V4cCA9IG5ldyBSZWdFeHAoYChefCApJHtuYW1lfVcqYCkKICAgIGxldCBjbHN2YWwgPSAnJwoKICAgIGlmICh0eXBlb2YgZWxlbWVudC5jbGFzc05hbWUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIGNsc3ZhbCA9IGVsZW1lbnQuY2xhc3NOYW1lCgogICAgICBpZiAoY2xzdmFsKSB7CiAgICAgICAgY2xzdmFsID0gY2xzdmFsLnJlcGxhY2UocmVnZXhwLCAnJykKICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGNsc3ZhbAogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjbHN2YWwgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnY2xhc3MnKQoKICAgICAgaWYgKGNsc3ZhbCkgewogICAgICAgIGNsc3ZhbCA9IGNsc3ZhbC5yZXBsYWNlKHJlZ2V4cCwgJycpCiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgY2xzdmFsKQogICAgICB9CiAgICB9CiAgfSwKCiAgYWRkX2NsYXNzOiBmdW5jdGlvbiAoZWxlbWVudCwgbmFtZSkgewogICAgaWYgKCF0aGlzLmhhc19jbGFzcyhlbGVtZW50LCBuYW1lKSkgewogICAgICBpZiAodHlwZW9mIGVsZW1lbnQuY2xhc3NOYW1lICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lICs9ICcgJyArIG5hbWUKICAgICAgfSBlbHNlIHsKICAgICAgICBsZXQgY2xzdmFsID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykKICAgICAgICBjbHN2YWwgPSBjbHN2YWwgPyBjbHN2YWwgKyAnICcgKyBuYW1lIDogbmFtZQogICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsIGNsc3ZhbCkKICAgICAgfQogICAgfQogIH0sCgogIC8vIEhUTUwgZWxlbWVudHMgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIGNsYXNzPSJpbmNyZW1lbnRhbCIKICAvLyBub3RlIHRoYXQgeW91IGNhbiBhbHNvIHB1dCB0aGUgY2xhc3Mgb24gY29udGFpbmVycyBsaWtlCiAgLy8gdXAsIG9sLCBkbCwgYW5kIGRpdiB0byBtYWtlIHRoZWlyIGNvbnRlbnRzIGFwcGVhcgogIC8vIGluY3JlbWVudGFsbHkuIFVwcGVyIGNhc2UgaXMgdXNlZCBzaW5jZSB0aGlzIGlzIHdoYXQKICAvLyBicm93c2VycyByZXBvcnQgZm9yIEhUTUwgbm9kZSBuYW1lcyAodGV4dC9odG1sKS4KICBpbmNyZW1lbnRhbF9lbGVtZW50czogbnVsbCwKICBva2F5X2Zvcl9pbmNyZW1lbnRhbDogZnVuY3Rpb24gKG5hbWUpIHsKICAgIGlmICghdGhpcy5pbmNyZW1lbnRhbF9lbGVtZW50cykgewogICAgICBjb25zdCBpbmNsaXN0ID0gW10KICAgICAgaW5jbGlzdC5wID0gdHJ1ZQogICAgICBpbmNsaXN0LnByZSA9IHRydWUKICAgICAgaW5jbGlzdC5saSA9IHRydWUKICAgICAgaW5jbGlzdC5ibG9ja3F1b3RlID0gdHJ1ZQogICAgICBpbmNsaXN0LmR0ID0gdHJ1ZQogICAgICBpbmNsaXN0LmRkID0gdHJ1ZQogICAgICBpbmNsaXN0LmgyID0gdHJ1ZQogICAgICBpbmNsaXN0LmgzID0gdHJ1ZQogICAgICBpbmNsaXN0Lmg0ID0gdHJ1ZQogICAgICBpbmNsaXN0Lmg1ID0gdHJ1ZQogICAgICBpbmNsaXN0Lmg2ID0gdHJ1ZQogICAgICBpbmNsaXN0LnNwYW4gPSB0cnVlCiAgICAgIGluY2xpc3QuYWRkcmVzcyA9IHRydWUKICAgICAgaW5jbGlzdC50YWJsZSA9IHRydWUKICAgICAgaW5jbGlzdC50ciA9IHRydWUKICAgICAgaW5jbGlzdC50aCA9IHRydWUKICAgICAgaW5jbGlzdC50ZCA9IHRydWUKICAgICAgaW5jbGlzdC5pbWcgPSB0cnVlCiAgICAgIGluY2xpc3Qub2JqZWN0ID0gdHJ1ZQogICAgICB0aGlzLmluY3JlbWVudGFsX2VsZW1lbnRzID0gaW5jbGlzdAogICAgfQogICAgcmV0dXJuIHRoaXMuaW5jcmVtZW50YWxfZWxlbWVudHNbbmFtZS50b0xvd2VyQ2FzZSgpXQogIH0sCgogIG5leHRfaW5jcmVtZW50YWxfaXRlbTogZnVuY3Rpb24gKG5vZGUpIHsKICAgIGNvbnN0IGJyID0gdGhpcy5pc194aHRtbCA/ICdicicgOiAnQlInCiAgICBjb25zdCBzbGlkZSA9IHczY1NsaWR5LnNsaWRlc1t3M2NTbGlkeS5zbGlkZV9udW1iZXJdCgogICAgZm9yICg7IDspIHsKICAgICAgbm9kZSA9IHczY1NsaWR5Lm5leHRfbm9kZShzbGlkZSwgbm9kZSkKCiAgICAgIGlmIChub2RlID09IG51bGwgfHwgbm9kZS5wYXJlbnROb2RlID09IG51bGwpIHsgYnJlYWsgfQoKICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHsgLy8gRUxFTUVOVAogICAgICAgIGlmIChub2RlLm5vZGVOYW1lID09PSBicikgeyBjb250aW51ZSB9CgogICAgICAgIGlmICh3M2NTbGlkeS5oYXNfY2xhc3Mobm9kZSwgJ2luY3JlbWVudGFsJykgJiYKICAgICAgICAgICAgdzNjU2xpZHkub2theV9mb3JfaW5jcmVtZW50YWwobm9kZS5ub2RlTmFtZSkpIHsKICAgICAgICAgIHJldHVybiBub2RlCiAgICAgICAgfQoKICAgICAgICBpZiAodzNjU2xpZHkuaGFzX2NsYXNzKG5vZGUucGFyZW50Tm9kZSwgJ2luY3JlbWVudGFsJykgJiYKICAgICAgICAgICAgIXczY1NsaWR5Lmhhc19jbGFzcyhub2RlLCAnbm9uLWluY3JlbWVudGFsJykpIHsKICAgICAgICAgIHJldHVybiBub2RlCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG5vZGUKICB9LAoKICBwcmV2aW91c19pbmNyZW1lbnRhbF9pdGVtOiBmdW5jdGlvbiAobm9kZSkgewogICAgY29uc3QgYnIgPSB0aGlzLmlzX3hodG1sID8gJ2JyJyA6ICdCUicKICAgIGNvbnN0IHNsaWRlID0gdzNjU2xpZHkuc2xpZGVzW3czY1NsaWR5LnNsaWRlX251bWJlcl0KCiAgICBmb3IgKDsgOykgewogICAgICBub2RlID0gdzNjU2xpZHkucHJldmlvdXNfbm9kZShzbGlkZSwgbm9kZSkKCiAgICAgIGlmIChub2RlID09IG51bGwgfHwgbm9kZS5wYXJlbnROb2RlID09IG51bGwpIHsgYnJlYWsgfQoKICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHsKICAgICAgICBpZiAobm9kZS5ub2RlTmFtZSA9PT0gYnIpIHsgY29udGludWUgfQoKICAgICAgICBpZiAodzNjU2xpZHkuaGFzX2NsYXNzKG5vZGUsICdpbmNyZW1lbnRhbCcpICYmCiAgICAgICAgICAgIHczY1NsaWR5Lm9rYXlfZm9yX2luY3JlbWVudGFsKG5vZGUubm9kZU5hbWUpKSB7CiAgICAgICAgICByZXR1cm4gbm9kZQogICAgICAgIH0KCiAgICAgICAgaWYgKHczY1NsaWR5Lmhhc19jbGFzcyhub2RlLnBhcmVudE5vZGUsICdpbmNyZW1lbnRhbCcpICYmCiAgICAgICAgICAgICF3M2NTbGlkeS5oYXNfY2xhc3Mobm9kZSwgJ25vbi1pbmNyZW1lbnRhbCcpKSB7CiAgICAgICAgICByZXR1cm4gbm9kZQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiBub2RlCiAgfSwKCiAgLy8gc2V0IHZpc2liaWxpdHkgZm9yIGFsbCBlbGVtZW50cyBvbiBjdXJyZW50IHNsaWRlIHdpdGgKICAvLyBhIHBhcmVudCBlbGVtZW50IHdpdGggYXR0cmlidXRlIGNsYXNzPSJpbmNyZW1lbnRhbCIKICBzZXRfdmlzaWJpbGl0eV9hbGxfaW5jcmVtZW50YWw6IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgbGV0IG5vZGUgPSB0aGlzLm5leHRfaW5jcmVtZW50YWxfaXRlbShudWxsKQoKICAgIGlmICh2YWx1ZSA9PT0gJ2hpZGRlbicpIHsKICAgICAgd2hpbGUgKG5vZGUpIHsKICAgICAgICB3M2NTbGlkeS5hZGRfY2xhc3Mobm9kZSwgJ2ludmlzaWJsZScpCiAgICAgICAgbm9kZSA9IHczY1NsaWR5Lm5leHRfaW5jcmVtZW50YWxfaXRlbShub2RlKQogICAgICB9CiAgICB9IGVsc2UgeyAvLyB2YWx1ZSA9PSAidmlzaWJsZSIKICAgICAgd2hpbGUgKG5vZGUpIHsKICAgICAgICB3M2NTbGlkeS5yZW1vdmVfY2xhc3Mobm9kZSwgJ2ludmlzaWJsZScpCiAgICAgICAgbm9kZSA9IHczY1NsaWR5Lm5leHRfaW5jcmVtZW50YWxfaXRlbShub2RlKQogICAgICB9CiAgICB9CiAgfSwKCiAgLy8gcmV2ZWFsIHRoZSBuZXh0IGhpZGRlbiBpdGVtIG9uIHRoZSBzbGlkZQogIC8vIG5vZGUgaXMgbnVsbCBvciB0aGUgbm9kZSB0aGF0IHdhcyBsYXN0IHJldmVhbGVkCiAgcmV2ZWFsX25leHRfaXRlbTogZnVuY3Rpb24gKG5vZGUpIHsKICAgIG5vZGUgPSB3M2NTbGlkeS5uZXh0X2luY3JlbWVudGFsX2l0ZW0obm9kZSkKCiAgICBpZiAobm9kZSAmJiBub2RlLm5vZGVUeXBlID09PSAxKSB7IC8vIGFuIGVsZW1lbnQKICAgICAgdzNjU2xpZHkucmVtb3ZlX2NsYXNzKG5vZGUsICdpbnZpc2libGUnKQogICAgfQoKICAgIHJldHVybiBub2RlCiAgfSwKCiAgLy8gZXhhY3QgaW52ZXJzZSBvZiByZXZlYWxOZXh0SXRlbShub2RlKQogIGhpZGVfcHJldmlvdXNfaXRlbTogZnVuY3Rpb24gKG5vZGUpIHsKICAgIGlmIChub2RlICYmIG5vZGUubm9kZVR5cGUgPT09IDEpIHsgLy8gYW4gZWxlbWVudAogICAgICB3M2NTbGlkeS5hZGRfY2xhc3Mobm9kZSwgJ2ludmlzaWJsZScpCiAgICB9CgogICAgcmV0dXJuIHRoaXMucHJldmlvdXNfaW5jcmVtZW50YWxfaXRlbShub2RlKQogIH0sCgogIC8vIGxlZnQgdG8gcmlnaHQgdHJhdmVyc2FsIG9mIHJvb3QncyBjb250ZW50CiAgbmV4dF9ub2RlOiBmdW5jdGlvbiAocm9vdCwgbm9kZSkgewogICAgaWYgKG5vZGUgPT0gbnVsbCkgeyByZXR1cm4gcm9vdC5maXJzdENoaWxkIH0KCiAgICBpZiAobm9kZS5maXJzdENoaWxkKSB7IHJldHVybiBub2RlLmZpcnN0Q2hpbGQgfQoKICAgIGlmIChub2RlLm5leHRTaWJsaW5nKSB7IHJldHVybiBub2RlLm5leHRTaWJsaW5nIH0KCiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlCgogICAgICBpZiAoIW5vZGUgfHwgbm9kZSA9PT0gcm9vdCkgeyBicmVhayB9CgogICAgICBpZiAobm9kZSAmJiBub2RlLm5leHRTaWJsaW5nKSB7IHJldHVybiBub2RlLm5leHRTaWJsaW5nIH0KICAgIH0KCiAgICByZXR1cm4gbnVsbAogIH0sCgogIC8vIHJpZ2h0IHRvIGxlZnQgdHJhdmVyc2FsIG9mIHJvb3QncyBjb250ZW50CiAgcHJldmlvdXNfbm9kZTogZnVuY3Rpb24gKHJvb3QsIG5vZGUpIHsKICAgIGlmIChub2RlID09IG51bGwpIHsKICAgICAgbm9kZSA9IHJvb3QubGFzdENoaWxkCgogICAgICBpZiAobm9kZSkgewogICAgICAgIHdoaWxlIChub2RlLmxhc3RDaGlsZCkgewogICAgICAgICAgbm9kZSA9IG5vZGUubGFzdENoaWxkCiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbm9kZQogICAgfQoKICAgIGlmIChub2RlLnByZXZpb3VzU2libGluZykgewogICAgICBub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmcKCiAgICAgIHdoaWxlIChub2RlLmxhc3RDaGlsZCkgewogICAgICAgIG5vZGUgPSBub2RlLmxhc3RDaGlsZAogICAgICB9CgogICAgICByZXR1cm4gbm9kZQogICAgfQoKICAgIGlmIChub2RlLnBhcmVudE5vZGUgIT09IHJvb3QpIHsgcmV0dXJuIG5vZGUucGFyZW50Tm9kZSB9CgogICAgcmV0dXJuIG51bGwKICB9LAoKICBwcmV2aW91c19zaWJsaW5nX2VsZW1lbnQ6IGZ1bmN0aW9uIChlbCkgewogICAgZWwgPSBlbC5wcmV2aW91c1NpYmxpbmcKCiAgICB3aGlsZSAoZWwgJiYgZWwubm9kZVR5cGUgIT09IDEpIHsKICAgICAgZWwgPSBlbC5wcmV2aW91c1NpYmxpbmcKICAgIH0KCiAgICByZXR1cm4gZWwKICB9LAoKICBuZXh0X3NpYmxpbmdfZWxlbWVudDogZnVuY3Rpb24gKGVsKSB7CiAgICBlbCA9IGVsLm5leHRTaWJsaW5nCgogICAgd2hpbGUgKGVsICYmIGVsLm5vZGVUeXBlICE9PSAxKSB7CiAgICAgIGVsID0gZWwubmV4dFNpYmxpbmcKICAgIH0KCiAgICByZXR1cm4gZWwKICB9LAoKICBmaXJzdF9jaGlsZF9lbGVtZW50OiBmdW5jdGlvbiAoZWwpIHsKICAgIGxldCBub2RlCgogICAgZm9yIChub2RlID0gZWwuZmlyc3RDaGlsZDsgbm9kZTsgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpIHsKICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHsgYnJlYWsgfQogICAgfQoKICAgIHJldHVybiBub2RlCiAgfSwKCiAgZmlyc3RfdGFnOiBmdW5jdGlvbiAoZWxlbWVudCwgdGFnKSB7CiAgICBsZXQgbm9kZQoKICAgIGlmICghdGhpcy5pc194aHRtbCkgewogICAgICB0YWcgPSB0YWcudG9VcHBlckNhc2UoKQogICAgfQoKICAgIGZvciAobm9kZSA9IGVsZW1lbnQuZmlyc3RDaGlsZDsgbm9kZTsgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpIHsKICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEgJiYgbm9kZS5ub2RlTmFtZSA9PT0gdGFnKSB7CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBub2RlCiAgfSwKCiAgaGlkZV9zZWxlY3Rpb246IGZ1bmN0aW9uICgpIHsKICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7IC8vIEZpcmVmb3gsIENocm9taXVtLCBTYWZhcmksIE9wZXJhCiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKQoKICAgICAgaWYgKHNlbGVjdGlvbi5yYW5nZUNvdW50ID4gMCkgewogICAgICAgIGNvbnN0IHJhbmdlID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCkKICAgICAgICByYW5nZS5jb2xsYXBzZShmYWxzZSkKICAgICAgfQogICAgfSBlbHNlIHsgLy8gSW50ZXJuZXQgRXhwbG9yZXIKICAgICAgY29uc3QgdGV4dFJhbmdlID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCkKICAgICAgdGV4dFJhbmdlLmNvbGxhcHNlKGZhbHNlKQogICAgfQogIH0sCgogIGdldF9zZWxlY3RlZF90ZXh0OiBmdW5jdGlvbiAoKSB7CiAgICB0cnkgewogICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbikgewogICAgICAgIHJldHVybiB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkudG9TdHJpbmcoKQogICAgICB9CgogICAgICBpZiAoZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKSB7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCkKICAgICAgfQoKICAgICAgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgewogICAgICAgIHJldHVybiBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKS50ZXh0CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsgfQoKICAgIHJldHVybiAnJwogIH0sCgogIC8vIG1ha2Ugbm90ZSBvZiBsZW5ndGggb2Ygc2VsZWN0ZWQgdGV4dAogIC8vIGFzIHRoaXMgZXZhbHVhdGVzIHRvIHplcm8gaW4gY2xpY2sgZXZlbnQKICBtb3VzZV9idXR0b25fdXA6IGZ1bmN0aW9uIChfKSB7CiAgICB3M2NTbGlkeS5zZWxlY3RlZF90ZXh0X2xlbiA9IHczY1NsaWR5LmdldF9zZWxlY3RlZF90ZXh0KCkubGVuZ3RoCiAgfSwKCiAgbW91c2VfYnV0dG9uX2Rvd246IGZ1bmN0aW9uIChlKSB7CiAgICB3M2NTbGlkeS5zZWxlY3RlZF90ZXh0X2xlbiA9IHczY1NsaWR5LmdldF9zZWxlY3RlZF90ZXh0KCkubGVuZ3RoCiAgICB3M2NTbGlkeS5tb3VzZV94ID0gZS5jbGllbnRYCiAgICB3M2NTbGlkeS5tb3VzZV95ID0gZS5jbGllbnRZCiAgfSwKCiAgLy8gcmlnaHQgbW91c2UgYnV0dG9uIGNsaWNrIGlzIHJlc2VydmVkIGZvciBjb250ZXh0IG1lbnVzCiAgLy8gaXQgaXMgbW9yZSByZWxpYWJsZSB0byBkZXRlY3QgMSB0aGFuIGxlZnRjbGljawogIG1vdXNlX2J1dHRvbl9jbGljazogZnVuY3Rpb24gKGUpIHsKICAgIGlmICghZSkgewogICAgICBlID0gd2luZG93LmV2ZW50CiAgICB9CgogICAgaWYgKE1hdGguYWJzKGUuY2xpZW50WCAtIHczY1NsaWR5Lm1vdXNlX3gpICsKICAgICAgICBNYXRoLmFicyhlLmNsaWVudFkgLSB3M2NTbGlkeS5tb3VzZV95KSA+IDEwKSB7CiAgICAgIHJldHVybiB0cnVlCiAgICB9CgogICAgaWYgKHczY1NsaWR5LnNlbGVjdGVkX3RleHRfbGVuID4gMCkgeyByZXR1cm4gdHJ1ZSB9CgogICAgdGhpcy5yaWdodGNsaWNrID0gZmFsc2UKICAgIHRoaXMubGVmdGNsaWNrID0gZmFsc2UKICAgIHRoaXMubWlkZGxlY2xpY2sgPSBmYWxzZQogICAgbGV0IHRhcmdldAoKICAgIGlmICghZSkgeyBlID0gd2luZG93LmV2ZW50IH0KCiAgICBpZiAoZS50YXJnZXQpIHsKICAgICAgdGFyZ2V0ID0gZS50YXJnZXQKICAgIH0gZWxzZSBpZiAoZS5zcmNFbGVtZW50KSB7CiAgICAgIHRhcmdldCA9IGUuc3JjRWxlbWVudAogICAgfQoKICAgIC8vIHdvcmsgYXJvdW5kIFNhZmFyaSBidWcKICAgIGlmICh0YXJnZXQubm9kZVR5cGUgPT09IDMpIHsKICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGUKICAgIH0KCiAgICBpZiAoZS53aGljaCkgeyAvLyBhbGwgYnJvd3NlcnMgZXhjZXB0IElFCiAgICAgIHRoaXMubGVmdGNsaWNrID0gKGUud2hpY2ggPT09IDEpCiAgICAgIHRoaXMubWlkZGxlY2xpY2sgPSAoZS53aGljaCA9PT0gMikKICAgICAgdGhpcy5yaWdodGNsaWNrID0gKGUud2hpY2ggPT09IDMpCiAgICB9IGVsc2UgaWYgKGUuYnV0dG9uKSB7CiAgICAgIC8vIEtvbnF1ZXJvciBnaXZlcyAxIGZvciBsZWZ0LCA0IGZvciBtaWRkbGUKICAgICAgLy8gSUU2IGdpdmVzIDAgZm9yIGxlZnQgYW5kIG5vdCAxIGFzIEkgZXhwZWN0ZWQKCiAgICAgIGlmIChlLmJ1dHRvbiA9PT0gNCkgewogICAgICAgIHRoaXMubWlkZGxlY2xpY2sgPSB0cnVlCiAgICAgIH0KCiAgICAgIC8vIGFsbCBicm93c2VycyBhZ3JlZSBvbiAyIGZvciByaWdodCBidXR0b24KICAgICAgdGhpcy5yaWdodGNsaWNrID0gKGUuYnV0dG9uID09PSAyKQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5sZWZ0Y2xpY2sgPSB0cnVlCiAgICB9CgogICAgaWYgKHczY1NsaWR5LnNlbGVjdGVkX3RleHRfbGVuID4gMCkgewogICAgICB3M2NTbGlkeS5zdG9wX3Byb3BhZ2F0aW9uKGUpCiAgICAgIGUuY2FuY2VsID0gdHJ1ZQogICAgICBlLnJldHVyblZhbHVlID0gZmFsc2UKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CgogICAgLy8gZGlzbWlzcyB0YWJsZSBvZiBjb250ZW50cwogICAgdzNjU2xpZHkuaGlkZV90YWJsZV9vZl9jb250ZW50cyhmYWxzZSkKCiAgICAvLyBjaGVjayBpZiB0YXJnZXQgaXMgc29tZXRoaW5nIHRoYXQgcHJvYmFibHkgd2FudCdzIGNsaWNrcwogICAgLy8gZS5nLiBhLCBlbWJlZCwgb2JqZWN0LCBpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCwgb3B0aW9uCiAgICAvLyB2YXIgdGFnID0gdGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgogICAgaWYgKHczY1NsaWR5Lm1vdXNlX2NsaWNrX2VuYWJsZWQgJiYgdGhpcy5sZWZ0Y2xpY2sgJiYKICAgICAgIXczY1NsaWR5LnNwZWNpYWxfZWxlbWVudCh0YXJnZXQpICYmCiAgICAgICF0YXJnZXQub25jbGljaykgewogICAgICB3M2NTbGlkeS5uZXh0X3NsaWRlKHRydWUpCiAgICAgIHczY1NsaWR5LnN0b3BfcHJvcGFnYXRpb24oZSkKICAgICAgZS5jYW5jZWwgPSB0cnVlCiAgICAgIGUucmV0dXJuVmFsdWUgPSBmYWxzZQogICAgICByZXR1cm4gZmFsc2UKICAgIH0KCiAgICByZXR1cm4gdHJ1ZQogIH0sCgogIHNwZWNpYWxfZWxlbWVudDogZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgIGlmICh0aGlzLmhhc19jbGFzcyhlbGVtZW50LCAnbm9uLWludGVyYWN0aXZlJykpIHsgcmV0dXJuIGZhbHNlIH0KCiAgICBjb25zdCB0YWcgPSBlbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkKCiAgICByZXR1cm4gZWxlbWVudC5vbmtleWRvd24gfHwKICAgICAgZWxlbWVudC5vbmNsaWNrIHx8CiAgICAgIHRhZyA9PT0gJ2EnIHx8CiAgICAgIHRhZyA9PT0gJ2VtYmVkJyB8fAogICAgICB0YWcgPT09ICdvYmplY3QnIHx8CiAgICAgIHRhZyA9PT0gJ3ZpZGVvJyB8fAogICAgICB0YWcgPT09ICdhdWRpbycgfHwKICAgICAgdGFnID09PSAnc3ZnJyB8fAogICAgICB0YWcgPT09ICdjYW52YXMnIHx8CiAgICAgIHRhZyA9PT0gJ2lucHV0JyB8fAogICAgICB0YWcgPT09ICd0ZXh0YXJlYScgfHwKICAgICAgdGFnID09PSAnc2VsZWN0JyB8fAogICAgICB0YWcgPT09ICdvcHRpb24nCiAgfSwKCiAgc2xpZHlfY2hyb21lOiBmdW5jdGlvbiAoZWwpIHsKICAgIHdoaWxlIChlbCkgewogICAgICBpZiAoZWwgPT09IHczY1NsaWR5LnRvYyB8fAogICAgICAgICAgZWwgPT09IHczY1NsaWR5LnRvb2xiYXIgfHwKICAgICAgICAgIHczY1NsaWR5Lmhhc19jbGFzcyhlbCwgJ291dGxpbmUnKSkgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KCiAgICAgIGVsID0gZWwucGFyZW50Tm9kZQogICAgfQoKICAgIHJldHVybiBmYWxzZQogIH0sCgogIGdldF9rZXk6IGZ1bmN0aW9uIChlKSB7CiAgICBsZXQga2V5CgogICAgLy8ga2x1ZGdlIGFyb3VuZCBOUy9JRSBkaWZmZXJlbmNlcwogICAgaWYgKHR5cGVvZiB3aW5kb3cuZXZlbnQgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIGtleSA9IHdpbmRvdy5ldmVudC5rZXlDb2RlCiAgICB9IGVsc2UgaWYgKGUud2hpY2gpIHsKICAgICAga2V5ID0gZS53aGljaAogICAgfQoKICAgIHJldHVybiBrZXkKICB9LAoKICBnZXRfdGFyZ2V0OiBmdW5jdGlvbiAoZSkgewogICAgbGV0IHRhcmdldAoKICAgIGlmICghZSkgewogICAgICBlID0gd2luZG93LmV2ZW50CiAgICB9CgogICAgaWYgKGUudGFyZ2V0KSB7CiAgICAgIHRhcmdldCA9IGUudGFyZ2V0CiAgICB9IGVsc2UgaWYgKGUuc3JjRWxlbWVudCkgewogICAgICB0YXJnZXQgPSBlLnNyY0VsZW1lbnQKICAgIH0KCiAgICBpZiAodGFyZ2V0Lm5vZGVUeXBlICE9PSAxKSB7CiAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlCiAgICB9CgogICAgcmV0dXJuIHRhcmdldAogIH0sCgogIC8vIGRvZXMgZGlzcGxheSBwcm9wZXJ0eSBwcm92aWRlIGNvcnJlY3QgZGVmYXVsdHM/CiAgaXNfYmxvY2s6IGZ1bmN0aW9uIChlbGVtKSB7CiAgICBjb25zdCB0YWcgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkKCiAgICByZXR1cm4gdGFnID09PSAnb2wnIHx8IHRhZyA9PT0gJ3VsJyB8fCB0YWcgPT09ICdwJyB8fCB0YWcgPT09ICdkbCcgfHwKICAgICAgdGFnID09PSAnbGknIHx8IHRhZyA9PT0gJ3RhYmxlJyB8fCB0YWcgPT09ICdwcmUnIHx8CiAgICAgIHRhZyA9PT0gJ2gxJyB8fCB0YWcgPT09ICdoMicgfHwgdGFnID09PSAnaDMnIHx8CiAgICAgIHRhZyA9PT0gJ2g0JyB8fCB0YWcgPT09ICdoNScgfHwgdGFnID09PSAnaDYnIHx8CiAgICAgIHRhZyA9PT0gJ2Jsb2NrcXVvdGUnIHx8IHRhZyA9PT0gJ2FkZHJlc3MnCiAgfSwKCiAgYWRkX2xpc3RlbmVyOiBmdW5jdGlvbiAoZWxlbWVudCwgZXZlbnQsIGhhbmRsZXIpIHsKICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIsIGZhbHNlKQogICAgfSBlbHNlIHsKICAgICAgZWxlbWVudC5hdHRhY2hFdmVudCgnb24nICsgZXZlbnQsIGhhbmRsZXIpCiAgICB9CiAgfSwKCiAgLy8gdXNlZCB0byBwcmV2ZW50IGV2ZW50IHByb3BhZ2F0aW9uIGZyb20gZmllbGQgY29udHJvbHMKICBzdG9wX3Byb3BhZ2F0aW9uOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50CiAgICBldmVudC5jYW5jZWxCdWJibGUgPSB0cnVlIC8vIGZvciBJRQoKICAgIGlmIChldmVudC5zdG9wUHJvcGFnYXRpb24pIHsgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkgfQoKICAgIHJldHVybiB0cnVlCiAgfSwKCiAgY2FuY2VsOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIGlmIChldmVudCkgewogICAgICBldmVudC5jYW5jZWwgPSB0cnVlCiAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gZmFsc2UKCiAgICAgIGlmIChldmVudC5wcmV2ZW50RGVmYXVsdCkgeyBldmVudC5wcmV2ZW50RGVmYXVsdCgpIH0KICAgIH0KCiAgICB3M2NTbGlkeS5rZXlfd2FudGVkID0gZmFsc2UKICAgIHJldHVybiBmYWxzZQogIH0sCgogIC8vIGZvciBlYWNoIGxhbmd1YWdlIGRlZmluZSBhbiBhc3NvY2lhdGl2ZSBhcnJheQogIC8vIGFuZCBhbHNvIHRoZSBoZWxwIHRleHQgd2hpY2ggaXMgbG9uZ2VyCgogIHN0cmluZ3NfZXM6IHsKICAgIHNsaWRlOiAncMOhZy4nLAogICAgJ2hlbHA/JzogJ0F5dWRhJywKICAgICdjb250ZW50cz8nOiAnw41uZGljZScsCiAgICAndGFibGUgb2YgY29udGVudHMnOiAndGFibGEgZGUgY29udGVuaWRvcycsCiAgICAnVGFibGUgb2YgQ29udGVudHMnOiAnVGFibGEgZGUgQ29udGVuaWRvcycsCiAgICAncmVzdGFydCBwcmVzZW50YXRpb24nOiAnUmVpbmljaWFyIHByZXNlbnRhY2nDs24nLAogICAgJ3Jlc3RhcnQ/JzogJ0luaWNpbycKICB9LAogIGhlbHBfZXM6CiAgICAnVXRpbGljZSBlbCByYXTDs24sIGJhcnJhIGVzcGFjaWFkb3JhLCB0ZWNsYXMgSXpkYS9EY2hhLCAnICsKICAgICdvIFJlIHDDoWcgeSBBdiBww6FnLiBVc2UgUyB5IEIgcGFyYSBjYW1iaWFyIGVsIHRhbWHDsW8gZGUgZnVlbnRlLicsCgogIHN0cmluZ3NfY2E6IHsKICAgIHNsaWRlOiAncMOgZy4uJywKICAgICdoZWxwPyc6ICdBanVkYScsCiAgICAnY29udGVudHM/JzogJ8ONbmRleCcsCiAgICAndGFibGUgb2YgY29udGVudHMnOiAndGF1bGEgZGUgY29udGluZ3V0cycsCiAgICAnVGFibGUgb2YgQ29udGVudHMnOiAnVGF1bGEgZGUgQ29udGluZ3V0cycsCiAgICAncmVzdGFydCBwcmVzZW50YXRpb24nOiAnUmVpbmljaWFyIHByZXNlbnRhY2nDsycsCiAgICAncmVzdGFydD8nOiAnSW5pY2knCiAgfSwKICBoZWxwX2NhOgogICAgJ1V0aWxpdHppIGVsIHJhdG9sw60sIGJhcnJhIGVzcGFpYWRvcmEsIHRlY2xlcyBFc3EuL0R0YS4gJyArCiAgICAnbyBSZSBww6BnIHkgQXYgcMOgZy4gVXNpIFMgaSBCIHBlciBjYW52aWFyIGdyYW5kw6ByaWEgZGUgZm9udC4nLAoKICBzdHJpbmdzX2NzOiB7CiAgICBzbGlkZTogJ3Nuw61tZWsnLAogICAgJ2hlbHA/JzogJ27DoXBvdsSbZGEnLAogICAgJ2NvbnRlbnRzPyc6ICdvYnNhaCcsCiAgICAndGFibGUgb2YgY29udGVudHMnOiAnb2JzYWggcHJlemVudGFjZScsCiAgICAnVGFibGUgb2YgQ29udGVudHMnOiAnT2JzYWggcHJlemVudGFjZScsCiAgICAncmVzdGFydCBwcmVzZW50YXRpb24nOiAnem5vdnUgc3B1c3RpdCBwcmV6ZW50YWNpJywKICAgICdyZXN0YXJ0Pyc6ICdyZXN0YXJ0JwogIH0sCiAgaGVscF9jczoKICAgICdQcmV6ZW50YWNpIG3Fr8W+ZXRlIHByb2Now6F6ZXQgcG9tb2PDrSBrbGlrbnV0w60gbXnFoWksIG1lemVybsOta3UsICcgKwogICAgJ8WhaXBlayB2bGV2byBhIHZwcmF2byBuZWJvIGtsw6F2ZXMgUGFnZVVwIGEgUGFnZURvd24uIFDDrXNtbyBzZSAnICsKICAgICdkw6EgenbEm3TFoWl0IGEgem1lbsWhaXQgcG9tb2PDrSBrbMOhdmVzIEIgYSBTLicsCgogIHN0cmluZ3Nfbmw6IHsKICAgIHNsaWRlOiAncGFnaW5hJywKICAgICdoZWxwPyc6ICdIZWxwPycsCiAgICAnY29udGVudHM/JzogJ0luaG91ZD8nLAogICAgJ3RhYmxlIG9mIGNvbnRlbnRzJzogJ2luaG91ZHNvcGdhdmUnLAogICAgJ1RhYmxlIG9mIENvbnRlbnRzJzogJ0luaG91ZHNvcGdhdmUnLAogICAgJ3Jlc3RhcnQgcHJlc2VudGF0aW9uJzogJ2hlcnN0YXJ0IHByZXNlbnRhdGllJywKICAgICdyZXN0YXJ0Pyc6ICdIZXJzdGFydD8nCiAgfSwKICBoZWxwX25sOgogICAgJ05hdmlnZWVyIGQubS52LiBoZXQgbXVpcywgc3BhdGllYmFyLCBMaW5rcy9SZWNodHMgdG9ldHNlbiwgJyArCiAgICAnb2YgUGdVcCBlbiBQZ0RuLiBHZWJydWlrIFMgZW4gQiBvbSBkZSBrYXJha3Rlcmdyb290dGUgdGUgdmVyYW5kZXJlbi4nLAoKICBzdHJpbmdzX2RlOiB7CiAgICBzbGlkZTogJ1NlaXRlJywKICAgICdoZWxwPyc6ICdIaWxmZScsCiAgICAnY29udGVudHM/JzogJ8OcYmVyc2ljaHQnLAogICAgJ3RhYmxlIG9mIGNvbnRlbnRzJzogJ0luaGFsdHN2ZXJ6ZWljaG5pcycsCiAgICAnVGFibGUgb2YgQ29udGVudHMnOiAnSW5oYWx0c3ZlcnplaWNobmlzJywKICAgICdyZXN0YXJ0IHByZXNlbnRhdGlvbic6ICdQcsOkc2VudGF0aW9uIG5ldSBzdGFydGVuJywKICAgICdyZXN0YXJ0Pyc6ICdOZXVzdGFydCcKICB9LAogIGhlbHBfZGU6CiAgICAnQmVudXR6ZW4gU2llIGRpZSBNYXVzLCBMZWVyc2NobGFnLCBkaWUgQ3Vyc29ydGFzdGVuIGxpbmtzL3JlY2h0cyBvZGVyICcgKwogICAgJ1BhZ2UgdXAvUGFnZSBEb3duIHp1bSBXZWNoc2VsbiBkZXIgU2VpdGVuIHVuZCBTIHVuZCBCIGbDvHIgZGllIFNjaHJpZnRncsO2c3NlLicsCgogIHN0cmluZ3NfcGw6IHsKICAgIHNsaWRlOiAnc2xhamQnLAogICAgJ2hlbHA/JzogJ3BvbW9jPycsCiAgICAnY29udGVudHM/JzogJ3NwaXMgdHJlxZtjaT8nLAogICAgJ3RhYmxlIG9mIGNvbnRlbnRzJzogJ3NwaXMgdHJlxZtjaScsCiAgICAnVGFibGUgb2YgQ29udGVudHMnOiAnU3BpcyBUcmXFm2NpJywKICAgICdyZXN0YXJ0IHByZXNlbnRhdGlvbic6ICdSZXN0YXJ0dWogcHJlemVudGFjasSZJywKICAgICdyZXN0YXJ0Pyc6ICdyZXN0YXJ0PycKICB9LAogIGhlbHBfcGw6CiAgICAnWm1pZW5pYWogc2xhamR5IGtsaWthasSFYyBteXN6xIUsIG5hY2lza2FqxIVjIHNwYWNqxJksIHN0cnphxYJraSBsZXdvL3ByYXdvJyArCiAgICAnbHViIFBnVXAgLyBQZ0RuLiBVxbx5aiBrbGF3aXN6eSBTIGkgQiwgYWJ5IHptaWVuacSHIHJvem1pYXIgY3pjemlvbmtpLicsCgogIHN0cmluZ3NfZnI6IHsKICAgIHNsaWRlOiAncGFnZScsCiAgICAnaGVscD8nOiAnQWlkZScsCiAgICAnY29udGVudHM/JzogJ0luZGV4JywKICAgICd0YWJsZSBvZiBjb250ZW50cyc6ICd0YWJsZSBkZXMgbWF0acOocmVzJywKICAgICdUYWJsZSBvZiBDb250ZW50cyc6ICdUYWJsZSBkZXMgbWF0acOocmVzJywKICAgICdyZXN0YXJ0IHByZXNlbnRhdGlvbic6ICJSZWNvbW1lbmNlciBsJ2V4cG9zw6kiLAogICAgJ3Jlc3RhcnQ/JzogJ0TDqWJ1dCcKICB9LAogIGhlbHBfZnI6CiAgICAiTmF2aWd1ZXogYXZlYyBsYSBzb3VyaXMsIGxhIGJhcnJlIGQnZXNwYWNlLCBsZXMgZmzDqGNoZXMgIiArCiAgICAnZ2F1Y2hlL2Ryb2l0ZSBvdSBsZXMgdG91Y2hlcyBQZyBVcCwgUGcgRG4uIFV0aWxpc2V6ICcgKwogICAgJ2xlcyB0b3VjaGVzIFMgZXQgQiBwb3VyIG1vZGlmaWVyIGxhIHRhaWxsZSBkZSBsYSBwb2xpY2UuJywKCiAgc3RyaW5nc19odTogewogICAgc2xpZGU6ICdvbGRhbCcsCiAgICAnaGVscD8nOiAnc2Vnw610c8OpZycsCiAgICAnY29udGVudHM/JzogJ3RhcnRhbG9tJywKICAgICd0YWJsZSBvZiBjb250ZW50cyc6ICd0YXJ0YWxvbWplZ3l6w6lrJywKICAgICdUYWJsZSBvZiBDb250ZW50cyc6ICdUYXJ0YWxvbWplZ3l6w6lrJywKICAgICdyZXN0YXJ0IHByZXNlbnRhdGlvbic6ICdiZW11dGF0w7Mgw7pqcmFpbmTDrXTDoXNhJywKICAgICdyZXN0YXJ0Pyc6ICfDumpyYWluZMOtdMOhcycKICB9LAogIGhlbHBfaHU6CiAgICAnQXogb2xkYWxhayBrw7Z6dGkgbMOpcGtlZMOpc2hleiBrYXR0aW50c29uIGF6IGVnw6lycmVsLCB2YWd5ICcgKwogICAgJ2hhc3puw6FsamEgYSBzesOza8O2eiwgYSBiYWwsIHZhZ3kgYSBqb2JiIG55w61sLCBpbGxldHZlIGEgUGFnZSBEb3duLCAnICsKICAgICdQYWdlIFVwIGJpbGxlbnR5xbFrZXQuIEF6IFMgw6lzIGEgQiBiaWxsZW50ecWxa2tlbCB2w6FsdG96dGF0aGF0amEgJyArCiAgICAnYSBzesO2dmVnIG3DqXJldMOpdC4nLAoKICBzdHJpbmdzX2l0OiB7CiAgICBzbGlkZTogJ3BhZy4nLAogICAgJ2hlbHA/JzogJ0FpdXRvJywKICAgICdjb250ZW50cz8nOiAnSW5kaWNlJywKICAgICd0YWJsZSBvZiBjb250ZW50cyc6ICdpbmRpY2UnLAogICAgJ1RhYmxlIG9mIENvbnRlbnRzJzogJ0luZGljZScsCiAgICAncmVzdGFydCBwcmVzZW50YXRpb24nOiAnUmljb21pbmNpYXJlIGxhIHByZXNlbnRhemlvbmUnLAogICAgJ3Jlc3RhcnQ/JzogJ0luaXppbycKICB9LAogIGhlbHBfaXQ6CiAgICAnTmF2aWdhcmUgY29uIG1vdXNlLCBiYXJyYSBzcGF6aW8sIGZyZWNjZSBzaW5pc3RyYS9kZXN0cmEgbyAnICsKICAgICdQZ1VwIGUgUGdEbi4gVXNhcmUgUyBlIEIgcGVyIGNhbWJpYXJlIGxhIGRpbWVuc2lvbmUgZGVpIGNhcmF0dGVyaS4nLAoKICBzdHJpbmdzX2VsOiB7CiAgICBzbGlkZTogJ8+DzrXOu86vzrTOsScsCiAgICAnaGVscD8nOiAnzrLOv86uzrjOtc65zrE7JywKICAgICdjb250ZW50cz8nOiAnz4DOtc+BzrnOtc+Hz4zOvM61zr3OsTsnLAogICAgJ3RhYmxlIG9mIGNvbnRlbnRzJzogJ8+Azq/Ovc6xzrrOsc+CIM+AzrXPgc65zrXPh86/zrzOrc69z4nOvScsCiAgICAnVGFibGUgb2YgQ29udGVudHMnOiAnzqDOr869zrHOus6xz4IgzqDOtc+BzrnOtc+Hzr/OvM6tzr3Pic69JywKICAgICdyZXN0YXJ0IHByZXNlbnRhdGlvbic6ICfOtc+AzrHOvc61zrrOus6vzr3Ot8+Dzrcgz4DOsc+Bzr/Phc+Dzq/Osc+DzrfPgicsCiAgICAncmVzdGFydD8nOiAnzrXPgM6xzr3Otc66zrrOr869zrfPg863OycKICB9LAogIGhlbHBfZWw6CiAgICAnzqDOu86/zrfOs863zrjOtc6vz4TOtSDOvM61IM+Ezr8gzrrOu86vzrogz4TOv8+FIM+Azr/Ovc+EzrnOus65zr/PjSwgz4TOvyBzcGFjZSwgz4TOsSDOss6tzrvOtyDOsc+BzrnPg8+EzrXPgc6sL860zrXOvs65zqwsICcgKwogICAgJ86uIFBhZ2UgVXAgzrrOsc65IFBhZ2UgRG93bi4gzqfPgc63z4POuc68zr/PgM6/zrnOrs+Dz4TOtSDPhM6xIM+AzrvOrs66z4TPgc6xIFMgzrrOsc65IEIgzrPOuc6xIM69zrEgzrHOu867zqzOvs61z4TOtSAnICsKICAgICfPhM6/IM68zq3Os861zrjOv8+CIM+EzrfPgiDOs8+BzrHOvM68zrHPhM6/z4POtc65z4HOrM+CLicsCgogIHN0cmluZ3NfamE6IHsKICAgIHNsaWRlOiAn44K544Op44Kk44OJJywKICAgICdoZWxwPyc6ICfjg5jjg6vjg5cnLAogICAgJ2NvbnRlbnRzPyc6ICfnm67mrKEnLAogICAgJ3RhYmxlIG9mIGNvbnRlbnRzJzogJ+ebruasoeOCkuihqOekuicsCiAgICAnVGFibGUgb2YgQ29udGVudHMnOiAn55uu5qyhJywKICAgICdyZXN0YXJ0IHByZXNlbnRhdGlvbic6ICfmnIDliJ3jgYvjgonlho3nlJ8nLAogICAgJ3Jlc3RhcnQ/JzogJ+acgOWIneOBi+OCiScKICB9LAogIGhlbHBfamE6CiAgICAn44Oe44Km44K55bem44Kv44Oq44OD44KvIOODuyDjgrnjg5rjg7zjgrkg44O7IOW3puWPs+OCreODvCAnICsKICAgICfjgb7jgZ/jga8gUGFnZSBVcCDjg7sgUGFnZSBEb3du44Gn5pON5L2c77yMIFMg44O7IELjgafjg5Xjgqnjg7Pjg4jjgrXjgqTjgrrlpInmm7QnLAoKICBzdHJpbmdzX3poOiB7CiAgICBzbGlkZTogJ+W5u+eBr+eJhycsCiAgICAnaGVscD8nOiAn5biu5YqpPycsCiAgICAnY29udGVudHM/JzogJ+WGheWuuT8nLAogICAgJ3RhYmxlIG9mIGNvbnRlbnRzJzogJ+ebruW9lScsCiAgICAnVGFibGUgb2YgQ29udGVudHMnOiAn55uu5b2VJywKICAgICdyZXN0YXJ0IHByZXNlbnRhdGlvbic6ICfph43mlrDlkK/liqjlsZXnpLonLAogICAgJ3Jlc3RhcnQ/JzogJ+mHjeaWsOWQr+WKqD8nCiAgfSwKICBoZWxwX3poOgogICAgJ+eUqOm8oOagh+eCueWHuywg56m65qC85p2hLCDlt6blj7Pnrq3lpLQsIFBnIFVwIOWSjCBQZyBEbiDlr7zoiKouICcgKwogICAgJ+eUqCBTLCBCIOaUueWPmOWtl+S9k+Wkp+Wwjy4nLAoKICBzdHJpbmdzX3J1OiB7CiAgICBzbGlkZTogJ9GB0LvQsNC50LQnLAogICAgJ2hlbHA/JzogJ9C/0L7QvNC+0YnRjD8nLAogICAgJ2NvbnRlbnRzPyc6ICfRgdC+0LTQtdGA0LbQsNC90LjQtT8nLAogICAgJ3RhYmxlIG9mIGNvbnRlbnRzJzogJ9C+0LPQu9Cw0LLQu9C10L3QuNC1JywKICAgICdUYWJsZSBvZiBDb250ZW50cyc6ICfQntCz0LvQsNCy0LvQtdC90LjQtScsCiAgICAncmVzdGFydCBwcmVzZW50YXRpb24nOiAn0L/QtdGA0LXQt9Cw0L/Rg9GB0YLQuNGC0Ywg0L/RgNC10LfQtdC90YLQsNGG0LjRjicsCiAgICAncmVzdGFydD8nOiAn0L/QtdGA0LXQt9Cw0L/Rg9GB0Lo/JwogIH0sCiAgaGVscF9ydToKICAgICfQn9C10YDQtdC80LXRidCw0LnRgtC10YHRjCDQutC70LjQutCw0Y8g0LzRi9GI0LrQvtC5LCDQuNGB0L/QvtC70YzQt9GD0Y8g0LrQu9Cw0LLQuNGI0YMg0L/RgNC+0LHQtdC7LCDRgdGC0YDQtdC70LrQuCcgKwogICAgJ9Cy0LvQtdCy0L4v0LLQv9GA0LDQstC+INC40LvQuCBQZyBVcCDQuCBQZyBEbi4g0JrQu9Cw0LLQuNGI0LggUyDQuCBCINC80LXQvdGP0Y7RgiDRgNCw0LfQvNC10YAg0YjRgNC40YTRgtCwLicsCgogIHN0cmluZ3Nfc3Y6IHsKICAgIHNsaWRlOiAnc2lkYScsCiAgICAnaGVscD8nOiAnaGrDpGxwJywKICAgICdjb250ZW50cz8nOiAnaW5uZWjDpWxsJywKICAgICd0YWJsZSBvZiBjb250ZW50cyc6ICdpbm5laMOlbGxzZsO2cnRlY2tuaW5nJywKICAgICdUYWJsZSBvZiBDb250ZW50cyc6ICdJbm5laMOlbGxzZsO2cnRlY2tuaW5nJywKICAgICdyZXN0YXJ0IHByZXNlbnRhdGlvbic6ICd2aXNhIHByZXNlbnRhdGlvbmVuIGZyw6VuIGLDtnJqYW4nLAogICAgJ3Jlc3RhcnQ/JzogJ2LDtnJqYSBvbScKICB9LAogIGhlbHBfc3Y6CiAgICAnQmzDpGRkcmEgbWVkIGV0dCBrbGljayBtZWQgdsOkbnN0cmEgbXVza25hcHBlbiwgbWVsbGFuc2xhZ3N0YW5nZW50ZW4sICcgKwogICAgJ3bDpG5zdGVyLSBvY2ggaMO2Z2VycGlsdGFuZ2VudGVybmEgZWxsZXIgdGFuZ2VudGVybmEgUGcgVXAsIFBnIERuLiAnICsKICAgICdBbnbDpG5kIHRhbmdlbnRlcm5hIFMgb2NoIEIgZsO2ciBhdHQgw6RuZHJhIHRleHRlbnMgc3Rvcmxlay4nLAoKICBzdHJpbmdzOiB7fSwKCiAgbG9jYWxpemU6IGZ1bmN0aW9uIChzcmMpIHsKICAgIGlmIChzcmMgPT09ICcnKSB7IHJldHVybiBzcmMgfQoKICAgIC8vIHRyeSBmdWxsIGxhbmd1YWdlIGNvZGUsIGUuZy4gZW4tVVMKICAgIGxldCBzID0gdzNjU2xpZHkuc3RyaW5nc1t3M2NTbGlkeS5sYW5nXQogICAgbGV0IGxvb2t1cCA9IHczY1NsaWR5LnN0cmluZ3NbdzNjU2xpZHkubGFuZ10KCiAgICBpZiAobG9va3VwKSB7CiAgICAgIHMgPSBsb29rdXBbc3JjXQoKICAgICAgaWYgKHMpIHsgcmV0dXJuIHMgfQogICAgfQoKICAgIC8vIHN0cmlwIGNvdW50cnkgY29kZSBzdWZmaXgsIGUuZy4KICAgIC8vIHRyeSBlbiBpZiB1bmRlZmluZWQgZm9yIGVuLVVTCiAgICBjb25zdCBsZyA9IHczY1NsaWR5Lmxhbmcuc3BsaXQoJy0nKQoKICAgIGlmIChsZy5sZW5ndGggPiAxKSB7CiAgICAgIGxvb2t1cCA9IHczY1NsaWR5LnN0cmluZ3NbbGdbMF1dCgogICAgICBpZiAobG9va3VwKSB7CiAgICAgICAgcyA9IGxvb2t1cFtzcmNdCgogICAgICAgIGlmIChzKSB7IHJldHVybiBzIH0KICAgICAgfQogICAgfQoKICAgIC8vIG90aGVyd2lzZSBzdHJpbmcgYXMgaXMKICAgIHJldHVybiBzcmMKICB9LAoKICBpbml0X2xvY2FsaXphdGlvbjogZnVuY3Rpb24gKCkgewogICAgY29uc3QgaTE4biA9IHczY1NsaWR5CiAgICBjb25zdCBoZWxwVGV4dCA9IHczY1NsaWR5LmhlbHBfdGV4dAoKICAgIC8vIGVhY2ggc3VjaCBsYW5ndWFnZSBhcnJheSBpcyBkZWNsYXJlZCBpbiB0aGUgbG9jYWxpemUgYXJyYXkKICAgIC8vIHRoaXMgaXMgdXNlZCBhcyBpbiAgdzNjX3NsaWR5LmxvY2FsaXplKCJmb28iKTsKICAgIHRoaXMuc3RyaW5ncyA9IHsKICAgICAgZXM6IHRoaXMuc3RyaW5nc19lcywKICAgICAgY2E6IHRoaXMuc3RyaW5nc19jYSwKICAgICAgY3M6IHRoaXMuc3RyaW5nc19jcywKICAgICAgbmw6IHRoaXMuc3RyaW5nc19ubCwKICAgICAgZGU6IHRoaXMuc3RyaW5nc19kZSwKICAgICAgcGw6IHRoaXMuc3RyaW5nc19wbCwKICAgICAgZnI6IHRoaXMuc3RyaW5nc19mciwKICAgICAgaHU6IHRoaXMuc3RyaW5nc19odSwKICAgICAgaXQ6IHRoaXMuc3RyaW5nc19pdCwKICAgICAgZWw6IHRoaXMuc3RyaW5nc19lbCwKICAgICAganA6IHRoaXMuc3RyaW5nc19qYSwKICAgICAgemg6IHRoaXMuc3RyaW5nc196aCwKICAgICAgcnU6IHRoaXMuc3RyaW5nc19ydSwKICAgICAgc3Y6IHRoaXMuc3RyaW5nc19zdgogICAgfQoKICAgIGkxOG4uc3RyaW5nc19lc1toZWxwVGV4dF0gPSBpMThuLmhlbHBfZXMKICAgIGkxOG4uc3RyaW5nc19jYVtoZWxwVGV4dF0gPSBpMThuLmhlbHBfY2EKICAgIGkxOG4uc3RyaW5nc19jc1toZWxwVGV4dF0gPSBpMThuLmhlbHBfY3MKICAgIGkxOG4uc3RyaW5nc19ubFtoZWxwVGV4dF0gPSBpMThuLmhlbHBfbmwKICAgIGkxOG4uc3RyaW5nc19kZVtoZWxwVGV4dF0gPSBpMThuLmhlbHBfZGUKICAgIGkxOG4uc3RyaW5nc19wbFtoZWxwVGV4dF0gPSBpMThuLmhlbHBfcGwKICAgIGkxOG4uc3RyaW5nc19mcltoZWxwVGV4dF0gPSBpMThuLmhlbHBfZnIKICAgIGkxOG4uc3RyaW5nc19odVtoZWxwVGV4dF0gPSBpMThuLmhlbHBfaHUKICAgIGkxOG4uc3RyaW5nc19pdFtoZWxwVGV4dF0gPSBpMThuLmhlbHBfaXQKICAgIGkxOG4uc3RyaW5nc19lbFtoZWxwVGV4dF0gPSBpMThuLmhlbHBfZWwKICAgIGkxOG4uc3RyaW5nc19qYVtoZWxwVGV4dF0gPSBpMThuLmhlbHBfamEKICAgIGkxOG4uc3RyaW5nc196aFtoZWxwVGV4dF0gPSBpMThuLmhlbHBfemgKICAgIGkxOG4uc3RyaW5nc19ydVtoZWxwVGV4dF0gPSBpMThuLmhlbHBfcnUKICAgIGkxOG4uc3RyaW5nc19zdltoZWxwVGV4dF0gPSBpMThuLmhlbHBfc3YKCiAgICB3M2NTbGlkeS5sYW5nID0gZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnbGFuZycpCgogICAgaWYgKCF3M2NTbGlkeS5sYW5nKSB7CiAgICAgIHczY1NsaWR5LmxhbmcgPSBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCd4bWw6bGFuZycpCiAgICB9CgogICAgaWYgKCF3M2NTbGlkeS5sYW5nKSB7CiAgICAgIHczY1NsaWR5LmxhbmcgPSAnZW4nCiAgICB9CiAgfQp9CgovLyBoYWNrIGZvciBiYWNrIGJ1dHRvbiBiZWhhdmlvcgppZiAodzNjU2xpZHkuaWU2IHx8IHczY1NsaWR5LmllNykgewogIGRvY3VtZW50LndyaXRlKCI8aWZyYW1lIGlkPSdoaXN0b3J5RnJhbWUnICIgKwogICAgInNyYz0namF2YXNjcmlwdDpcIjxodG1sIiArICc+PC8nICsgImh0bWw+XCInICIgKwogICAgImhlaWdodD0nMScgd2lkdGg9JzEnICIgKwogICAgInN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi04MDBweCc+PC9pZnJhbWU+IikKfQoKLy8gYXR0YWNoIGV2ZW50IGxpc3RlbmVycyBmb3IgaW5pdGlhbGl6YXRpb24KdzNjU2xpZHkuc2V0X3VwKCkKCi8vIGhpZGUgdGhlIHNsaWRlcyBhcyBzb29uIGFzIGJvZHkgZWxlbWVudCBpcyBhdmFpbGFibGUKLy8gdG8gcmVkdWNlIGFubm95aW5nIHNjcmVlbiBtZXNzIGJlZm9yZSB0aGUgb25sb2FkIGV2ZW50CnNldFRpbWVvdXQodzNjU2xpZHkuaGlkZV9zbGlkZXMsIDUwKQo=" charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Baysian Calculations â€” The Table Method as adapted from Think Bayes by Allen B. Downey</h1>
  <p class="author">
Josh Magee
  </p>
  <p class="date">2021-09-10</p>
</div>
<div id="bayes-theorem" class="slide section level2">
<h1>Bayes Theorem</h1>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(H|D) = \frac{P(H) \cdot P(D|H)}{P(D)}</annotation></semantics></math></p>
<ul>
<li><code>H</code> = hypothesis</li>
<li><code>D</code> = data</li>
<li><code>P(H)</code> = probability of the hypothesis being true (<em>i.e</em>, the <strong>prior</strong>)</li>
<li><code>P(H|D)</code> = probability of the hypothesis given the data (<em>i.e.</em>, the <strong>posterior</strong>)</li>
<li><code>P(D|H)</code> = probability of the data given the hypothesis (<em>i.e.</em>, the <strong>likelihood</strong>)</li>
<li><code>P(D)</code> = probability of the data (<em>i.e.</em>, the normalizing constant; the <strong>evidence</strong>)</li>
</ul>
<p>Note the evidence is calculated by:</p>
<div class="center">
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H|D) = \sum_{i} P(H_{i}) \cdot P(D|H_{i})</annotation></semantics></math></p>
</div>
</div>
<div id="bayes-theorem-1" class="slide section level2">
<h1>Bayes Theorem</h1>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mspace width="2.0em"></mspace><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H|D) = \frac{P(H) \cdot P(D|H)}{P(D)} \qquad P(H|D) = \sum_{i} P(H_{i}) \cdot P(D|H_{i})</annotation></semantics></math></p>
<p>My experience is that, in practice, it is difficult to keep track of all the terms in the evidence. You have to essentially calculate every combination of priors and likelihoods and keep track of that. This is where the table method shines!</p>
</div>
<div id="the-table-method" class="slide section level2">
<h1>The Table Method</h1>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mspace width="2.0em"></mspace><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H|D) = \frac{P(H) \cdot P(D|H)}{P(D)} \qquad P(H|D) = \sum_{i} P(H_{i}) \cdot P(D|H_{i})</annotation></semantics></math></p>
<p>Basically, we are going to break up Bayesâ€™ Theorem into individual parts. Columns are the <strong>prior</strong> and <strong>likelihoods</strong>, with rows as each <strong>hypotheses</strong>.</p>
<div class="column1highlight">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Start at the P(H<sub>i</sub>) column; just the probability of any given hypothesis.</p>
</div>
<div id="the-table-method-1" class="slide section level2">
<h1>The Table Method</h1>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mspace width="2.0em"></mspace><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H|D) = \frac{P(H) \cdot P(D|H)}{P(D)} \qquad P(H|D) = \sum_{i} P(H_{i}) \cdot P(D|H_{i})</annotation></semantics></math></p>
<div class="column2highlight">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Then, in the P(D|H<sub>i</sub>) column, plug in the likelihood of each hypotheses.</p>
</div>
<div id="the-table-method-2" class="slide section level2">
<h1>The Table Method</h1>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mspace width="2.0em"></mspace><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H|D) = \frac{P(H) \cdot P(D|H)}{P(D)} \qquad P(H|D) = \sum_{i} P(H_{i}) \cdot P(D|H_{i})</annotation></semantics></math></p>
<div class="column3highlight">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Calculate P(H<sub>i</sub>) <strong>â¸³</strong> P(D|H<sub>i</sub>) values by multiplying the first two columns.</p>
</div>
<div id="the-table-method-3" class="slide section level2">
<h1>The Table Method</h1>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mspace width="2.0em"></mspace><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H|D) = \frac{P(H) \cdot P(D|H)}{P(D)} \qquad P(H|D) = \sum_{i} P(H_{i}) \cdot P(D|H_{i})</annotation></semantics></math></p>
<div class="column3highlight evidence">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>âˆ‘</mo><mi>i</mi></msub><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sum_{i} P(H_{i}) \cdot P(D|H_{i})</annotation></semantics></math></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>The sum of the P(H<sub>i</sub>) <strong>â¸³</strong> P(D|H<sub>i</sub>) column values is the <strong>evidence</strong>, aka the denominator for calculating P(H<sub>i</sub>|D) in the final column.</p>
</div>
<div id="the-table-method-4" class="slide section level2">
<h1>The Table Method</h1>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><mi>H</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mspace width="2.0em"></mspace><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H|D) = \frac{P(H) \cdot P(D|H)}{P(D)} \qquad P(H|D) = \sum_{i} P(H_{i}) \cdot P(D|H_{i})</annotation></semantics></math></p>
<div class="column4highlight">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>âˆ‘</mo><mi>i</mi></msub><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sum_{i} P(H_{i}) \cdot P(D|H_{i})</annotation></semantics></math></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Finally, the <strong>posterior</strong> values for each hypotheses are simply the P(H<sub>i</sub>) <strong>â¸³</strong> P(D|H<sub>i</sub>) column divided by the evidence calculated by the previous step.</p>
</div>
<div id="example-the-cookie-problem" class="slide section level2">
<h1>Example: The Cookie Problem</h1>
<p>Suppose there are 2 bowls of cookies. Bowl <em>A</em> contains 30 vanilla cookies and 10 chocolate cookies. Bowl <em>B</em> contains 20 of each.</p>
<p>Now, suppose you choose one of the bowls at random. Without looking, you selected a cookie at random. The cookie is vanilla. <strong>What is the probability that it came from Bowl <em>A</em>?</strong></p>
</div>
<div id="example-the-cookie-problem-1" class="slide section level2">
<h1>Example: The Cookie Problem</h1>
<p>Suppose there are 2 bowls of cookies. Bowl <em>A</em> contains 30 vanilla cookies and 10 chocolate cookies. Bowl <em>B</em> contains 20 of each.</p>
<p>Now, suppose you choose one of the bowls at random. Without looking, you selected a cookie at random. The cookie is vanilla. <strong>What is the probability that it came from Bowl <em>A</em>?</strong></p>
<div class="column1highlight">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>There are 2 hypotheses: <strong>hypothesis 1</strong> is <em>bowl A</em>; <strong>hypothesis 2</strong> is <em>bowl B</em>. Therefore, the probability that the drawn cookie came from either bowl is 50%.</p>
</div>
<div id="example-the-cookie-problem-2" class="slide section level2">
<h1>Example: The Cookie Problem</h1>
<p>Suppose there are 2 bowls of cookies. Bowl <em>A</em> contains 30 vanilla cookies and 10 chocolate cookies. Bowl <em>B</em> contains 20 of each.</p>
<p>Now, suppose you choose one of the bowls at random. Without looking, you selected a cookie at random. The cookie is vanilla. <strong>What is the probability that it came from Bowl <em>A</em>?</strong></p>
<div class="column2highlight">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>30</mn><mn>40</mn></mfrac><mo>=</mo><mfrac><mn>3</mn><mn>4</mn></mfrac><mo>=</mo><mn>0.75</mn></mrow><annotation encoding="application/x-tex">\frac{30}{40} = \frac{3}{4} = 0.75</annotation></semantics></math></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>20</mn><mn>40</mn></mfrac><mo>=</mo><mfrac><mn>2</mn><mn>4</mn></mfrac><mo>=</mo><mn>0.50</mn></mrow><annotation encoding="application/x-tex">\frac{20}{40} = \frac{2}{4} = 0.50</annotation></semantics></math></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>The likelihood of getting a vanilla cookie, assuming <em>hypothesis 1</em>, is <strong>30 vanilla cookies out of 40 cookies</strong>.</li>
<li>The likelihood of getting a vanilla cookie, assuming <em>hypothesis 2</em>, is <strong>20 vanilla cookies out of 40 cookies</strong>.</li>
</ul>
</div>
<div id="example-the-cookie-problem-3" class="slide section level2">
<h1>Example: The Cookie Problem</h1>
<p>Suppose there are 2 bowls of cookies. Bowl <em>A</em> contains 30 vanilla cookies and 10 chocolate cookies. Bowl <em>B</em> contains 20 of each.</p>
<p>Now, suppose you choose one of the bowls at random. Without looking, you selected a cookie at random. The cookie is vanilla. <strong>What is the probability that it came from Bowl <em>A</em>?</strong></p>
<div class="column3highlight">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>30</mn><mn>40</mn></mfrac><mo>=</mo><mfrac><mn>3</mn><mn>4</mn></mfrac><mo>=</mo><mn>0.75</mn></mrow><annotation encoding="application/x-tex">\frac{30}{40} = \frac{3}{4} = 0.75</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.75</mn><mo>=</mo><mn>0.375</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.75 = 0.375</annotation></semantics></math></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>20</mn><mn>40</mn></mfrac><mo>=</mo><mfrac><mn>2</mn><mn>4</mn></mfrac><mo>=</mo><mn>0.50</mn></mrow><annotation encoding="application/x-tex">\frac{20}{40} = \frac{2}{4} = 0.50</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.50</mn><mo>=</mo><mn>0.25</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.50 = 0.25</annotation></semantics></math></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Multiplying the columnsâ€¦</p>
</div>
<div id="example-the-cookie-problem-4" class="slide section level2">
<h1>Example: The Cookie Problem</h1>
<p>Suppose there are 2 bowls of cookies. Bowl <em>A</em> contains 30 vanilla cookies and 10 chocolate cookies. Bowl <em>B</em> contains 20 of each.</p>
<p>Now, suppose you choose one of the bowls at random. Without looking, you selected a cookie at random. The cookie is vanilla. <strong>What is the probability that it came from Bowl <em>A</em>?</strong></p>
<div class="column3highlight evidence">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>30</mn><mn>40</mn></mfrac><mo>=</mo><mfrac><mn>3</mn><mn>4</mn></mfrac><mo>=</mo><mn>0.75</mn></mrow><annotation encoding="application/x-tex">\frac{30}{40} = \frac{3}{4} = 0.75</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.75</mn><mo>=</mo><mn>0.375</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.75 = 0.375</annotation></semantics></math></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>20</mn><mn>40</mn></mfrac><mo>=</mo><mfrac><mn>2</mn><mn>4</mn></mfrac><mo>=</mo><mn>0.50</mn></mrow><annotation encoding="application/x-tex">\frac{20}{40} = \frac{2}{4} = 0.50</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.50</mn><mo>=</mo><mn>0.25</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.50 = 0.25</annotation></semantics></math></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.375</mn><mo>+</mo><mn>0.25</mn><mo>=</mo><mn>0.675</mn></mrow><annotation encoding="application/x-tex">0.375 + 0.25 = 0.675</annotation></semantics></math></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Summing the P(H<sub>i</sub>) <strong>â¸³</strong> P(D|H<sub>i</sub>) down the rows to calculate the <strong>evidence</strong>â€¦</p>
</div>
<div id="example-the-cookie-problem-5" class="slide section level2">
<h1>Example: The Cookie Problem</h1>
<div class="column4highlight">
<table>
<colgroup>
<col width="5%" />
<col width="14%" />
<col width="18%" />
<col width="42%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>30</mn><mn>40</mn></mfrac><mo>=</mo><mfrac><mn>3</mn><mn>4</mn></mfrac><mo>=</mo><mn>0.75</mn></mrow><annotation encoding="application/x-tex">\frac{30}{40} = \frac{3}{4} = 0.75</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.75</mn><mo>=</mo><mn>0.375</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.75 = 0.375</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>0.375</mn><mn>0.625</mn></mfrac><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\frac{0.375}{0.625} = 0.6</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>2</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>20</mn><mn>40</mn></mfrac><mo>=</mo><mfrac><mn>2</mn><mn>4</mn></mfrac><mo>=</mo><mn>0.50</mn></mrow><annotation encoding="application/x-tex">\frac{20}{40} = \frac{2}{4} = 0.50</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.50</mn><mo>=</mo><mn>0.25</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.50 = 0.25</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>0.25</mn><mn>0.625</mn></mfrac><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">\frac{0.25}{0.625} = 0.4</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.375</mn><mo>+</mo><mn>0.25</mn><mo>=</mo><mn>0.625</mn></mrow><annotation encoding="application/x-tex">0.375 + 0.25 = 0.625</annotation></semantics></math></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>The <strong>posterior</strong> probability values can be calculated by just dividing through.</p>
<ul>
<li>Based on the prior and likelihood, thereâ€™s a <strong>60%</strong> chance the vanilla cookie you drew without looking came from <em>bowl A</em>, and a <strong>40%</strong> chance that it came from <em>bowl B</em>.</li>
</ul>
</div>
<div id="example-the-mms-problem" class="slide section level2">
<h1>Example: The M&amp;Mâ€™s Problem</h1>
<p>Mars, Inc., the company that makes M&amp;Mâ€™s, changes the mixture of the candiesâ€™ color from time to time.</p>
<p>In 1995, they introduced blue M&amp;Mâ€™s. The color mix in a big of plain M&amp;Mâ€™s was thus changed:</p>
<div class="center">
<ul>
<li>Brown: 30% âžœ 13%</li>
<li>Yellow: 20% âžœ 14%</li>
<li>Red: 20% âžœ 13%</li>
<li>Green: 10% âžœ 20%</li>
<li>Orange: 10% âžœ 16%</li>
<li>Tan: 10% âžœ 0%</li>
<li>Blue: 0 âžœ 24%</li>
</ul>
</div>
<p>Suppose a friend of mine has 2 bags of M&amp;Mâ€™s; one from <strong>1994 (<em>bag A</em>)</strong> and one from <strong>1996 (<em>bag A</em>)</strong>.</p>
<p>He gives me one M&amp;Mâ€™s from each bag without telling me which bag they came from. One was yellow, and the other green.</p>
<p>What is the probability that the yellow M&amp;Mâ€™s came from the 1994 bag?</p>
</div>
<div id="example-the-mms-problem-1" class="slide section level2">
<h1>Example: The M&amp;Mâ€™s Problem</h1>
<ul>
<li><em>Bag A</em> âžœ <em>Bag B</em></li>
<li>Yellow: 20% âžœ 14%</li>
<li>Green: 10% âžœ 20%</li>
</ul>
<div class="column1highlight">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>We begin with 2 hypotheses: In <strong>hypothesis 1</strong>, the yellow M&amp;Mâ€™s drawn came from <em>bag A</em>, while in <strong>hypothesis 2</strong>, it came from <em>bag B</em>. The prior is that both hypotheses are equally likely.</p>
</div>
<div id="example-the-mms-problem-2" class="slide section level2">
<h1>Example: The M&amp;Mâ€™s Problem</h1>
<div class="column2highlight">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.20</mn><mo>Ã—</mo><mn>0.20</mn><mo>=</mo><mn>0.04</mn></mrow><annotation encoding="application/x-tex">0.20 \times 0.20 = 0.04</annotation></semantics></math></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.14</mn><mo>Ã—</mo><mn>0.10</mn><mo>=</mo><mn>0.014</mn></mrow><annotation encoding="application/x-tex">0.14 \times 0.10 = 0.014</annotation></semantics></math></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>In <strong>hypothesis 1</strong>, the probability of drawing a yellow M&amp;Mâ€™s from <em>bag A</em> is 20%, while the probability of drawing a green M&amp;Mâ€™s from <em>bag B</em> is 20%.</li>
<li>Recall the <strong>multiplication rule</strong>: If two events are independent of each other, the probability of them both happening is the product of the two individual probabilities.</li>
<li>We can determine the same probabilities for <strong>hypothesis 2</strong>: 14% for yellow and 10% for green.</li>
</ul>
</div>
<div id="example-the-mms-problem-3" class="slide section level2">
<h1>Example: The M&amp;Mâ€™s Problem</h1>
<div class="column3highlight evidence">
<table>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.20</mn><mo>Ã—</mo><mn>0.20</mn><mo>=</mo><mn>0.04</mn></mrow><annotation encoding="application/x-tex">0.20 \times 0.20 = 0.04</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.04</mn><mo>=</mo><mn>0.02</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.04 = 0.02</annotation></semantics></math></td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.14</mn><mo>Ã—</mo><mn>0.10</mn><mo>=</mo><mn>0.014</mn></mrow><annotation encoding="application/x-tex">0.14 \times 0.10 = 0.014</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.014</mn><mo>=</mo><mn>0.007</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.014 = 0.007</annotation></semantics></math></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.02</mn><mo>+</mo><mn>0.007</mn><mo>=</mo><mn>0.027</mn></mrow><annotation encoding="application/x-tex">0.02 + 0.007 = 0.027</annotation></semantics></math></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>We can then multiply and sum for the <strong>evidence</strong> value.</p>
</div>
<div id="example-the-mms-problem-4" class="slide section level2">
<h1>Example: The M&amp;Mâ€™s Problem</h1>
<div class="column4highlight">
<table>
<colgroup>
<col width="5%" />
<col width="14%" />
<col width="18%" />
<col width="42%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>â‹…</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i) \cdot P(D|H_i)</annotation></semantics></math></th>
<th><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>H</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(H_i|D)</annotation></semantics></math></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.20</mn><mo>Ã—</mo><mn>0.20</mn><mo>=</mo><mn>0.04</mn></mrow><annotation encoding="application/x-tex">0.20 \times 0.20 = 0.04</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.04</mn><mo>=</mo><mn>0.02</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.04 = 0.02</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>0.02</mn><mn>0.027</mn></mfrac><mo>=</mo><mn>0.74</mn></mrow><annotation encoding="application/x-tex">\frac{0.02}{0.027} = 0.74</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>2</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.14</mn><mo>Ã—</mo><mn>0.10</mn><mo>=</mo><mn>0.014</mn></mrow><annotation encoding="application/x-tex">0.14 \times 0.10 = 0.014</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>0.014</mn><mo>=</mo><mn>0.007</mn></mrow><annotation encoding="application/x-tex">0.5 \times 0.014 = 0.007</annotation></semantics></math></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>0.007</mn><mn>0.027</mn></mfrac><mo>=</mo><mn>0.26</mn></mrow><annotation encoding="application/x-tex">\frac{0.007}{0.027} = 0.26</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.02</mn><mo>+</mo><mn>0.007</mn><mo>=</mo><mn>0.027</mn></mrow><annotation encoding="application/x-tex">0.02 + 0.007 = 0.027</annotation></semantics></math></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Finally, dividing through we obtain the <strong>posterior probabilities</strong>.</p>
<ul>
<li>Given the prior and the likelihoods, there is a <strong>74% chance</strong> that the yellow M&amp;Mâ€™s came from the 1994 bag (<em>bag A</em>), and a <strong>26% chance</strong> it came from the 1996 bag (<em>bag B</em>).</li>
</ul>
</div>
<div id="a-few-closing-comments" class="slide section level2">
<h1>A Few Closing Comments</h1>
<p>I really like table method for a few reasons:</p>
<ol style="list-style-type: decimal">
<li>It really breaks down everything into small, easily digestible chunks. This has been instrumental during teaching and interviews.</li>
<li>If you can remember the <strong>order</strong> of Bayesâ€™ Theorem, the table is laid out exactly the same way (the column layout is the same way youâ€™d write it â€” plus the denominator is the bottom row.)</li>
<li>Unlike solving a problem by plug and chug, you solve for <em>every</em> hypotheses at the same time.</li>
<li>You can easily do this in MS Excel.</li>
</ol>
<p>There are some drawbacks, of course, namely that you cannot iterate (<em>i.e.</em> update the priors.) But for simple calculations, this isnâ€™t an issue.</p>
<p><strong>If you have any questions, comments, and/or corrections, feel free to email me at <a href="mailto:joshuamagee@gmail.com">joshuamagee@gmail.com</a> or 774-222-2003. Anything for Insight!</strong></p>
</div>
</body>
</html>
